{"version":3,"sources":["error/ConfigurationError.js","GridLayout.js","mixin/ReadOnlyAttributes.js","validate/error/ValidationError.js","validate/TypeValidator.js","validate/error/ParseError.js","validate/error/InvalidTypeError.js","validate/IntegerTypeValidator.js","validate/StringTypeValidator.js","validate/ColorTypeValidator.js","validate/BooleanTypeValidator.js","validate/validate.js","TopPlayerHTMLElement.js","TopDiceBoardHTMLElement.js","TopDieHTMLElement.js","TopPlayerListHTMLElement.js","twenty-one-pips.js"],"names":["ConfigurationError","Error","[object Object]","message","super","FULL_CIRCLE_IN_DEGREES","randomizeCenter","n","Math","random","floor","ceil","call","_width","WeakMap","_height","_cols","_rows","_dice","_dieSize","_dispersion","_rotate","GridLayout","width","height","dispersion","dieSize","set","this","get","w","_calculateGrid","h","maximumNumberOfDice","d","ds","rotate","r","undefined","_center","row","col","dice","length","lenght","alreadyLayoutDice","diceToLayout","die","hasCoordinates","isHeld","push","max","min","availableCells","_computeAvailableCells","randomIndex","randomCell","splice","coordinates","_numberToCoordinates","rotation","round","available","Set","level","maxLevel","size","cell","_cellsOnLevel","_cellIsEmpty","add","Array","from","cells","center","_cellToNumber","find","_coordinatesToNumber","trunc","_cellToCoords","_numberToCell","coords","_coordsToCell","x","y","cornerCell","corner","widthIn","widthOut","heightIn","heightOut","snapTo","q","coverage","filter","quadrant","reduce","maxQ","point","xFit","yFit","attribute2property","name","first","rest","split","map","word","slice","toUpperCase","join","ReadOnlyAttributes","Sup","oldValue","newValue","property","connected","setAttribute","ValidationError","msg","_value","_defaultValue","_errors","TypeValidator","value","defaultValue","errors","origin","isValid","newDefault","predicate","bindVariables","ErrorType","apply","error","ParseError","InvalidTypeError","INTEGER_DEFAULT_VALUE","IntegerTypeValidator","input","Number","isInteger","parsedValue","parseInt","_check","m","largerThan","smallerThan","STRING_DEFAULT_VALUE","StringTypeValidator","COLOR_DEFAULT_VALUE","ColorTypeValidator","BOOLEAN_DEFAULT_VALUE","BooleanTypeValidator","Boolean","test","Validator","ValidatorSingleton","COLOR_ATTRIBUTE","NAME_ATTRIBUTE","SCORE_ATTRIBUTE","HAS_TURN_ATTRIBUTE","_color","_name","_score","_hasTurn","TopPlayerHTMLElement","HTMLElement","color","score","hasTurn","colorValue","validate","getAttribute","string","integer","removeAttribute","boolean","isTrue","observedAttributes","newScore","isConnected","parentNode","dispatchEvent","CustomEvent","detail","player","other","window","customElements","define","DEFAULT_SYSTEM_PLAYER","DEFAULT_DIE_SIZE","DEFAULT_HOLD_DURATION","DEFAULT_DRAGGING_DICE_DISABLED","DEFAULT_HOLDING_DICE_DISABLED","DEFAULT_ROTATING_DICE_DISABLED","ROWS","COLS","DEFAULT_WIDTH","DEFAULT_HEIGHT","DEFAULT_DISPERSION","MIN_DELTA","WIDTH_ATTRIBUTE","HEIGHT_ATTRIBUTE","DISPERSION_ATTRIBUTE","DIE_SIZE_ATTRIBUTE","DRAGGING_DICE_DISABLED_ATTRIBUTE","HOLDING_DICE_DISABLED_ATTRIBUTE","ROTATING_DICE_DISABLED_ATTRIBUTE","HOLD_DURATION_ATTRIBUTE","parseNumber","numberString","defaultNumber","number","isNaN","getPositiveNumber","defaultTo","getPositiveNumberAttribute","element","hasAttribute","valueString","getBoolean","booleanString","trueValue","getBooleanAttribute","_canvas","_layout","_currentPlayer","_numberOfReadyDice","context","board","getContext","getReadyDice","updateReadyDice","update","isReady","updateBoard","clearRect","render","NONE","Symbol","HOLD","MOVE","INDETERMINED","DRAGGING","convertWindowCoordinatesToCanvas","canvas","xWindow","yWindow","canvasBox","getBoundingClientRect","left","top","setupInteraction","state","staticBoard","dieUnderCursor","holdTimeout","holdDie","playerWithATurn","querySelector","releaseIt","holdIt","startHolding","setTimeout","holdDuration","showInteraction","event","layout","getAt","clientX","clientY","style","cursor","move","dx","abs","dy","clearTimeout","diceWithoutDieUnderCursor","getImageData","putImageData","stopInteraction","snapToCoords","newCoords","touchCoordinates","touch2mouseEvent","mouseEventName","touchEvent","touches","MouseEvent","addEventListener","disabledHoldingDice","disabledDraggingDice","TopDiceBoardHTMLElement","display","shadow","attachShadow","mode","document","createElement","appendChild","disabledRotation","getElementsByTagName","disabledRotatingDice","players","startTurn","forEach","throwIt","CIRCLE_DEGREES","NUMBER_OF_PIPS","DEFAULT_COLOR","DEFAULT_X","DEFAULT_Y","DEFAULT_ROTATION","DEFAULT_OPACITY","HELD_BY_ATTRIBUTE","PIPS_ATTRIBUTE","ROTATION_ATTRIBUTE","X_ATTRIBUTE","Y_ATTRIBUTE","BASE_DIE_SIZE","BASE_ROUNDED_CORNER_RADIUS","BASE_STROKE_WIDTH","MIN_STROKE_WIDTH","HALF","THIRD","PIP_SIZE","PIP_COLOR","deg2rad","deg","PI","isPipNumber","randomPips","DIE_UNICODE_CHARACTERS","pipsToUnicode","p","renderHold","SEPERATOR","save","globalAlpha","beginPath","fillStyle","arc","fill","restore","renderDie","SCALE","HALF_INNER_SIZE","sqrt","INNER_SIZE","ROUNDED_CORNER_RADIUS","INNER_SIZE_ROUNDED","STROKE_WIDTH","startX","startY","strokeStyle","lineWidth","moveTo","lineTo","stroke","renderPip","_board","_heldBy","_pips","_rotation","_x","_y","TopDieHTMLElement","pips","heldBy","pipsValue","between","notEmpty","Event","toUnicode","newColor","toString","c","newX","newY","newR","normalizedRotation","equals","scale","SHALF","STHIRD","SPIP_SIZE","translate","setTransform","TopPlayerListHTMLElement","endTurn","twentyonepips","Object","freeze","VERSION","LICENSE","WEBSITE","HTMLElements","Die","Player","PlayerList","DiceBoard"],"mappings":"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","file":"twenty-one-pips.min.js","sourcesContent":["/** \n * Copyright (c) 2018 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n/**\n * @module\n */\n\n/**\n * ConfigurationError\n *\n * @extends Error\n */\nconst ConfigurationError = class extends Error {\n\n    /**\n     * Create a new ConfigurationError with message.\n     *\n     * @param {String} message - The message associated with this\n     * ConfigurationError.\n     */\n    constructor(message) {\n        super(message);\n    }\n};\n\nexport {ConfigurationError};\n","/** \n * Copyright (c) 2018 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ConfigurationError} from \"./error/ConfigurationError.js\";\n\n/**\n * @module\n */\n\nconst FULL_CIRCLE_IN_DEGREES = 360;\n\nconst randomizeCenter = (n) => {\n    return (0.5 <= Math.random() ? Math.floor : Math.ceil).call(0, n);\n};\n\n// Private fields\nconst _width = new WeakMap();\nconst _height = new WeakMap();\nconst _cols = new WeakMap();\nconst _rows = new WeakMap();\nconst _dice = new WeakMap();\nconst _dieSize = new WeakMap();\nconst _dispersion = new WeakMap();\nconst _rotate = new WeakMap();\n\n/**\n * @typedef {Object} GridLayoutConfiguration\n * @property {Number} config.width - The minimal width of this\n * GridLayout in pixels.;\n * @property {Number} config.height] - The minimal height of\n * this GridLayout in pixels..\n * @property {Number} config.dispersion - The distance from the center of the\n * layout a die can be layout.\n * @property {Number} config.dieSize - The size of a die.\n */\n\n/**\n * GridLayout handles laying out the dice on a DiceBoard.\n */\nconst GridLayout = class {\n\n    /**\n     * Create a new GridLayout.\n     *\n     * @param {GridLayoutConfiguration} config - The configuration of the GridLayout\n     */\n    constructor({\n        width,\n        height,\n        dispersion,\n        dieSize\n    } = {}) {\n        _dice.set(this, []);\n        _dieSize.set(this, 1);\n        _width.set(this, 0);\n        _height.set(this, 0);\n        _rotate.set(this, true);\n\n        this.dispersion = dispersion;\n        this.dieSize = dieSize;\n        this.width = width;\n        this.height = height;\n    }\n\n    /**\n     * The width in pixels used by this GridLayout.\n     * @throws module:error/ConfigurationError.ConfigurationError Width >= 0\n     * @type {Number} \n     */\n    get width() {\n        return _width.get(this);\n    }\n\n    set width(w) {\n        if (0 > w) {\n            throw new ConfigurationError(`Width should be a number larger than 0, got '${w}' instead.`);\n        }\n        _width.set(this, w);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    /**\n     * The height in pixels used by this GridLayout. \n     * @throws module:error/ConfigurationError.ConfigurationError Height >= 0\n     *\n     * @type {Number}\n     */\n    get height() {\n        return _height.get(this);\n    }\n\n    set height(h) {\n        if (0 > h) {\n            throw new ConfigurationError(`Height should be a number larger than 0, got '${h}' instead.`);\n        }\n        _height.set(this, h);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    /**\n     * The maximum number of dice that can be layout on this GridLayout. This\n     * number is >= 0. Read only.\n     *\n     * @type {Number}\n     */\n    get maximumNumberOfDice() {\n        return this._cols * this._rows;\n    }\n\n    /**\n     * The dispersion level used by this GridLayout. The dispersion level\n     * indicates the distance from the center dice can be layout. Use 1 for a\n     * tight packed layout.\n     *\n     * @throws module:error/ConfigurationError.ConfigurationError Dispersion >= 0\n     * @type {Number}\n     */\n    get dispersion() {\n        return _dispersion.get(this);\n    }\n\n    set dispersion(d) {\n        if (0 > d) {\n            throw new ConfigurationError(`Dispersion should be a number larger than 0, got '${d}' instead.`);\n        }\n        return _dispersion.set(this, d);\n    }\n\n    /**\n     * The size of a die.\n     *\n     * @throws module:error/ConfigurationError.ConfigurationError DieSize >= 0\n     * @type {Number}\n     */\n    get dieSize() {\n        return _dieSize.get(this);\n    }\n\n    set dieSize(ds) {\n        if (0 >= ds) {\n            throw new ConfigurationError(`dieSize should be a number larger than 1, got '${ds}' instead.`);\n        }\n        _dieSize.set(this, ds);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    get rotate() {\n        const r = _rotate.get(this);\n        return undefined === r ? true : r;\n    }\n\n    set rotate(r) {\n        _rotate.set(this, r);\n    }\n\n    /**\n     * The number of rows in this GridLayout.\n     *\n     * @return {Number} The number of rows, 0 < rows.\n     * @private\n     */\n    get _rows() {\n        return _rows.get(this);\n    }\n\n    /**\n     * The number of columns in this GridLayout.\n     *\n     * @return {Number} The number of columns, 0 < columns.\n     * @private\n     */\n    get _cols() {\n        return _cols.get(this);\n    }\n\n    /**\n     * The center cell in this GridLayout.\n     *\n     * @return {Object} The center (row, col).\n     * @private\n     */\n    get _center() {\n        const row = randomizeCenter(this._rows / 2) - 1;\n        const col = randomizeCenter(this._cols / 2) - 1;\n\n        return {row, col};\n    }\n\n    /**\n     * Layout dice on this GridLayout.\n     *\n     * @param {module:Die~Die[]} dice - The dice to layout on this Layout.\n     * @return {module:Die~Die[]} The same list of dice, but now layout.\n     *\n     * @throws {module:error/ConfigurationError~ConfigurationError} The number of\n     * dice should not exceed the maximum number of dice this Layout can\n     * layout.\n     */\n    layout(dice) {\n        if (dice.length > this.maximumNumberOfDice) {\n            throw new ConfigurationError(`The number of dice that can be layout is ${this.maximumNumberOfDice}, got ${dice.lenght} dice instead.`);\n        }\n\n        const alreadyLayoutDice = [];\n        const diceToLayout = [];\n\n        for (const die of dice) {\n            if (die.hasCoordinates() && die.isHeld()) {\n                // Dice that are being held and have been layout before should\n                // keep their current coordinates and rotation. In other words,\n                // these dice are skipped.\n                alreadyLayoutDice.push(die);\n            } else {\n                diceToLayout.push(die);\n            }\n        }\n\n        const max = Math.min(dice.length * this.dispersion, this.maximumNumberOfDice);\n        const availableCells = this._computeAvailableCells(max, alreadyLayoutDice);\n\n        for (const die of diceToLayout) {\n            const randomIndex = Math.floor(Math.random() * availableCells.length);\n            const randomCell = availableCells[randomIndex];\n            availableCells.splice(randomIndex, 1);\n\n            die.coordinates = this._numberToCoordinates(randomCell);\n            die.rotation = this.rotate ? Math.round(Math.random() * FULL_CIRCLE_IN_DEGREES) : null;\n            alreadyLayoutDice.push(die);\n        }\n\n        _dice.set(this, alreadyLayoutDice);\n\n        return alreadyLayoutDice;\n    }\n\n    /**\n     * Compute a list with available cells to place dice on.\n     *\n     * @param {Number} max - The number empty cells to compute.\n     * @param {Die[]} alreadyLayoutDice - A list with dice that have already been layout.\n     * \n     * @return {NUmber[]} The list of available cells represented by their number.\n     * @private\n     */\n    _computeAvailableCells(max, alreadyLayoutDice) {\n        const available = new Set();\n        let level = 0;\n        const maxLevel = Math.min(this._rows, this._cols);\n\n        while (available.size < max && level < maxLevel) {\n            for (const cell of this._cellsOnLevel(level)) {\n                if (undefined !== cell && this._cellIsEmpty(cell, alreadyLayoutDice)) {\n                    available.add(cell);\n                }\n            }\n\n            level++;\n        }\n\n        return Array.from(available);\n    }\n\n    /**\n     * Calculate all cells on level from the center of the layout.\n     *\n     * @param {Number} level - The level from the center of the layout. 0\n     * indicates the center.\n     *\n     * @return {Set<Number>} the cells on the level in this layout represented by\n     * their number.\n     * @private\n     */\n    _cellsOnLevel(level) {\n        const cells = new Set();\n        const center = this._center;\n\n        if (0 === level) {\n            cells.add(this._cellToNumber(center));\n        } else {\n            for (let row = center.row - level; row <= center.row + level; row++) {\n                cells.add(this._cellToNumber({row, col: center.col - level}));\n                cells.add(this._cellToNumber({row, col: center.col + level}));\n            }\n\n            for (let col = center.col - level + 1; col < center.col + level; col++) {\n                cells.add(this._cellToNumber({row: center.row - level, col}));\n                cells.add(this._cellToNumber({row: center.row + level, col}));\n            }\n        }\n\n        return cells;\n    }\n\n    /**\n     * Does cell contain a cell from alreadyLayoutDice?\n     *\n     * @param {Number} cell - A cell in layout represented by a number.\n     * @param {Die[]} alreadyLayoutDice - A list of dice that have already been layout.\n     *\n     * @return {Boolean} True if cell does not contain a die.\n     * @private\n     */\n    _cellIsEmpty(cell, alreadyLayoutDice) {\n        return undefined === alreadyLayoutDice.find(die => cell === this._coordinatesToNumber(die.coordinates));\n    }\n\n    /**\n     * Convert a number to a cell (row, col)\n     *\n     * @param {Number} n - The number representing a cell\n     * @returns {Object} Return the cell ({row, col}) corresponding n.\n     * @private\n     */\n    _numberToCell(n) {\n        return {row: Math.trunc(n / this._cols), col: n % this._cols};\n    }\n\n    /**\n     * Convert a cell to a number\n     *\n     * @param {Object} cell - The cell to convert to its number.\n     * @return {Number|undefined} The number corresponding to the cell.\n     * Returns undefined when the cell is not on the layout\n     * @private\n     */\n    _cellToNumber({row, col}) {\n        if (0 <= row && row < this._rows && 0 <= col && col < this._cols) {\n            return row * this._cols + col;\n        }\n        return undefined;\n    }\n\n    /**\n     * Convert a cell represented by its number to their coordinates.\n     *\n     * @param {Number} n - The number representing a cell\n     *\n     * @return {Object} The coordinates corresponding to the cell represented by\n     * this number.\n     * @private\n     */\n    _numberToCoordinates(n) {\n        return this._cellToCoords(this._numberToCell(n));\n    }\n\n    /**\n     * Convert a pair of coordinates to a number.\n     *\n     * @param {Object} coords - The coordinates to convert\n     *\n     * @return {Number|undefined} The coordinates converted to a number. If\n     * the coordinates are not on this layout, the number is undefined.\n     * @private\n     */\n    _coordinatesToNumber(coords) {\n        const n = this._cellToNumber(this._coordsToCell(coords));\n        if (0 <= n && n < this.maximumNumberOfDice) {\n            return n;\n        }\n        return undefined;\n    }\n\n    /**\n     * Snap (x,y) to the closest cell in this Layout.\n     *\n     * @param {Object} diecoordinate - The coordinate to find the closest cell\n     * for.\n     * @param {Die} [diecoordinat.die = null] - The die to snap to.\n     * @param {Number} diecoordinate.x - The x-coordinate.\n     * @param {Number} diecoordinate.y - The y-coordinate.\n     *\n     * @return {Object|null} The coordinate of the cell closest to (x, y).\n     * Null when no suitable cell is near (x, y)\n     */\n    snapTo({die = null, x, y}) {\n        const cornerCell = {\n            row: Math.trunc(y / this.dieSize),\n            col: Math.trunc(x / this.dieSize)\n        };\n\n        const corner = this._cellToCoords(cornerCell);\n        const widthIn = corner.x + this.dieSize - x;\n        const widthOut = this.dieSize - widthIn;\n        const heightIn = corner.y + this.dieSize - y;\n        const heightOut = this.dieSize - heightIn;\n\n        const quadrants = [{\n            q: this._cellToNumber(cornerCell),\n            coverage: widthIn * heightIn\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row,\n                col: cornerCell.col + 1\n            }),\n            coverage: widthOut * heightIn\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row + 1,\n                col: cornerCell.col\n            }),\n            coverage: widthIn * heightOut\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row + 1,\n                col: cornerCell.col + 1\n            }),\n            coverage: widthOut * heightOut\n        }];\n\n        const snapTo = quadrants\n            // cell should be on the layout\n            .filter((quadrant) => undefined !== quadrant.q)\n            // cell should be not already taken except by itself\n            .filter((quadrant) => (\n                null !== die && this._coordinatesToNumber(die.coordinates) === quadrant.q)\n                || this._cellIsEmpty(quadrant.q, _dice.get(this)))\n            // cell should be covered by the die the most\n            .reduce(\n                (maxQ, quadrant) => quadrant.coverage > maxQ.coverage ? quadrant : maxQ,\n                {q: undefined, coverage: -1}\n            );\n\n        return undefined !== snapTo.q ? this._numberToCoordinates(snapTo.q) : null;\n    }\n\n    /**\n     * Get the die at point (x, y);\n     *\n     * @param {Point} point - The point in (x, y) coordinates\n     * @return {Die|null} The die under coordinates (x, y) or null if no die\n     * is at the point.\n     */\n    getAt(point = {x: 0, y: 0}) {\n        for (const die of _dice.get(this)) {\n            const {x, y} = die.coordinates;\n\n            const xFit = x <= point.x && point.x <= x + this.dieSize;\n            const yFit = y <= point.y && point.y <= y + this.dieSize;\n\n            if (xFit && yFit) {\n                return die;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Calculate the grid size given width and height.\n     *\n     * @param {Number} width - The minimal width\n     * @param {Number} height - The minimal height\n     *\n     * @private\n     */\n    _calculateGrid(width, height) {\n        _cols.set(this, Math.floor(width / this.dieSize));\n        _rows.set(this, Math.floor(height / this.dieSize));\n    }\n\n    /**\n     * Convert a (row, col) cell to (x, y) coordinates.\n     *\n     * @param {Object} cell - The cell to convert to coordinates\n     * @return {Object} The corresponding coordinates.\n     * @private\n     */\n    _cellToCoords({row, col}) {\n        return {x: col * this.dieSize, y: row * this.dieSize};\n    }\n\n    /**\n     * Convert (x, y) coordinates to a (row, col) cell.\n     *\n     * @param {Object} coordinates - The coordinates to convert to a cell.\n     * @return {Object} The corresponding cell\n     * @private\n     */\n    _coordsToCell({x, y}) {\n        return {\n            row: Math.trunc(y / this.dieSize),\n            col: Math.trunc(x / this.dieSize)\n        };\n    }\n};\n\nexport {GridLayout};\n","/**\n * Copyright (c) 2018 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n/**\n * @module mixin/ReadOnlyAttributes\n */\n\n/*\n * Convert an HTML attribute to an instance's property. \n *\n * @param {String} name - The attribute's name\n * @return {String} The corresponding property's name. For example, \"my-attr\"\n * will be converted to \"myAttr\", and \"disabled\" to \"disabled\".\n */\nconst attribute2property = (name) => {\n    const [first, ...rest] = name.split(\"-\");\n    return first + rest.map(word => word.slice(0, 1).toUpperCase() + word.slice(1)).join();\n};\n\n/**\n * Mixin {@link module:mixin/ReadOnlyAttributes~ReadOnlyAttributes} to a class.\n *\n * @param {*} Sup - The class to mix into.\n * @return {module:mixin/ReadOnlyAttributes~ReadOnlyAttributes} The mixed-in class\n */\nconst ReadOnlyAttributes = (Sup) =>\n    /**\n     * Mixin to make all attributes on a custom HTMLElement read-only in the sense\n     * that when the attribute gets a new value that differs from the value of the\n     * corresponding property, it is reset to that property's value. The\n     * assumption is that attribute \"my-attribute\" corresponds with property \"this.myAttribute\".\n     *\n     * @param {Class} Sup - The class to mixin this ReadOnlyAttributes.\n     * @return {ReadOnlyAttributes} The mixed in class.\n     *\n     * @mixin\n     * @alias module:mixin/ReadOnlyAttributes~ReadOnlyAttributes\n     */\n    class extends Sup {\n\n        /**\n         * Callback that is executed when an observed attribute's value is\n         * changed. If the HTMLElement is connected to the DOM, the attribute\n         * value can only be set to the corresponding HTMLElement's property.\n         * In effect, this makes this HTMLElement's attributes read-only.\n         *\n         * For example, if an HTMLElement has an attribute \"x\" and\n         * corresponding property \"x\", then changing the value \"x\" to \"5\"\n         * will only work when `this.x === 5`.\n         *\n         * @param {String} name - The attribute's name.\n         * @param {String} oldValue - The attribute's old value.\n         * @param {String} newValue - The attribute's new value.\n         */\n        attributeChangedCallback(name, oldValue, newValue) {\n            // All attributes are made read-only to prevent cheating by changing\n            // the attribute values. Of course, this is by no\n            // guarantee that users will not cheat in a different way.\n            const property = attribute2property(name);\n            if (this.connected && newValue !== `${this[property]}`) {\n                this.setAttribute(name, this[property]);\n            }\n        }\n    };\n\nexport {\n    ReadOnlyAttributes\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nconst ValidationError = class extends Error {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    ValidationError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./error/ValidationError.js\";\n\nconst _value = new WeakMap();\nconst _defaultValue = new WeakMap();\nconst _errors = new WeakMap();\n\nconst TypeValidator = class {\n    constructor({value, defaultValue, errors = []}) {\n        _value.set(this, value);\n        _defaultValue.set(this, defaultValue);\n        _errors.set(this, errors);\n    }\n\n    get origin() {\n        return _value.get(this);\n    }\n\n    get value() {\n        return this.isValid ? this.origin : _defaultValue.get(this);\n    }\n\n    get errors() {\n        return _errors.get(this);\n    }\n\n    get isValid() {\n        return 0 >= this.errors.length;\n    }\n\n    defaultTo(newDefault) {\n        _defaultValue.set(this, newDefault);\n        return this;\n    }\n\n    _check({predicate, bindVariables = [], ErrorType = ValidationError}) {\n        const proposition = predicate.apply(this, bindVariables);\n        if (!proposition) {\n            const error = new ErrorType(this.value, bindVariables);\n            //console.warn(error.toString());\n            this.errors.push(error);\n        }\n\n        return this;\n    }\n};\n\nexport {\n    TypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./ValidationError.js\";\n\nconst ParseError = class extends ValidationError {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    ParseError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./ValidationError.js\";\n\nconst InvalidTypeError = class extends ValidationError {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    InvalidTypeError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst INTEGER_DEFAULT_VALUE = 0;\nconst IntegerTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = INTEGER_DEFAULT_VALUE;\n        const defaultValue = INTEGER_DEFAULT_VALUE;\n        const errors = [];\n\n        if (Number.isInteger(input)) {\n            value = input;\n        } else if (\"string\" === typeof input) {\n            const parsedValue = parseInt(input, 10);\n            if (Number.isInteger(parsedValue)) {\n                value = parsedValue;\n            } else {\n                errors.push(new ParseError(input));\n            }\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    largerThan(n) {\n        return this._check({\n            predicate: (n) => this.origin >= n,\n            bindVariables: [n]\n        });\n    }\n\n    smallerThan(n) {\n        return this._check({\n            predicate: (n) => this.origin <= n,\n            bindVariables: [n]\n        });\n    }\n\n    between(n, m) {\n        return this._check({\n            predicate: (n, m) => this.largerThan(n) && this.smallerThan(m),\n            bindVariables: [n, m]\n        });\n    }\n};\n\nexport {\n    IntegerTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst STRING_DEFAULT_VALUE = \"\";\nconst StringTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = STRING_DEFAULT_VALUE;\n        const defaultValue = STRING_DEFAULT_VALUE;\n        const errors = [];\n\n        if (\"string\" === typeof input) {\n            value = input;\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    notEmpty() {\n        return this._check({\n            predicate: () => \"\" !== this.origin\n        });\n    }\n};\n\nexport {\n    StringTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\n//import {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst COLOR_DEFAULT_VALUE = \"black\";\nconst ColorTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = COLOR_DEFAULT_VALUE;\n        const defaultValue = COLOR_DEFAULT_VALUE;\n        const errors = [];\n\n        if (\"string\" === typeof input) {\n            value = input;\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n};\n\nexport {\n    ColorTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst BOOLEAN_DEFAULT_VALUE = false;\nconst BooleanTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = BOOLEAN_DEFAULT_VALUE;\n        const defaultValue = BOOLEAN_DEFAULT_VALUE;\n        const errors = [];\n\n        if (input instanceof Boolean) {\n            value = input;\n        } else if (\"string\" === typeof input) {\n            if (/true/i.test(input)) {\n                value = true;\n            } else if (/false/i.test(input)) {\n                value = false;\n            } else {\n                errors.push(new ParseError(input));\n            }\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    isTrue() {\n        return this._check({\n            predicate: () => true === this.origin\n        });\n    }\n\n    isFalse() {\n        return this._check({\n            predicate: () => false === this.origin\n        });\n    }\n};\n\nexport {\n    BooleanTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {IntegerTypeValidator} from \"./IntegerTypeValidator.js\";\nimport {StringTypeValidator} from \"./StringTypeValidator.js\";\nimport {ColorTypeValidator} from \"./ColorTypeValidator.js\";\nimport {BooleanTypeValidator} from \"./BooleanTypeValidator.js\";\n\nconst Validator = class {\n    constructor() {\n    }\n\n    boolean(input) {\n        return new BooleanTypeValidator(input);\n    }\n\n    color(input) {\n        return new ColorTypeValidator(input);\n    }\n\n    integer(input) {\n        return new IntegerTypeValidator(input);\n    }\n\n    string(input) {\n        return new StringTypeValidator(input);\n    }\n\n};\n\nconst ValidatorSingleton = new Validator();\n\nexport {\n    ValidatorSingleton as validate\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n/**\n * @module\n */\nimport {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {ReadOnlyAttributes} from \"./mixin/ReadOnlyAttributes.js\";\nimport {validate} from \"./validate/validate.js\";\n\n// The names of the (observed) attributes of the TopPlayerHTMLElement.\nconst COLOR_ATTRIBUTE = \"color\";\nconst NAME_ATTRIBUTE = \"name\";\nconst SCORE_ATTRIBUTE = \"score\";\nconst HAS_TURN_ATTRIBUTE = \"has-turn\";\n\n// The private properties of the TopPlayerHTMLElement \nconst _color = new WeakMap();\nconst _name = new WeakMap();\nconst _score = new WeakMap();\nconst _hasTurn = new WeakMap();\n\n/**\n * A Player in a dice game.\n *\n * A player's name should be unique in the game. Two different\n * TopPlayerHTMLElement elements with the same name attribute are treated as\n * the same player.\n *\n * In general it is recommended that no two players do have the same color,\n * although it is not unconceivable that certain dice games have players work\n * in teams where it would make sense for two or more different players to\n * have the same color.\n *\n * The name and color attributes are required. The score and has-turn\n * attributes are not.\n *\n * @extends HTMLElement\n * @mixes module:mixin/ReadOnlyAttributes~ReadOnlyAttributes\n */\nconst TopPlayerHTMLElement = class extends ReadOnlyAttributes(HTMLElement) {\n\n    /**\n     * Create a new TopPlayerHTMLElement, optionally based on an intitial\n     * configuration via an object parameter or declared attributes in HTML.\n     *\n     * @param {Object} [config] - An initial configuration for the\n     * player to create.\n     * @param {String} config.color - This player's color used in the game.\n     * @param {String} config.name - This player's name.\n     * @param {Number} [config.score] - This player's score.\n     * @param {Boolean} [config.hasTurn] - This player has a turn.\n     */\n    constructor({color, name, score, hasTurn} = {}) {\n        super();\n\n        const colorValue = validate.color(color || this.getAttribute(COLOR_ATTRIBUTE));\n        if (colorValue.isValid) {\n            _color.set(this, colorValue.value);\n            this.setAttribute(COLOR_ATTRIBUTE, this.color);\n        } else {\n            throw new ConfigurationError(\"A Player needs a color, which is a String.\");\n        }\n\n        const nameValue = validate.string(name || this.getAttribute(NAME_ATTRIBUTE));\n        if (nameValue.isValid) {\n            _name.set(this, name);\n            this.setAttribute(NAME_ATTRIBUTE, this.name);\n        } else {\n            throw new ConfigurationError(\"A Player needs a name, which is a String.\");\n        }\n\n        const scoreValue = validate.integer(score || this.getAttribute(SCORE_ATTRIBUTE));\n        if (scoreValue.isValid) {\n            _score.set(this, score);\n            this.setAttribute(SCORE_ATTRIBUTE, this.score);\n        } else {\n            // Okay. A player does not need to have a score.\n            _score.set(this, null);\n            this.removeAttribute(SCORE_ATTRIBUTE);\n        }\n\n        const hasTurnValue = validate.boolean(hasTurn || this.getAttribute(HAS_TURN_ATTRIBUTE))\n            .isTrue();\n        if (hasTurnValue.isValid) {\n            _hasTurn.set(this, hasTurn);\n            this.setAttribute(HAS_TURN_ATTRIBUTE, hasTurn);\n        } else {\n            // Okay, A player does not always have a turn.\n            _hasTurn.set(this, null);\n            this.removeAttribute(HAS_TURN_ATTRIBUTE);\n        }\n    }\n\n    static get observedAttributes() {\n        return [\n            COLOR_ATTRIBUTE,\n            NAME_ATTRIBUTE,\n            SCORE_ATTRIBUTE,\n            HAS_TURN_ATTRIBUTE\n        ];\n    }\n\n    connectedCallback() {\n    }\n\n    disconnectedCallback() {\n    }\n\n    /**\n     * This player's color.\n     *\n     * @type {String}\n     */\n    get color() {\n        return _color.get(this);\n    }\n\n    /**\n     * This player's name.\n     *\n     * @type {String}\n     */\n    get name() {\n        return _name.get(this);\n    }\n\n    /**\n     * This player's score.\n     *\n     * @type {Number}\n     */\n    get score() {\n        return null === _score.get(this) ? 0 : _score.get(this);\n    }\n    set score(newScore) {\n        _score.set(this, newScore);\n        if (null === newScore) {\n            this.removeAttribute(SCORE_ATTRIBUTE);\n        } else {\n            this.setAttribute(SCORE_ATTRIBUTE, newScore);\n        }\n    }\n\n    /**\n     * Start a turn for this player.\n     *\n     * @return {TopPlayerHTMLElement} The player with a turn\n     */\n    startTurn() {\n        if (this.isConnected) {\n            this.parentNode.dispatchEvent(new CustomEvent(\"top:start-turn\", {\n                detail: {\n                    player: this\n                }\n            }));\n        }\n        _hasTurn.set(this, true);\n        this.setAttribute(HAS_TURN_ATTRIBUTE, true);\n        return this;\n    }\n\n    /**\n     * End a turn for this player.\n     */\n    endTurn() {\n        _hasTurn.set(this, null);\n        this.removeAttribute(HAS_TURN_ATTRIBUTE);\n    }\n\n    /**\n     * Does this player have a turn?\n     *\n     * @type {Boolean}\n     */\n    get hasTurn() {\n        return true === _hasTurn.get(this);\n    }\n\n    /**\n     * A String representation of this player, his or hers name.\n     *\n     * @return {String} The player's name represents the player as a string.\n     */\n    toString() {\n        return `${this.name}`;\n    }\n\n    /**\n     * Is this player equal another player?\n     * \n     * @param {module:TopPlayerHTMLElement~TopPlayerHTMLElement} other - The other player to compare this player with.\n     * @return {Boolean} True when either the object references are the same\n     * or when both name and color are the same.\n     */\n    equals(other) {\n        const name = \"string\" === typeof other ? other : other.name;\n        return other === this || name === this.name;\n    }\n};\n\nwindow.customElements.define(\"top-player\", TopPlayerHTMLElement);\n\n/**\n * The default system player. Dice are thrown by a player. For situations\n * where you want to render a bunch of dice without needing the concept of Players\n * this DEFAULT_SYSTEM_PLAYER can be a substitute. Of course, if you'd like to\n * change the name and/or the color, create and use your own \"system player\".\n * @const\n */\nconst DEFAULT_SYSTEM_PLAYER = new TopPlayerHTMLElement({color: \"red\", name: \"*\"});\n\nexport {\n    TopPlayerHTMLElement,\n    DEFAULT_SYSTEM_PLAYER\n};\n","/**\n * Copyright (c) 2018 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n//import {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {GridLayout} from \"./GridLayout.js\";\nimport {DEFAULT_SYSTEM_PLAYER} from \"./TopPlayerHTMLElement.js\";\nimport {validate} from \"./validate/validate.js\";\n\n/**\n * @module\n */\n\nconst DEFAULT_DIE_SIZE = 100; // px\nconst DEFAULT_HOLD_DURATION = 375; // ms\nconst DEFAULT_DRAGGING_DICE_DISABLED = false;\nconst DEFAULT_HOLDING_DICE_DISABLED = false;\nconst DEFAULT_ROTATING_DICE_DISABLED = false;\n\nconst ROWS = 10;\nconst COLS = 10;\n\nconst DEFAULT_WIDTH = COLS * DEFAULT_DIE_SIZE; // px\nconst DEFAULT_HEIGHT = ROWS * DEFAULT_DIE_SIZE; // px\nconst DEFAULT_DISPERSION = Math.floor(ROWS / 2);\n\nconst MIN_DELTA = 3; //px\n\nconst WIDTH_ATTRIBUTE = \"width\";\nconst HEIGHT_ATTRIBUTE = \"height\";\nconst DISPERSION_ATTRIBUTE = \"dispersion\";\nconst DIE_SIZE_ATTRIBUTE = \"die-size\";\nconst DRAGGING_DICE_DISABLED_ATTRIBUTE = \"dragging-dice-disabled\";\nconst HOLDING_DICE_DISABLED_ATTRIBUTE = \"holding-dice-disabled\";\nconst ROTATING_DICE_DISABLED_ATTRIBUTE = \"rotating-dice-disabled\";\nconst HOLD_DURATION_ATTRIBUTE = \"hold-duration\";\n\n\nconst parseNumber = (numberString, defaultNumber = 0) => {\n    const number = parseInt(numberString, 10);\n    return Number.isNaN(number) ? defaultNumber : number;\n};\n\nconst getPositiveNumber = (numberString, defaultValue) => {\n    return validate.integer(numberString)\n        .largerThan(0)\n        .defaultTo(defaultValue)\n        .value;\n};\n\nconst getPositiveNumberAttribute = (element, name, defaultValue) => {\n    if (element.hasAttribute(name)) {\n        const valueString = element.getAttribute(name);\n        return getPositiveNumber(valueString, defaultValue);\n    }\n    return defaultValue;\n};\n\nconst getBoolean = (booleanString, trueValue, defaultValue) => {\n    if (trueValue === booleanString || \"true\" === booleanString) {\n        return true;\n    } else if (\"false\" === booleanString) {\n        return false;\n    } else {\n        return defaultValue;\n    }\n};\n\nconst getBooleanAttribute = (element, name, defaultValue) => {\n    if (element.hasAttribute(name)) {\n        const valueString = element.getAttribute(name);\n        return getBoolean(valueString, [valueString, \"true\"], [\"false\"], defaultValue);\n    }\n\n    return defaultValue;\n};\n\n// Private properties\nconst _canvas = new WeakMap();\nconst _layout = new WeakMap();\nconst _currentPlayer = new WeakMap();\nconst _numberOfReadyDice = new WeakMap();\n\nconst context = (board) => _canvas.get(board).getContext(\"2d\");\n\nconst getReadyDice = (board) => {\n    if (undefined === _numberOfReadyDice.get(board)) {\n        _numberOfReadyDice.set(board, 0);\n    }\n\n    return _numberOfReadyDice.get(board);\n};\n\nconst updateReadyDice = (board, update) => {\n    _numberOfReadyDice.set(board, getReadyDice(board) + update);\n};\n\nconst isReady = (board) => getReadyDice(board) === board.dice.length;\n\nconst updateBoard = (board, dice = board.dice) => {\n    if (isReady(board)) {\n        context(board).clearRect(0, 0, board.width, board.height);\n\n        for (const die of dice) {\n            die.render(context(board), board.dieSize);\n        }\n    }\n};\n\n\n// Interaction states\nconst NONE = Symbol(\"no_interaction\");\nconst HOLD = Symbol(\"hold\");\nconst MOVE = Symbol(\"move\");\nconst INDETERMINED = Symbol(\"indetermined\");\nconst DRAGGING = Symbol(\"dragging\");\n\n// Methods to handle interaction\nconst convertWindowCoordinatesToCanvas = (canvas, xWindow, yWindow) => {\n    const canvasBox = canvas.getBoundingClientRect();\n\n    const x = xWindow - canvasBox.left * (canvas.width / canvasBox.width);\n    const y = yWindow - canvasBox.top * (canvas.height / canvasBox.height);\n\n    return {x, y};\n};\n\nconst setupInteraction = (board) => {\n    const canvas = _canvas.get(board);\n\n    // Setup interaction\n    let origin = {};\n    let state = NONE;\n    let staticBoard = null;\n    let dieUnderCursor = null;\n    let holdTimeout = null;\n\n    const holdDie = () => {\n        if (HOLD === state || INDETERMINED === state) {\n            // toggle hold / release\n            const playerWithATurn = board.querySelector(\"top-player-list top-player[has-turn]\");\n            if (dieUnderCursor.isHeld()) {\n                dieUnderCursor.releaseIt(playerWithATurn);\n            } else {\n                dieUnderCursor.holdIt(playerWithATurn);\n            }\n            state = NONE;\n\n            updateBoard(board);\n        }\n\n        holdTimeout = null;\n    };\n\n    const startHolding = () => {\n        holdTimeout = window.setTimeout(holdDie, board.holdDuration);\n    };\n\n    const stopHolding = () => {\n        window.clearTimeout(holdTimeout);\n        holdTimeout = null;\n    };\n\n    const startInteraction = (event) => {\n        if (NONE === state) {\n\n            origin = {\n                x: event.clientX,\n                y: event.clientY\n            };\n\n            dieUnderCursor = board.layout.getAt(convertWindowCoordinatesToCanvas(canvas, event.clientX, event.clientY));\n\n            if (null !== dieUnderCursor) {\n                // Only interaction with the board via a die\n                if (!board.disabledHoldingDice && !board.disabledDraggingDice) {\n                    state = INDETERMINED;\n                    startHolding();\n                } else if (!board.disabledHoldingDice) {\n                    state = HOLD;\n                    startHolding();\n                } else if (!board.disabledDraggingDice) {\n                    state = MOVE;\n                }\n            }\n\n        }\n    };\n\n    const showInteraction = (event) => {\n        const dieUnderCursor = board.layout.getAt(convertWindowCoordinatesToCanvas(canvas, event.clientX, event.clientY));\n        if (DRAGGING === state) {\n            canvas.style.cursor = \"grabbing\";\n        } else if (null !== dieUnderCursor) {\n            canvas.style.cursor = \"grab\";\n        } else {\n            canvas.style.cursor = \"default\";\n        }\n    };\n\n    const move = (event) => {\n        if (MOVE === state || INDETERMINED === state) {\n            // determine if a die is under the cursor\n            // Ignore small movements\n            const dx = Math.abs(origin.x - event.clientX);\n            const dy = Math.abs(origin.y - event.clientY);\n\n            if (MIN_DELTA < dx || MIN_DELTA < dy) {\n                state = DRAGGING;\n                stopHolding();\n\n                const diceWithoutDieUnderCursor = board.dice.filter(die => die !== dieUnderCursor);\n                updateBoard(board, diceWithoutDieUnderCursor);\n                staticBoard = context(board).getImageData(0, 0, canvas.width, canvas.height);\n            }\n        } else if (DRAGGING === state) {\n            const dx = origin.x - event.clientX;\n            const dy = origin.y - event.clientY;\n\n            const {x, y} = dieUnderCursor.coordinates;\n\n            context(board).putImageData(staticBoard, 0, 0);\n            dieUnderCursor.render(context(board), board.dieSize, {x: x - dx, y: y - dy});\n        }\n    };\n\n    const stopInteraction = (event) => {\n        if (null !== dieUnderCursor && DRAGGING === state) {\n            const dx = origin.x - event.clientX;\n            const dy = origin.y - event.clientY;\n\n            const {x, y} = dieUnderCursor.coordinates;\n\n            const snapToCoords = board.layout.snapTo({\n                die: dieUnderCursor,\n                x: x - dx,\n                y: y - dy,\n            });\n\n            const newCoords = null != snapToCoords ? snapToCoords : {x, y};\n\n            dieUnderCursor.coordinates = newCoords;\n        }\n\n        // Clear state\n        dieUnderCursor = null;\n        state = NONE;\n\n        // Refresh board; Render dice\n        updateBoard(board);\n    };\n\n\n    // Register the actual event listeners defined above. Map touch events to\n    // equivalent mouse events. Because the \"touchend\" event does not have a\n    // clientX and clientY, record and use the last ones from the \"touchmove\"\n    // (or \"touchstart\") events.\n\n    let touchCoordinates = {clientX: 0, clientY: 0};\n    const touch2mouseEvent = (mouseEventName) => {\n        return (touchEvent) => {\n            if (touchEvent && 0 < touchEvent.touches.length) {\n                const {clientX, clientY} = touchEvent.touches[0];\n                touchCoordinates = {clientX, clientY};\n            }\n            canvas.dispatchEvent(new MouseEvent(mouseEventName, touchCoordinates));\n        };\n    };\n\n    canvas.addEventListener(\"touchstart\", touch2mouseEvent(\"mousedown\"));\n    canvas.addEventListener(\"mousedown\", startInteraction);\n\n    if (!board.disabledDraggingDice) {\n        canvas.addEventListener(\"touchmove\", touch2mouseEvent(\"mousemove\"));\n        canvas.addEventListener(\"mousemove\", move);\n    }\n\n    if (!board.disabledDraggingDice || !board.disabledHoldingDice) {\n        canvas.addEventListener(\"mousemove\", showInteraction);\n    }\n\n    canvas.addEventListener(\"touchend\", touch2mouseEvent(\"mouseup\"));\n    canvas.addEventListener(\"mouseup\", stopInteraction);\n    canvas.addEventListener(\"mouseout\", stopInteraction);\n};\n\n/**\n * TopDiceBoardHTMLElement is a custom HTML element to render and control a\n * dice board. \n *\n * @extends HTMLElement\n */\nconst TopDiceBoardHTMLElement = class extends HTMLElement {\n\n    /**\n     * Create a new TopDiceBoardHTMLElement.\n     */\n    constructor() {\n        super();\n        this.style.display = \"inline-block\";\n        const shadow = this.attachShadow({mode: \"closed\"});\n        const canvas = document.createElement(\"canvas\");\n        shadow.appendChild(canvas);\n\n        _canvas.set(this, canvas);\n        _currentPlayer.set(this, DEFAULT_SYSTEM_PLAYER);\n        _layout.set(this, new GridLayout({\n            width: this.width,\n            height: this.height,\n            dieSize: this.dieSize,\n            dispersion: this.dispersion\n        }));\n        setupInteraction(this);\n    }\n\n    static get observedAttributes() {\n        return [\n            WIDTH_ATTRIBUTE,\n            HEIGHT_ATTRIBUTE,\n            DISPERSION_ATTRIBUTE,\n            DIE_SIZE_ATTRIBUTE,\n            DRAGGING_DICE_DISABLED_ATTRIBUTE,\n            ROTATING_DICE_DISABLED_ATTRIBUTE,\n            HOLDING_DICE_DISABLED_ATTRIBUTE,\n            HOLD_DURATION_ATTRIBUTE\n        ];\n    }\n\n    attributeChangedCallback(name, oldValue, newValue) {\n        const canvas = _canvas.get(this);\n        switch (name) {\n        case WIDTH_ATTRIBUTE: {\n            const width = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_WIDTH);\n            this.layout.width = width;\n            canvas.setAttribute(WIDTH_ATTRIBUTE, width);\n            break;\n        }\n        case HEIGHT_ATTRIBUTE: {\n            const height = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_HEIGHT);\n            this.layout.height = height;\n            canvas.setAttribute(HEIGHT_ATTRIBUTE, height);\n            break;\n        }\n        case DISPERSION_ATTRIBUTE: {\n            const dispersion = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_DISPERSION);\n            this.layout.dispersion = dispersion;\n            break;\n        }\n        case DIE_SIZE_ATTRIBUTE: {\n            const dieSize = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_DIE_SIZE);\n            this.layout.dieSize = dieSize;\n            break;\n        }\n        case ROTATING_DICE_DISABLED_ATTRIBUTE: {\n            const disabledRotation = validate.boolean(newValue, getBoolean(oldValue, ROTATING_DICE_DISABLED_ATTRIBUTE, DEFAULT_ROTATING_DICE_DISABLED)).value;\n            this.layout.rotate = !disabledRotation;\n            break;\n        }\n        default: {\n            // The value is determined when using the getter\n        }\n        }\n\n        updateBoard(this);\n    }\n\n    connectedCallback() {\n        this.addEventListener(\"top-die:added\", () => {\n            updateReadyDice(this, 1);\n            if (isReady(this)) {\n                updateBoard(this, this.layout.layout(this.dice));\n            }\n        });\n\n        this.addEventListener(\"top-die:removed\", () => {\n            updateBoard(this, this.layout.layout(this.dice));\n            updateReadyDice(this, -1);\n        });\n\n        // All dice boards do have a player list. If there isn't one yet,\n        // create one.\n        if (null === this.querySelector(\"top-player-list\")) {\n            this.appendChild(document.createElement(\"top-player-list\"));\n        }\n    }\n\n    disconnectedCallback() {\n    }\n\n    adoptedCallback() {\n    }\n\n    /**\n     * The GridLayout used by this DiceBoard to layout the dice.\n     *\n     * @type {module:GridLayout~GridLayout}\n     */\n    get layout() {\n        return _layout.get(this);\n    }\n\n    /**\n     * The dice on this board. Note, to actually throw the dice use\n     * {@link throwDice}. \n     *\n     * @type {module:TopDieHTMLElement~TopDieHTMLElement[]}\n     */\n    get dice() {\n        return [...this.getElementsByTagName(\"top-die\")];\n    }\n\n    /**\n     * The maximum number of dice that can be put on this board.\n     *\n     * @return {Number} The maximum number of dice, 0 < maximum.\n     */\n    get maximumNumberOfDice() {\n        return this.layout.maximumNumberOfDice;\n    }\n\n    /**\n     * The width of this board.\n     *\n     * @type {Number}\n     */\n    get width() {\n        return getPositiveNumberAttribute(this, WIDTH_ATTRIBUTE, DEFAULT_WIDTH);\n    }\n\n    /**\n     * The height of this board.\n     * @type {Number}\n     */\n    get height() {\n        return getPositiveNumberAttribute(this, HEIGHT_ATTRIBUTE, DEFAULT_HEIGHT);\n    }\n\n    /**\n     * The dispersion level of this board.\n     * @type {Number}\n     */\n    get dispersion() {\n        return getPositiveNumberAttribute(this, DISPERSION_ATTRIBUTE, DEFAULT_DISPERSION);\n    }\n\n    /**\n     * The size of dice on this board.\n     *\n     * @type {Number}\n     */\n    get dieSize() {\n        return getPositiveNumberAttribute(this, DIE_SIZE_ATTRIBUTE, DEFAULT_DIE_SIZE);\n    }\n\n    /**\n     * Can dice on this board be dragged?\n     * @type {Boolean}\n     */\n    get disabledDraggingDice() {\n        return getBooleanAttribute(this, DRAGGING_DICE_DISABLED_ATTRIBUTE, DEFAULT_DRAGGING_DICE_DISABLED);\n    }\n\n    /**\n     * Can dice on this board be held by a Player?\n     * @type {Boolean}\n     */\n    get disabledHoldingDice() {\n        return getBooleanAttribute(this, HOLDING_DICE_DISABLED_ATTRIBUTE, DEFAULT_HOLDING_DICE_DISABLED);\n    }\n\n    /**\n     * Is rotating dice on this board disabled?\n     * @type {Boolean}\n     */\n    get disabledRotatingDice() {\n        return getBooleanAttribute(this, ROTATING_DICE_DISABLED_ATTRIBUTE, DEFAULT_ROTATING_DICE_DISABLED);\n    }\n\n    /**\n     * The duration in ms to press the mouse / touch a die before it bekomes\n     * held by the Player. It has only an effect when this.holdableDice ===\n     * true.\n     *\n     * @type {Number}\n     */\n    get holdDuration() {\n        return getPositiveNumberAttribute(this, HOLD_DURATION_ATTRIBUTE, DEFAULT_HOLD_DURATION);\n    }\n\n    /**\n     * The players playing on this board.\n     *\n     * @type {module:TopPlayerHTMLElement~TopPlayerHTMLElement[]}\n     */\n    get players() {\n        return this.querySelector(\"top-player-list\").players;\n    }\n\n    /**\n     * As player, throw the dice on this board.\n     *\n     * @param {module:TopPlayerHTMLElement~TopPlayerHTMLElement} [player = DEFAULT_SYSTEM_PLAYER] - The\n     * player that is throwing the dice on this board.\n     *\n     * @return {module:TopDieHTMLElement~TopDieHTMLElement[]} The thrown dice on this board. This list of dice is the same as this TopDiceBoardHTMLElement's {@see dice} property\n     */\n    throwDice(player = DEFAULT_SYSTEM_PLAYER) {\n        if (player && !player.hasTurn) {\n            player.startTurn();\n        }\n        this.dice.forEach(die => die.throwIt());\n        updateBoard(this, this.layout.layout(this.dice));\n        return this.dice;\n    }\n};\n\nwindow.customElements.define(\"top-dice-board\", TopDiceBoardHTMLElement);\n\nexport {\n    TopDiceBoardHTMLElement,\n    DEFAULT_DIE_SIZE,\n    DEFAULT_HOLD_DURATION,\n    DEFAULT_WIDTH,\n    DEFAULT_HEIGHT,\n    DEFAULT_DISPERSION,\n    DEFAULT_ROTATING_DICE_DISABLED\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n//import {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {ReadOnlyAttributes} from \"./mixin/ReadOnlyAttributes.js\";\nimport {validate} from \"./validate/validate.js\";\n\n/**\n * @module\n */\nconst CIRCLE_DEGREES = 360; // degrees\nconst NUMBER_OF_PIPS = 6; // Default / regular six sided die has 6 pips maximum.\nconst DEFAULT_COLOR = \"Ivory\";\nconst DEFAULT_X = 0; // px\nconst DEFAULT_Y = 0; // px\nconst DEFAULT_ROTATION = 0; // degrees\nconst DEFAULT_OPACITY = 0.5;\n\nconst COLOR_ATTRIBUTE = \"color\";\nconst HELD_BY_ATTRIBUTE = \"held-by\";\nconst PIPS_ATTRIBUTE = \"pips\";\nconst ROTATION_ATTRIBUTE = \"rotation\";\nconst X_ATTRIBUTE = \"x\";\nconst Y_ATTRIBUTE = \"y\";\n\nconst BASE_DIE_SIZE = 100; // px\nconst BASE_ROUNDED_CORNER_RADIUS = 15; // px\nconst BASE_STROKE_WIDTH = 2.5; // px\nconst MIN_STROKE_WIDTH = 1; // px\nconst HALF = BASE_DIE_SIZE / 2; // px\nconst THIRD = BASE_DIE_SIZE / 3; // px\nconst PIP_SIZE = BASE_DIE_SIZE / 15; //px\nconst PIP_COLOR = \"black\";\n\nconst deg2rad = (deg) => {\n    return deg * (Math.PI / 180);\n};\n\nconst isPipNumber = n => {\n    const number = parseInt(n, 10);\n    return Number.isInteger(number) && 1 <= number && number <= NUMBER_OF_PIPS;\n};\n\n/**\n * Generate a random number of pips between 1 and the NUMBER_OF_PIPS.\n *\n * @returns {Number} A random number n, 1  n  NUMBER_OF_PIPS.\n */\nconst randomPips = () => Math.floor(Math.random() * NUMBER_OF_PIPS) + 1;\n\nconst DIE_UNICODE_CHARACTERS = [\"\",\"\",\"\",\"\",\"\",\"\"];\n\n/**\n * Convert a unicode character representing a die face to the number of pips of\n * that same die. This function is the reverse of pipsToUnicode.\n *\n * @param {String} u - The unicode character to convert to pips.\n * @returns {Number|undefined} The corresponding number of pips, 1  pips  6, or\n * undefined if u was not a unicode character representing a die.\n */\nconst unicodeToPips = (u) => {\n    const dieCharIndex = DIE_UNICODE_CHARACTERS.indexOf(u);\n    return 0 <= dieCharIndex ? dieCharIndex + 1 : undefined;\n};\n\n/**\n * Convert a number of pips, 1  pips  6 to a unicode character\n * representation of the corresponding die face. This function is the reverse\n * of unicodeToPips.\n *\n * @param {Number} p - The number of pips to convert to a unicode character.\n * @returns {String|undefined} The corresponding unicode characters or\n * undefined if p was not between 1 and 6 inclusive.\n */\nconst pipsToUnicode = p => isPipNumber(p) ? DIE_UNICODE_CHARACTERS[p - 1] : undefined;\n\nconst renderHold = (context, x, y, width, color) => {\n    const SEPERATOR = width / 30;\n    context.save();\n    context.globalAlpha = DEFAULT_OPACITY;\n    context.beginPath();\n    context.fillStyle = color;\n    context.arc(x + width, y + width, width - SEPERATOR, 0, 2 * Math.PI, false);\n    context.fill();\n    context.restore();\n};\n\nconst renderDie = (context, x, y, width, color) => {\n    const SCALE = (width / HALF);\n    const HALF_INNER_SIZE = Math.sqrt(width ** 2 / 2);\n    const INNER_SIZE = 2 * HALF_INNER_SIZE;\n    const ROUNDED_CORNER_RADIUS = BASE_ROUNDED_CORNER_RADIUS * SCALE;\n    const INNER_SIZE_ROUNDED = INNER_SIZE - 2 * ROUNDED_CORNER_RADIUS;\n    const STROKE_WIDTH = Math.max(MIN_STROKE_WIDTH, BASE_STROKE_WIDTH * SCALE);\n\n    const startX = x + width - HALF_INNER_SIZE + ROUNDED_CORNER_RADIUS;\n    const startY = y + width - HALF_INNER_SIZE;\n\n    context.save();\n    context.beginPath();\n    context.fillStyle = color;\n    context.strokeStyle = \"black\";\n    context.lineWidth = STROKE_WIDTH;\n    context.moveTo(startX, startY);\n    context.lineTo(startX + INNER_SIZE_ROUNDED, startY);\n    context.arc(startX + INNER_SIZE_ROUNDED, startY + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(270), deg2rad(0));\n    context.lineTo(startX + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS);\n    context.arc(startX + INNER_SIZE_ROUNDED, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(0), deg2rad(90));\n    context.lineTo(startX, startY + INNER_SIZE);\n    context.arc(startX, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(90), deg2rad(180));\n    context.lineTo(startX - ROUNDED_CORNER_RADIUS, startY + ROUNDED_CORNER_RADIUS);\n    context.arc(startX, startY + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(180), deg2rad(270));\n\n    context.stroke();\n    context.fill();\n    context.restore();\n};\n\nconst renderPip = (context, x, y, width) => {\n    context.save();\n    context.beginPath();\n    context.fillStyle = PIP_COLOR;\n    context.moveTo(x, y);\n    context.arc(x, y, width, 0, 2 * Math.PI, false);\n    context.fill();\n    context.restore();\n};\n\n\n// Private properties\nconst _board = new WeakMap();\nconst _color = new WeakMap();\nconst _heldBy = new WeakMap();\nconst _pips = new WeakMap();\nconst _rotation = new WeakMap();\nconst _x = new WeakMap();\nconst _y = new WeakMap();\n\n/**\n * TopDieHTMLElement is the \"top-die\" custom [HTML\n * element](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement) representing a die\n * on the dice board.\n *\n * @extends HTMLElement\n * @mixes module:mixin/ReadOnlyAttributes~ReadOnlyAttributes\n */\nconst TopDieHTMLElement = class extends ReadOnlyAttributes(HTMLElement) {\n\n    /**\n     * Create a new TopDieHTMLElement.\n     */\n    constructor({pips, color, rotation, x, y, heldBy} = {}) {\n        super();\n\n        const pipsValue = validate.integer(pips || this.getAttribute(PIPS_ATTRIBUTE))\n            .between(1, 6)\n            .defaultTo(randomPips())\n            .value;\n\n        _pips.set(this, pipsValue);\n        this.setAttribute(PIPS_ATTRIBUTE, pipsValue);\n\n        this.color = validate.color(color || this.getAttribute(COLOR_ATTRIBUTE))\n            .defaultTo(DEFAULT_COLOR)\n            .value;\n\n        this.rotation = validate.integer(rotation || this.getAttribute(ROTATION_ATTRIBUTE))\n            .between(0, 360)\n            .defaultTo(DEFAULT_ROTATION)\n            .value;\n\n        this.x = validate.integer(x || this.getAttribute(X_ATTRIBUTE))\n            .largerThan(0)\n            .defaultTo(DEFAULT_X)\n            .value;\n\n        this.y = validate.integer(y || this.getAttribute(Y_ATTRIBUTE))\n            .largerThan(0)\n            .defaultTo(DEFAULT_Y)\n            .value;\n\n        this.heldBy = validate.string(heldBy || this.getAttribute(HELD_BY_ATTRIBUTE))\n            .notEmpty()\n            .defaultTo(null)\n            .value;\n    }\n\n    static get observedAttributes() {\n        return [\n            COLOR_ATTRIBUTE,\n            HELD_BY_ATTRIBUTE,\n            PIPS_ATTRIBUTE,\n            ROTATION_ATTRIBUTE,\n            X_ATTRIBUTE,\n            Y_ATTRIBUTE\n        ];\n    }\n\n    connectedCallback() {\n        _board.set(this, this.parentNode);\n        _board.get(this).dispatchEvent(new Event(\"top-die:added\"));\n    }\n\n    disconnectedCallback() {\n        _board.get(this).dispatchEvent(new Event(\"top-die:removed\"));\n        _board.set(this, null);\n    }\n\n    /**\n     * Convert this Die to the corresponding unicode character of a die face.\n     *\n     * @return {String} The unicode character corresponding to the number of\n     * pips of this Die.\n     */\n    toUnicode() {\n        return pipsToUnicode(this.pips);\n    }\n\n    /**\n     * Create a string represenation for this die.\n     *\n     * @return {String} The unicode symbol corresponding to the number of pips\n     * of this die.\n     */\n    toString() {\n        return this.toUnicode();\n    }\n\n    /**\n     * This Die's number of pips, 1  pips  6.\n     *\n     * @type {Number}\n     */\n    get pips() {\n        return _pips.get(this);\n    }\n\n    /**\n     * This Die's color.\n     *\n     * @type {String}\n     */\n    get color() {\n        return _color.get(this);\n    }\n    set color(newColor) {\n        if (null === newColor) {\n            this.removeAttribute(COLOR_ATTRIBUTE);\n            _color.set(this, DEFAULT_COLOR);\n        } else {\n            _color.set(this, newColor);\n            this.setAttribute(COLOR_ATTRIBUTE, newColor);\n        }\n    }\n\n\n    /**\n     * The Player that is holding this Die, if any. Null otherwise.\n     *\n     * @type {Player|null} \n     */\n    get heldBy() {\n        return _heldBy.get(this);\n    }\n    set heldBy(player) {\n        _heldBy.set(this, player);\n        if (null === player) {\n            this.removeAttribute(\"held-by\");\n        } else {\n            this.setAttribute(\"held-by\", player.toString());\n        }\n    }\n\n    /**\n     * The coordinates of this Die.\n     *\n     * @type {Coordinates|null}\n     */\n    get coordinates() {\n        return null === this.x || null === this.y ? null : {x: this.x, y: this.y};\n    }\n    set coordinates(c) {\n        if (null === c) {\n            this.x = null;\n            this.y = null;\n        } else{\n            const {x, y} = c;\n            this.x = x;\n            this.y = y;\n        }\n    }\n\n    /**\n     * Does this Die have coordinates?\n     *\n     * @return {Boolean} True when the Die does have coordinates\n     */\n    hasCoordinates() {\n        return null !== this.coordinates;\n    }\n\n    /**\n     * The x coordinate\n     *\n     * @type {Number}\n     */\n    get x() {\n        return _x.get(this);\n    }\n    set x(newX) {\n        _x.set(this, newX);\n        this.setAttribute(\"x\", newX);\n    }\n\n    /**\n     * The y coordinate\n     *\n     * @type {Number}\n     */\n    get y() {\n        return _y.get(this);\n    }\n    set y(newY) {\n        _y.set(this, newY);\n        this.setAttribute(\"y\", newY);\n    }\n\n    /**\n     * The rotation of this Die. 0  rotation  360.\n     *\n     * @type {Number|null}\n     */\n    get rotation() {\n        return _rotation.get(this);\n    }\n    set rotation(newR) {\n        if (null === newR) {\n            this.removeAttribute(\"rotation\");\n        } else {\n            const normalizedRotation = newR % CIRCLE_DEGREES;\n            _rotation.set(this, normalizedRotation);\n            this.setAttribute(\"rotation\", normalizedRotation);\n        }\n    }\n\n    /**\n     * Throw this Die. The number of pips to a random number n, 1  n  6.\n     * Only dice that are not being held can be thrown.\n     *\n     * @fires \"top:throw-die\" with parameters this Die.\n     */\n    throwIt() {\n        if (!this.isHeld()) {\n            _pips.set(this, randomPips());\n            this.setAttribute(PIPS_ATTRIBUTE, this.pips);\n            this.dispatchEvent(new Event(\"top:throw-die\", {\n                detail: {\n                    die: this\n                }\n            }));\n        }\n    }\n\n    /**\n     * The player holds this Die. A player can only hold a die that is not\n     * being held by another player yet.\n     *\n     * @param {module:Player~Player} player - The player who wants to hold this Die.\n     * @fires \"top:hold-die\" with parameters this Die and the player.\n     */\n    holdIt(player) {\n        if (!this.isHeld()) {\n            this.heldBy = player;\n            this.dispatchEvent(new Event(\"top:hold-die\", {\n                detail: {\n                    die: this,\n                    player\n                }\n            }));\n        }\n    }\n\n    /**\n     * Is this Die being held by any player?\n     *\n     * @return {Boolean} True when this Die is being held by any player, false otherwise.\n     */\n    isHeld() {\n        return null !== this.heldBy;\n    }\n\n    /**\n     * The player releases this Die. A player can only release dice that she is\n     * holding.\n     *\n     * @param {module:Player~Player} player - The player who wants to release this Die.\n     * @fires \"top:relase-die\" with parameters this Die and the player releasing it.\n     */\n    releaseIt(player) {\n        if (this.isHeld() && this.heldBy.equals(player)) {\n            this.heldBy = null;\n            this.removeAttribute(HELD_BY_ATTRIBUTE);\n            this.dispatchEvent(new CustomEvent(\"top:release-die\", {\n                detail: {\n                    die: this,\n                    player\n                }\n            }));\n        }\n    }\n\n    /**\n     * Render this Die.\n     *\n     * @param {CanvasRenderingContext2D} context - The canvas context to draw\n     * on\n     * @param {Number} dieSize - The size of a die.\n     * @param {Number} [coordinates = this.coordinates] - The coordinates to\n     * draw this die. By default, this die is drawn at its own coordinates,\n     * but you can also draw it elsewhere if so needed.\n     */\n    render(context, dieSize, coordinates = this.coordinates) {\n        const scale = dieSize / BASE_DIE_SIZE;\n        const SHALF = HALF * scale;\n        const STHIRD = THIRD * scale;\n        const SPIP_SIZE = PIP_SIZE * scale;\n\n        const {x, y} = coordinates;\n\n        if (this.isHeld()) {\n            renderHold(context, x, y, SHALF, this.heldBy.color);\n        }\n\n        if (0 !== this.rotation) {\n            context.translate(x + SHALF, y + SHALF);\n            context.rotate(deg2rad(this.rotation));\n            context.translate(-1 * (x + SHALF), -1 * (y + SHALF));\n        }\n\n        renderDie(context, x, y, SHALF, this.color);\n\n        switch (this.pips) {\n        case 1: {\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            break;\n        }\n        case 2: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 3: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 4: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 5: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 6: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + SHALF, SPIP_SIZE);\n            break;\n        }\n        default: // No other values allowed / possible\n        }\n\n        // Clear context\n        context.setTransform(1, 0, 0, 1, 0, 0);\n    }\n};\n\nwindow.customElements.define(\"top-die\", TopDieHTMLElement);\n\nexport {\n    TopDieHTMLElement,\n    unicodeToPips,\n    pipsToUnicode\n};\n","/**\n * Copyright (c) 2018 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {DEFAULT_SYSTEM_PLAYER} from \"./TopPlayerHTMLElement.js\";\n\n/**\n * TopPlayerListHTMLElement to describe the players in the game.\n *\n * @extends HTMLElement\n */\nconst TopPlayerListHTMLElement = class extends HTMLElement {\n\n    /**\n     * Create a new TopPlayerListHTMLElement.\n     */\n    constructor() {\n        super();\n    }\n\n    connectedCallback() {\n        if (0 >= this.players.length) {\n            this.appendChild(DEFAULT_SYSTEM_PLAYER);\n        }\n\n        this.addEventListener(\"top:start-turn\", (event) => {\n            // Only one player can have a turn at any given time.\n            this.players\n                .filter(p => !p.equals(event.detail.player))\n                .forEach(p => p.endTurn());\n        });\n    }\n\n    disconnectedCallback() {\n    }\n\n    /**\n     * The players in this list.\n     *\n     * @type {module:TopPlayerHTMLElement~TopPlayerHTMLElement[]}\n     */\n    get players() {\n        return [...this.getElementsByTagName(\"top-player\")];\n    }\n};\n\nwindow.customElements.define(\"top-player-list\", TopPlayerListHTMLElement);\n\nexport {\n    TopPlayerListHTMLElement\n};\n","/**\n * Copyright (c) 2018 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport {TopDiceBoardHTMLElement} from \"./TopDiceBoardHTMLElement.js\";\nimport {TopDieHTMLElement} from \"./TopDieHTMLElement.js\";\nimport {TopPlayerHTMLElement} from \"./TopPlayerHTMLElement.js\";\nimport {TopPlayerListHTMLElement} from \"./TopPlayerListHTMLElement.js\";\n\nwindow.twentyonepips = window.twentyonepips || Object.freeze({\n    VERSION: \"0.0.1\",\n    LICENSE: \"LGPL-3.0\",\n    WEBSITE: \"https://twentyonepips.org\",\n    HTMLElements: {\n        TopDiceBoardHTMLElement: TopDiceBoardHTMLElement,\n        TopDieHTMLElement: TopDieHTMLElement,\n        TopPlayerHTMLElement: TopPlayerHTMLElement,\n        TopPlayerListHTMLElement: TopPlayerListHTMLElement\n    },\n    Die: TopDieHTMLElement,\n    Player: TopPlayerHTMLElement,\n    PlayerList: TopPlayerListHTMLElement,\n    DiceBoard: TopDiceBoardHTMLElement\n});\n"]}