{"version":3,"sources":["error/ConfigurationError.js","GridLayout.js","mixin/ReadOnlyAttributes.js","validate/error/ValidationError.js","validate/TypeValidator.js","validate/error/ParseError.js","validate/error/InvalidTypeError.js","validate/IntegerTypeValidator.js","validate/StringTypeValidator.js","validate/ColorTypeValidator.js","validate/BooleanTypeValidator.js","validate/validate.js","TopPlayer.js","TopDie.js","TopPlayerList.js","TopDiceBoard.js","twenty-one-pips.js"],"names":["ConfigurationError","Error","[object Object]","message","super","FULL_CIRCLE_IN_DEGREES","randomizeCenter","n","Math","random","floor","ceil","call","_width","WeakMap","_height","_cols","_rows","_dice","_dieSize","_dispersion","_rotate","GridLayout","width","DEFAULT_WIDTH","height","DEFAULT_HEIGHT","dieSize","DEFAULT_DIE_SIZE","dispersion","DEFAULT_DISPERSION","set","this","get","w","Number","isInteger","_calculateGrid","h","maximumNumberOfDice","d","ds","rotate","r","undefined","_center","row","col","dice","length","lenght","alreadyLayoutDice","diceToLayout","die","isHeld","push","max","min","availableCells","_computeAvailableCells","randomIndex","randomCell","splice","coordinates","_numberToCoordinates","rotation","round","available","Set","level","maxLevel","size","cell","_cellsOnLevel","_cellIsEmpty","add","Array","from","cells","center","_cellToNumber","find","_coordinatesToNumber","trunc","_cellToCoords","_numberToCell","coords","_coordsToCell","x","y","cornerCell","corner","widthIn","widthOut","heightIn","heightOut","snapTo","q","coverage","filter","quadrant","reduce","maxQ","point","xFit","yFit","attribute2property","name","first","rest","split","map","word","slice","toUpperCase","join","ReadOnlyAttributes","Sup","oldValue","newValue","property","connected","setAttribute","ValidationError","msg","_value","_defaultValue","_errors","TypeValidator","value","defaultValue","errors","origin","isValid","newDefault","predicate","bindVariables","ErrorType","apply","error","ParseError","InvalidTypeError","INTEGER_DEFAULT_VALUE","IntegerTypeValidator","input","parsedValue","parseInt","_check","m","largerThan","smallerThan","STRING_DEFAULT_VALUE","StringTypeValidator","COLOR_DEFAULT_VALUE","ColorTypeValidator","BOOLEAN_DEFAULT_VALUE","BooleanTypeValidator","Boolean","test","Validator","ValidatorSingleton","TAG_NAME","COLOR_ATTRIBUTE","NAME_ATTRIBUTE","SCORE_ATTRIBUTE","HAS_TURN_ATTRIBUTE","_color","_name","_score","_hasTurn","TopPlayer","HTMLElement","color","score","hasTurn","colorValue","validate","getAttribute","string","integer","removeAttribute","boolean","isTrue","observedAttributes","newScore","isConnected","parentNode","dispatchEvent","CustomEvent","detail","player","other","sameName","sameColor","window","customElements","define","DEFAULT_SYSTEM_PLAYER","CIRCLE_DEGREES","NUMBER_OF_PIPS","DEFAULT_COLOR","DEFAULT_X","DEFAULT_Y","DEFAULT_ROTATION","DEFAULT_OPACITY","HELD_BY_ATTRIBUTE","PIPS_ATTRIBUTE","ROTATION_ATTRIBUTE","X_ATTRIBUTE","Y_ATTRIBUTE","BASE_DIE_SIZE","BASE_ROUNDED_CORNER_RADIUS","BASE_STROKE_WIDTH","MIN_STROKE_WIDTH","HALF","THIRD","PIP_SIZE","PIP_COLOR","deg2rad","deg","PI","isPipNumber","number","randomPips","DIE_UNICODE_CHARACTERS","pipsToUnicode","p","renderHold","context","SEPERATOR","save","globalAlpha","beginPath","fillStyle","arc","fill","restore","renderDie","SCALE","HALF_INNER_SIZE","sqrt","INNER_SIZE","ROUNDED_CORNER_RADIUS","INNER_SIZE_ROUNDED","STROKE_WIDTH","startX","startY","strokeStyle","lineWidth","moveTo","lineTo","stroke","renderPip","_board","_heldBy","_pips","_rotation","_x","_y","TopDie","pips","heldBy","pipsValue","between","defaultTo","document","querySelector","Event","toUnicode","newColor","toString","c","newX","newY","newR","normalizedRotation","equals","scale","SHALF","STHIRD","SPIP_SIZE","translate","setTransform","TopPlayerList","players","appendChild","addEventListener","event","forEach","endTurn","getElementsByTagName","TOP_PLAYER","DEFAULT_HOLD_DURATION","DEFAULT_DRAGGING_DICE_DISABLED","DEFAULT_HOLDING_DICE_DISABLED","DEFAULT_ROTATING_DICE_DISABLED","ROWS","COLS","MIN_DELTA","WIDTH_ATTRIBUTE","HEIGHT_ATTRIBUTE","DISPERSION_ATTRIBUTE","DIE_SIZE_ATTRIBUTE","DRAGGING_DICE_DISABLED_ATTRIBUTE","HOLDING_DICE_DISABLED_ATTRIBUTE","ROTATING_DICE_DISABLED_ATTRIBUTE","HOLD_DURATION_ATTRIBUTE","parseNumber","numberString","defaultNumber","isNaN","getPositiveNumber","getPositiveNumberAttribute","element","hasAttribute","valueString","getBoolean","booleanString","trueValue","getBooleanAttribute","_canvas","_layout","_currentPlayer","_numberOfReadyDice","board","getContext","getReadyDice","updateReadyDice","update","isReady","updateBoard","clearRect","render","addDie","layout","removeDie","NONE","Symbol","HOLD","MOVE","INDETERMINED","DRAGGING","convertWindowCoordinatesToCanvas","canvas","xWindow","yWindow","canvasBox","getBoundingClientRect","left","top","setupInteraction","state","staticBoard","dieUnderCursor","holdTimeout","holdDie","playerWithATurn","TOP_PLAYER_LIST","releaseIt","holdIt","startHolding","setTimeout","holdDuration","showInteraction","getAt","clientX","clientY","style","cursor","move","dx","abs","dy","clearTimeout","diceWithoutDieUnderCursor","getImageData","putImageData","stopInteraction","snapToCoords","newCoords","touchCoordinates","touch2mouseEvent","mouseEventName","touchEvent","touches","MouseEvent","disabledHoldingDice","disabledDraggingDice","TopDiceBoard","display","shadow","attachShadow","mode","createElement","disabledRotation","disabledRotatingDice","_playerList","playerList","startTurn","throwIt","config","removeChild","twentyonepips","Object","freeze","VERSION","LICENSE","WEBSITE"],"mappings":"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","file":"twenty-one-pips.min.js","sourcesContent":["/** \n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n/**\n * ConfigurationError\n *\n * @extends Error\n */\nconst ConfigurationError = class extends Error {\n\n    /**\n     * Create a new ConfigurationError with message.\n     *\n     * @param {String} message - The message associated with this\n     * ConfigurationError.\n     */\n    constructor(message) {\n        super(message);\n    }\n};\n\nexport {ConfigurationError};\n","/** \n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {DEFAULT_DIE_SIZE, DEFAULT_DISPERSION, DEFAULT_WIDTH, DEFAULT_HEIGHT} from \"./TopDiceBoard.js\";\n\nconst FULL_CIRCLE_IN_DEGREES = 360;\n\nconst randomizeCenter = (n) => {\n    return (0.5 <= Math.random() ? Math.floor : Math.ceil).call(0, n);\n};\n\n// Private fields\nconst _width = new WeakMap();\nconst _height = new WeakMap();\nconst _cols = new WeakMap();\nconst _rows = new WeakMap();\nconst _dice = new WeakMap();\nconst _dieSize = new WeakMap();\nconst _dispersion = new WeakMap();\nconst _rotate = new WeakMap();\n\n/**\n * @typedef {Object} GridLayoutConfiguration\n * @property {Number} config.width - The minimal width of this\n * GridLayout in pixels.;\n * @property {Number} config.height] - The minimal height of\n * this GridLayout in pixels..\n * @property {Number} config.dispersion - The distance from the center of the\n * layout a die can be layout.\n * @property {Number} config.dieSize - The size of a die.\n */\n\n/**\n * GridLayout handles laying out the dice on a DiceBoard.\n */\nconst GridLayout = class {\n\n    /**\n     * Create a new GridLayout.\n     *\n     * @param {GridLayoutConfiguration} config - The configuration of the GridLayout\n     */\n    constructor({\n        width = DEFAULT_WIDTH,\n        height = DEFAULT_HEIGHT,\n        dieSize = DEFAULT_DIE_SIZE,\n        dispersion = DEFAULT_DISPERSION\n    } = {}) {\n        _dice.set(this, []);\n        _dieSize.set(this, 1);\n        _width.set(this, 0);\n        _height.set(this, 0);\n        _rotate.set(this, true);\n\n        this.dispersion = dispersion;\n        this.dieSize = dieSize;\n        this.width = width;\n        this.height = height;\n    }\n\n    /**\n     * The width in pixels used by this GridLayout.\n     * @throws ConfigurationError Width >= 0\n     * @type {Number} \n     */\n    get width() {\n        return _width.get(this);\n    }\n\n    set width(w) {\n        if (!Number.isInteger(w) || 0 > w) {\n            throw new ConfigurationError(`Width should be a number larger than 0, got '${w}' instead.`);\n        }\n        _width.set(this, w);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    /**\n     * The height in pixels used by this GridLayout. \n     * @throws ConfigurationError Height >= 0\n     *\n     * @type {Number}\n     */\n    get height() {\n        return _height.get(this);\n    }\n\n    set height(h) {\n        if (!Number.isInteger(h) || 0 > h) {\n            throw new ConfigurationError(`Height should be a number larger than 0, got '${h}' instead.`);\n        }\n        _height.set(this, h);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    /**\n     * The maximum number of dice that can be layout on this GridLayout. This\n     * number is >= 0. Read only.\n     *\n     * @type {Number}\n     */\n    get maximumNumberOfDice() {\n        return this._cols * this._rows;\n    }\n\n    /**\n     * The dispersion level used by this GridLayout. The dispersion level\n     * indicates the distance from the center dice can be layout. Use 1 for a\n     * tight packed layout.\n     *\n     * @throws ConfigurationError Dispersion >= 0\n     * @type {Number}\n     */\n    get dispersion() {\n        return _dispersion.get(this);\n    }\n\n    set dispersion(d) {\n        if (!Number.isInteger(d) || 0 > d) {\n            throw new ConfigurationError(`Dispersion should be a number larger than 0, got '${d}' instead.`);\n        }\n        return _dispersion.set(this, d);\n    }\n\n    /**\n     * The size of a die.\n     *\n     * @throws ConfigurationError DieSize >= 0\n     * @type {Number}\n     */\n    get dieSize() {\n        return _dieSize.get(this);\n    }\n\n    set dieSize(ds) {\n        if (!Number.isInteger(ds) || 0 >= ds) {\n            throw new ConfigurationError(`dieSize should be a number larger than 1, got '${ds}' instead.`);\n        }\n        _dieSize.set(this, ds);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    get rotate() {\n        const r = _rotate.get(this);\n        return undefined === r ? true : r;\n    }\n\n    set rotate(r) {\n        _rotate.set(this, r);\n    }\n\n    /**\n     * The number of rows in this GridLayout.\n     *\n     * @return {Number} The number of rows, 0 < rows.\n     * @private\n     */\n    get _rows() {\n        return _rows.get(this);\n    }\n\n    /**\n     * The number of columns in this GridLayout.\n     *\n     * @return {Number} The number of columns, 0 < columns.\n     * @private\n     */\n    get _cols() {\n        return _cols.get(this);\n    }\n\n    /**\n     * The center cell in this GridLayout.\n     *\n     * @return {Object} The center (row, col).\n     * @private\n     */\n    get _center() {\n        const row = randomizeCenter(this._rows / 2) - 1;\n        const col = randomizeCenter(this._cols / 2) - 1;\n\n        return {row, col};\n    }\n\n    /**\n     * Layout dice on this GridLayout.\n     *\n     * @param {TopDie[]} dice - The dice to layout on this Layout.\n     * @return {TopDie[]} The same list of dice, but now layout.\n     *\n     * @throws {ConfigurationError} The number of\n     * dice should not exceed the maximum number of dice this Layout can\n     * layout.\n     */\n    layout(dice) {\n        if (dice.length > this.maximumNumberOfDice) {\n            throw new ConfigurationError(`The number of dice that can be layout is ${this.maximumNumberOfDice}, got ${dice.lenght} dice instead.`);\n        }\n\n        const alreadyLayoutDice = [];\n        const diceToLayout = [];\n\n        for (const die of dice) {\n            if (die.isHeld()) {\n                // Dice that are being held should keep their current coordinates and rotation. In other words,\n                // these dice are skipped.\n                alreadyLayoutDice.push(die);\n            } else {\n                diceToLayout.push(die);\n            }\n        }\n\n        const max = Math.min(dice.length * this.dispersion, this.maximumNumberOfDice);\n        const availableCells = this._computeAvailableCells(max, alreadyLayoutDice);\n\n        for (const die of diceToLayout) {\n            const randomIndex = Math.floor(Math.random() * availableCells.length);\n            const randomCell = availableCells[randomIndex];\n            availableCells.splice(randomIndex, 1);\n\n            die.coordinates = this._numberToCoordinates(randomCell);\n            die.rotation = this.rotate ? Math.round(Math.random() * FULL_CIRCLE_IN_DEGREES) : null;\n            alreadyLayoutDice.push(die);\n        }\n\n        _dice.set(this, alreadyLayoutDice);\n\n        return alreadyLayoutDice;\n    }\n\n    /**\n     * Compute a list with available cells to place dice on.\n     *\n     * @param {Number} max - The number empty cells to compute.\n     * @param {TopDie[]} alreadyLayoutDice - A list with dice that have already been layout.\n     * \n     * @return {Number[]} The list of available cells represented by their number.\n     * @private\n     */\n    _computeAvailableCells(max, alreadyLayoutDice) {\n        const available = new Set();\n        let level = 0;\n        const maxLevel = Math.min(this._rows, this._cols);\n\n        while (available.size < max && level < maxLevel) {\n            for (const cell of this._cellsOnLevel(level)) {\n                if (undefined !== cell && this._cellIsEmpty(cell, alreadyLayoutDice)) {\n                    available.add(cell);\n                }\n            }\n\n            level++;\n        }\n\n        return Array.from(available);\n    }\n\n    /**\n     * Calculate all cells on level from the center of the layout.\n     *\n     * @param {Number} level - The level from the center of the layout. 0\n     * indicates the center.\n     *\n     * @return {Set<Number>} the cells on the level in this layout represented by\n     * their number.\n     * @private\n     */\n    _cellsOnLevel(level) {\n        const cells = new Set();\n        const center = this._center;\n\n        if (0 === level) {\n            cells.add(this._cellToNumber(center));\n        } else {\n            for (let row = center.row - level; row <= center.row + level; row++) {\n                cells.add(this._cellToNumber({row, col: center.col - level}));\n                cells.add(this._cellToNumber({row, col: center.col + level}));\n            }\n\n            for (let col = center.col - level + 1; col < center.col + level; col++) {\n                cells.add(this._cellToNumber({row: center.row - level, col}));\n                cells.add(this._cellToNumber({row: center.row + level, col}));\n            }\n        }\n\n        return cells;\n    }\n\n    /**\n     * Does cell contain a cell from alreadyLayoutDice?\n     *\n     * @param {Number} cell - A cell in layout represented by a number.\n     * @param {TopDie[]} alreadyLayoutDice - A list of dice that have already been layout.\n     *\n     * @return {Boolean} True if cell does not contain a die.\n     * @private\n     */\n    _cellIsEmpty(cell, alreadyLayoutDice) {\n        return undefined === alreadyLayoutDice.find(die => cell === this._coordinatesToNumber(die.coordinates));\n    }\n\n    /**\n     * Convert a number to a cell (row, col)\n     *\n     * @param {Number} n - The number representing a cell\n     * @returns {Object} Return the cell ({row, col}) corresponding n.\n     * @private\n     */\n    _numberToCell(n) {\n        return {row: Math.trunc(n / this._cols), col: n % this._cols};\n    }\n\n    /**\n     * Convert a cell to a number\n     *\n     * @param {Object} cell - The cell to convert to its number.\n     * @return {Number|undefined} The number corresponding to the cell.\n     * Returns undefined when the cell is not on the layout\n     * @private\n     */\n    _cellToNumber({row, col}) {\n        if (0 <= row && row < this._rows && 0 <= col && col < this._cols) {\n            return row * this._cols + col;\n        }\n        return undefined;\n    }\n\n    /**\n     * Convert a cell represented by its number to their coordinates.\n     *\n     * @param {Number} n - The number representing a cell\n     *\n     * @return {Object} The coordinates corresponding to the cell represented by\n     * this number.\n     * @private\n     */\n    _numberToCoordinates(n) {\n        return this._cellToCoords(this._numberToCell(n));\n    }\n\n    /**\n     * Convert a pair of coordinates to a number.\n     *\n     * @param {Object} coords - The coordinates to convert\n     *\n     * @return {Number|undefined} The coordinates converted to a number. If\n     * the coordinates are not on this layout, the number is undefined.\n     * @private\n     */\n    _coordinatesToNumber(coords) {\n        const n = this._cellToNumber(this._coordsToCell(coords));\n        if (0 <= n && n < this.maximumNumberOfDice) {\n            return n;\n        }\n        return undefined;\n    }\n\n    /**\n     * Snap (x,y) to the closest cell in this Layout.\n     *\n     * @param {Object} diecoordinate - The coordinate to find the closest cell\n     * for.\n     * @param {TopDie} [diecoordinat.die = null] - The die to snap to.\n     * @param {Number} diecoordinate.x - The x-coordinate.\n     * @param {Number} diecoordinate.y - The y-coordinate.\n     *\n     * @return {Object|null} The coordinate of the cell closest to (x, y).\n     * Null when no suitable cell is near (x, y)\n     */\n    snapTo({die = null, x, y}) {\n        const cornerCell = {\n            row: Math.trunc(y / this.dieSize),\n            col: Math.trunc(x / this.dieSize)\n        };\n\n        const corner = this._cellToCoords(cornerCell);\n        const widthIn = corner.x + this.dieSize - x;\n        const widthOut = this.dieSize - widthIn;\n        const heightIn = corner.y + this.dieSize - y;\n        const heightOut = this.dieSize - heightIn;\n\n        const quadrants = [{\n            q: this._cellToNumber(cornerCell),\n            coverage: widthIn * heightIn\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row,\n                col: cornerCell.col + 1\n            }),\n            coverage: widthOut * heightIn\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row + 1,\n                col: cornerCell.col\n            }),\n            coverage: widthIn * heightOut\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row + 1,\n                col: cornerCell.col + 1\n            }),\n            coverage: widthOut * heightOut\n        }];\n\n        const snapTo = quadrants\n            // cell should be on the layout\n            .filter((quadrant) => undefined !== quadrant.q)\n            // cell should be not already taken except by itself\n            .filter((quadrant) => (\n                null !== die && this._coordinatesToNumber(die.coordinates) === quadrant.q)\n                || this._cellIsEmpty(quadrant.q, _dice.get(this)))\n            // cell should be covered by the die the most\n            .reduce(\n                (maxQ, quadrant) => quadrant.coverage > maxQ.coverage ? quadrant : maxQ,\n                {q: undefined, coverage: -1}\n            );\n\n        return undefined !== snapTo.q ? this._numberToCoordinates(snapTo.q) : null;\n    }\n\n    /**\n     * Get the die at point (x, y);\n     *\n     * @param {Point} point - The point in (x, y) coordinates\n     * @return {TopDie|null} The die under coordinates (x, y) or null if no die\n     * is at the point.\n     */\n    getAt(point = {x: 0, y: 0}) {\n        for (const die of _dice.get(this)) {\n            const {x, y} = die.coordinates;\n\n            const xFit = x <= point.x && point.x <= x + this.dieSize;\n            const yFit = y <= point.y && point.y <= y + this.dieSize;\n\n            if (xFit && yFit) {\n                return die;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Calculate the grid size given width and height.\n     *\n     * @param {Number} width - The minimal width\n     * @param {Number} height - The minimal height\n     *\n     * @private\n     */\n    _calculateGrid(width, height) {\n        _cols.set(this, Math.floor(width / this.dieSize));\n        _rows.set(this, Math.floor(height / this.dieSize));\n    }\n\n    /**\n     * Convert a (row, col) cell to (x, y) coordinates.\n     *\n     * @param {Object} cell - The cell to convert to coordinates\n     * @return {Object} The corresponding coordinates.\n     * @private\n     */\n    _cellToCoords({row, col}) {\n        return {x: col * this.dieSize, y: row * this.dieSize};\n    }\n\n    /**\n     * Convert (x, y) coordinates to a (row, col) cell.\n     *\n     * @param {Object} coordinates - The coordinates to convert to a cell.\n     * @return {Object} The corresponding cell\n     * @private\n     */\n    _coordsToCell({x, y}) {\n        return {\n            row: Math.trunc(y / this.dieSize),\n            col: Math.trunc(x / this.dieSize)\n        };\n    }\n};\n\nexport {GridLayout};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n/**\n * @module mixin/ReadOnlyAttributes\n */\n\n/*\n * Convert an HTML attribute to an instance's property. \n *\n * @param {String} name - The attribute's name\n * @return {String} The corresponding property's name. For example, \"my-attr\"\n * will be converted to \"myAttr\", and \"disabled\" to \"disabled\".\n */\nconst attribute2property = (name) => {\n    const [first, ...rest] = name.split(\"-\");\n    return first + rest.map(word => word.slice(0, 1).toUpperCase() + word.slice(1)).join();\n};\n\n/**\n * Mixin {@link ReadOnlyAttributes} to a class.\n *\n * @param {*} Sup - The class to mix into.\n * @return {ReadOnlyAttributes} The mixed-in class\n */\nconst ReadOnlyAttributes = (Sup) =>\n    /**\n     * Mixin to make all attributes on a custom HTMLElement read-only in the sense\n     * that when the attribute gets a new value that differs from the value of the\n     * corresponding property, it is reset to that property's value. The\n     * assumption is that attribute \"my-attribute\" corresponds with property \"this.myAttribute\".\n     *\n     * @param {Class} Sup - The class to mixin this ReadOnlyAttributes.\n     * @return {ReadOnlyAttributes} The mixed in class.\n     *\n     * @mixin\n     * @alias ReadOnlyAttributes\n     */\n    class extends Sup {\n\n        /**\n         * Callback that is executed when an observed attribute's value is\n         * changed. If the HTMLElement is connected to the DOM, the attribute\n         * value can only be set to the corresponding HTMLElement's property.\n         * In effect, this makes this HTMLElement's attributes read-only.\n         *\n         * For example, if an HTMLElement has an attribute \"x\" and\n         * corresponding property \"x\", then changing the value \"x\" to \"5\"\n         * will only work when `this.x === 5`.\n         *\n         * @param {String} name - The attribute's name.\n         * @param {String} oldValue - The attribute's old value.\n         * @param {String} newValue - The attribute's new value.\n         */\n        attributeChangedCallback(name, oldValue, newValue) {\n            // All attributes are made read-only to prevent cheating by changing\n            // the attribute values. Of course, this is by no\n            // guarantee that users will not cheat in a different way.\n            const property = attribute2property(name);\n            if (this.connected && newValue !== `${this[property]}`) {\n                this.setAttribute(name, this[property]);\n            }\n        }\n    };\n\nexport {\n    ReadOnlyAttributes\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nconst ValidationError = class extends Error {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    ValidationError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./error/ValidationError.js\";\n\nconst _value = new WeakMap();\nconst _defaultValue = new WeakMap();\nconst _errors = new WeakMap();\n\nconst TypeValidator = class {\n    constructor({value, defaultValue, errors = []}) {\n        _value.set(this, value);\n        _defaultValue.set(this, defaultValue);\n        _errors.set(this, errors);\n    }\n\n    get origin() {\n        return _value.get(this);\n    }\n\n    get value() {\n        return this.isValid ? this.origin : _defaultValue.get(this);\n    }\n\n    get errors() {\n        return _errors.get(this);\n    }\n\n    get isValid() {\n        return 0 >= this.errors.length;\n    }\n\n    defaultTo(newDefault) {\n        _defaultValue.set(this, newDefault);\n        return this;\n    }\n\n    _check({predicate, bindVariables = [], ErrorType = ValidationError}) {\n        const proposition = predicate.apply(this, bindVariables);\n        if (!proposition) {\n            const error = new ErrorType(this.value, bindVariables);\n            //console.warn(error.toString());\n            this.errors.push(error);\n        }\n\n        return this;\n    }\n};\n\nexport {\n    TypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./ValidationError.js\";\n\nconst ParseError = class extends ValidationError {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    ParseError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./ValidationError.js\";\n\nconst InvalidTypeError = class extends ValidationError {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    InvalidTypeError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst INTEGER_DEFAULT_VALUE = 0;\nconst IntegerTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = INTEGER_DEFAULT_VALUE;\n        const defaultValue = INTEGER_DEFAULT_VALUE;\n        const errors = [];\n\n        if (Number.isInteger(input)) {\n            value = input;\n        } else if (\"string\" === typeof input) {\n            const parsedValue = parseInt(input, 10);\n            if (Number.isInteger(parsedValue)) {\n                value = parsedValue;\n            } else {\n                errors.push(new ParseError(input));\n            }\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    largerThan(n) {\n        return this._check({\n            predicate: (n) => this.origin >= n,\n            bindVariables: [n]\n        });\n    }\n\n    smallerThan(n) {\n        return this._check({\n            predicate: (n) => this.origin <= n,\n            bindVariables: [n]\n        });\n    }\n\n    between(n, m) {\n        return this._check({\n            predicate: (n, m) => this.largerThan(n) && this.smallerThan(m),\n            bindVariables: [n, m]\n        });\n    }\n};\n\nexport {\n    IntegerTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst STRING_DEFAULT_VALUE = \"\";\nconst StringTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = STRING_DEFAULT_VALUE;\n        const defaultValue = STRING_DEFAULT_VALUE;\n        const errors = [];\n\n        if (\"string\" === typeof input) {\n            value = input;\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    notEmpty() {\n        return this._check({\n            predicate: () => \"\" !== this.origin\n        });\n    }\n};\n\nexport {\n    StringTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\n//import {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst COLOR_DEFAULT_VALUE = \"black\";\nconst ColorTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = COLOR_DEFAULT_VALUE;\n        const defaultValue = COLOR_DEFAULT_VALUE;\n        const errors = [];\n\n        if (\"string\" === typeof input) {\n            value = input;\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n};\n\nexport {\n    ColorTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst BOOLEAN_DEFAULT_VALUE = false;\nconst BooleanTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = BOOLEAN_DEFAULT_VALUE;\n        const defaultValue = BOOLEAN_DEFAULT_VALUE;\n        const errors = [];\n\n        if (input instanceof Boolean) {\n            value = input;\n        } else if (\"string\" === typeof input) {\n            if (/true/i.test(input)) {\n                value = true;\n            } else if (/false/i.test(input)) {\n                value = false;\n            } else {\n                errors.push(new ParseError(input));\n            }\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    isTrue() {\n        return this._check({\n            predicate: () => true === this.origin\n        });\n    }\n\n    isFalse() {\n        return this._check({\n            predicate: () => false === this.origin\n        });\n    }\n};\n\nexport {\n    BooleanTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {IntegerTypeValidator} from \"./IntegerTypeValidator.js\";\nimport {StringTypeValidator} from \"./StringTypeValidator.js\";\nimport {ColorTypeValidator} from \"./ColorTypeValidator.js\";\nimport {BooleanTypeValidator} from \"./BooleanTypeValidator.js\";\n\nconst Validator = class {\n    constructor() {\n    }\n\n    boolean(input) {\n        return new BooleanTypeValidator(input);\n    }\n\n    color(input) {\n        return new ColorTypeValidator(input);\n    }\n\n    integer(input) {\n        return new IntegerTypeValidator(input);\n    }\n\n    string(input) {\n        return new StringTypeValidator(input);\n    }\n\n};\n\nconst ValidatorSingleton = new Validator();\n\nexport {\n    ValidatorSingleton as validate\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {ReadOnlyAttributes} from \"./mixin/ReadOnlyAttributes.js\";\nimport {validate} from \"./validate/validate.js\";\n\nconst TAG_NAME = \"top-player\";\n\n// The names of the (observed) attributes of the TopPlayer.\nconst COLOR_ATTRIBUTE = \"color\";\nconst NAME_ATTRIBUTE = \"name\";\nconst SCORE_ATTRIBUTE = \"score\";\nconst HAS_TURN_ATTRIBUTE = \"has-turn\";\n\n// The private properties of the TopPlayer \nconst _color = new WeakMap();\nconst _name = new WeakMap();\nconst _score = new WeakMap();\nconst _hasTurn = new WeakMap();\n\n/**\n * A Player in a dice game.\n *\n * A player's name should be unique in the game. Two different\n * TopPlayer elements with the same name attribute are treated as\n * the same player.\n *\n * In general it is recommended that no two players do have the same color,\n * although it is not unconceivable that certain dice games have players work\n * in teams where it would make sense for two or more different players to\n * have the same color.\n *\n * The name and color attributes are required. The score and has-turn\n * attributes are not.\n *\n * @extends HTMLElement\n * @mixes ReadOnlyAttributes\n */\nconst TopPlayer = class extends ReadOnlyAttributes(HTMLElement) {\n\n    /**\n     * Create a new TopPlayer, optionally based on an intitial\n     * configuration via an object parameter or declared attributes in HTML.\n     *\n     * @param {Object} [config] - An initial configuration for the\n     * player to create.\n     * @param {String} config.color - This player's color used in the game.\n     * @param {String} config.name - This player's name.\n     * @param {Number} [config.score] - This player's score.\n     * @param {Boolean} [config.hasTurn] - This player has a turn.\n     */\n    constructor({color, name, score, hasTurn} = {}) {\n        super();\n\n        const colorValue = validate.color(color || this.getAttribute(COLOR_ATTRIBUTE));\n        if (colorValue.isValid) {\n            _color.set(this, colorValue.value);\n            this.setAttribute(COLOR_ATTRIBUTE, this.color);\n        } else {\n            throw new ConfigurationError(\"A Player needs a color, which is a String.\");\n        }\n\n        const nameValue = validate.string(name || this.getAttribute(NAME_ATTRIBUTE));\n        if (nameValue.isValid) {\n            _name.set(this, name);\n            this.setAttribute(NAME_ATTRIBUTE, this.name);\n        } else {\n            throw new ConfigurationError(\"A Player needs a name, which is a String.\");\n        }\n\n        const scoreValue = validate.integer(score || this.getAttribute(SCORE_ATTRIBUTE));\n        if (scoreValue.isValid) {\n            _score.set(this, score);\n            this.setAttribute(SCORE_ATTRIBUTE, this.score);\n        } else {\n            // Okay. A player does not need to have a score.\n            _score.set(this, null);\n            this.removeAttribute(SCORE_ATTRIBUTE);\n        }\n\n        const hasTurnValue = validate.boolean(hasTurn || this.getAttribute(HAS_TURN_ATTRIBUTE))\n            .isTrue();\n        if (hasTurnValue.isValid) {\n            _hasTurn.set(this, hasTurn);\n            this.setAttribute(HAS_TURN_ATTRIBUTE, hasTurn);\n        } else {\n            // Okay, A player does not always have a turn.\n            _hasTurn.set(this, null);\n            this.removeAttribute(HAS_TURN_ATTRIBUTE);\n        }\n    }\n\n    static get observedAttributes() {\n        return [\n            COLOR_ATTRIBUTE,\n            NAME_ATTRIBUTE,\n            SCORE_ATTRIBUTE,\n            HAS_TURN_ATTRIBUTE\n        ];\n    }\n\n    connectedCallback() {\n    }\n\n    disconnectedCallback() {\n    }\n\n    /**\n     * This player's color.\n     *\n     * @type {String}\n     */\n    get color() {\n        return _color.get(this);\n    }\n\n    /**\n     * This player's name.\n     *\n     * @type {String}\n     */\n    get name() {\n        return _name.get(this);\n    }\n\n    /**\n     * This player's score.\n     *\n     * @type {Number}\n     */\n    get score() {\n        return null === _score.get(this) ? 0 : _score.get(this);\n    }\n    set score(newScore) {\n        _score.set(this, newScore);\n        if (null === newScore) {\n            this.removeAttribute(SCORE_ATTRIBUTE);\n        } else {\n            this.setAttribute(SCORE_ATTRIBUTE, newScore);\n        }\n    }\n\n    /**\n     * Start a turn for this player.\n     *\n     * @return {TopPlayer} The player with a turn\n     */\n    startTurn() {\n        if (this.isConnected) {\n            this.parentNode.dispatchEvent(new CustomEvent(\"top:start-turn\", {\n                detail: {\n                    player: this\n                }\n            }));\n        }\n        _hasTurn.set(this, true);\n        this.setAttribute(HAS_TURN_ATTRIBUTE, true);\n        return this;\n    }\n\n    /**\n     * End a turn for this player.\n     */\n    endTurn() {\n        _hasTurn.set(this, null);\n        this.removeAttribute(HAS_TURN_ATTRIBUTE);\n    }\n\n    /**\n     * Does this player have a turn?\n     *\n     * @type {Boolean}\n     */\n    get hasTurn() {\n        return true === _hasTurn.get(this);\n    }\n\n    /**\n     * A String representation of this player, his or hers name.\n     *\n     * @return {String} The player's name represents the player as a string.\n     */\n    toString() {\n        return `${this.name}`;\n    }\n\n    /**\n     * Is this player equal another player?\n     * \n     * @param {TopPlayer} other - The other player to compare this player with.\n     * @return {Boolean} True when either the object references are the same\n     * or when both name and color are the same.\n     */\n    equals(other) {\n        const sameName = other.name === this.name;\n        const sameColor = other.color === this.color;\n        return other === this || (sameName && sameColor);\n    }\n};\n\nwindow.customElements.define(TAG_NAME, TopPlayer);\n\n/**\n * The default system player. Dice are thrown by a player. For situations\n * where you want to render a bunch of dice without needing the concept of Players\n * this DEFAULT_SYSTEM_PLAYER can be a substitute. Of course, if you'd like to\n * change the name and/or the color, create and use your own \"system player\".\n * @const\n */\nconst DEFAULT_SYSTEM_PLAYER = new TopPlayer({color: \"red\", name: \"*\"});\n\nexport {\n    TopPlayer,\n    DEFAULT_SYSTEM_PLAYER,\n    TAG_NAME,\n    HAS_TURN_ATTRIBUTE\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n//import {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {ReadOnlyAttributes} from \"./mixin/ReadOnlyAttributes.js\";\nimport {validate} from \"./validate/validate.js\";\nimport {TopPlayer} from \"./TopPlayer.js\";\n\nconst TAG_NAME = \"top-die\";\n\nconst CIRCLE_DEGREES = 360; // degrees\nconst NUMBER_OF_PIPS = 6; // Default / regular six sided die has 6 pips maximum.\nconst DEFAULT_COLOR = \"Ivory\";\nconst DEFAULT_X = 0; // px\nconst DEFAULT_Y = 0; // px\nconst DEFAULT_ROTATION = 0; // degrees\nconst DEFAULT_OPACITY = 0.5;\n\nconst COLOR_ATTRIBUTE = \"color\";\nconst HELD_BY_ATTRIBUTE = \"held-by\";\nconst PIPS_ATTRIBUTE = \"pips\";\nconst ROTATION_ATTRIBUTE = \"rotation\";\nconst X_ATTRIBUTE = \"x\";\nconst Y_ATTRIBUTE = \"y\";\n\nconst BASE_DIE_SIZE = 100; // px\nconst BASE_ROUNDED_CORNER_RADIUS = 15; // px\nconst BASE_STROKE_WIDTH = 2.5; // px\nconst MIN_STROKE_WIDTH = 1; // px\nconst HALF = BASE_DIE_SIZE / 2; // px\nconst THIRD = BASE_DIE_SIZE / 3; // px\nconst PIP_SIZE = BASE_DIE_SIZE / 15; //px\nconst PIP_COLOR = \"black\";\n\nconst deg2rad = (deg) => {\n    return deg * (Math.PI / 180);\n};\n\nconst isPipNumber = n => {\n    const number = parseInt(n, 10);\n    return Number.isInteger(number) && 1 <= number && number <= NUMBER_OF_PIPS;\n};\n\n/**\n * Generate a random number of pips between 1 and the NUMBER_OF_PIPS.\n *\n * @returns {Number} A random number n, 1  n  NUMBER_OF_PIPS.\n */\nconst randomPips = () => Math.floor(Math.random() * NUMBER_OF_PIPS) + 1;\n\nconst DIE_UNICODE_CHARACTERS = [\"\",\"\",\"\",\"\",\"\",\"\"];\n\n/**\n * Convert a unicode character representing a die face to the number of pips of\n * that same die. This function is the reverse of pipsToUnicode.\n *\n * @param {String} u - The unicode character to convert to pips.\n * @returns {Number|undefined} The corresponding number of pips, 1  pips  6, or\n * undefined if u was not a unicode character representing a die.\n */\nconst unicodeToPips = (u) => {\n    const dieCharIndex = DIE_UNICODE_CHARACTERS.indexOf(u);\n    return 0 <= dieCharIndex ? dieCharIndex + 1 : undefined;\n};\n\n/**\n * Convert a number of pips, 1  pips  6 to a unicode character\n * representation of the corresponding die face. This function is the reverse\n * of unicodeToPips.\n *\n * @param {Number} p - The number of pips to convert to a unicode character.\n * @returns {String|undefined} The corresponding unicode characters or\n * undefined if p was not between 1 and 6 inclusive.\n */\nconst pipsToUnicode = p => isPipNumber(p) ? DIE_UNICODE_CHARACTERS[p - 1] : undefined;\n\nconst renderHold = (context, x, y, width, color) => {\n    const SEPERATOR = width / 30;\n    context.save();\n    context.globalAlpha = DEFAULT_OPACITY;\n    context.beginPath();\n    context.fillStyle = color;\n    context.arc(x + width, y + width, width - SEPERATOR, 0, 2 * Math.PI, false);\n    context.fill();\n    context.restore();\n};\n\nconst renderDie = (context, x, y, width, color) => {\n    const SCALE = (width / HALF);\n    const HALF_INNER_SIZE = Math.sqrt(width ** 2 / 2);\n    const INNER_SIZE = 2 * HALF_INNER_SIZE;\n    const ROUNDED_CORNER_RADIUS = BASE_ROUNDED_CORNER_RADIUS * SCALE;\n    const INNER_SIZE_ROUNDED = INNER_SIZE - 2 * ROUNDED_CORNER_RADIUS;\n    const STROKE_WIDTH = Math.max(MIN_STROKE_WIDTH, BASE_STROKE_WIDTH * SCALE);\n\n    const startX = x + width - HALF_INNER_SIZE + ROUNDED_CORNER_RADIUS;\n    const startY = y + width - HALF_INNER_SIZE;\n\n    context.save();\n    context.beginPath();\n    context.fillStyle = color;\n    context.strokeStyle = \"black\";\n    context.lineWidth = STROKE_WIDTH;\n    context.moveTo(startX, startY);\n    context.lineTo(startX + INNER_SIZE_ROUNDED, startY);\n    context.arc(startX + INNER_SIZE_ROUNDED, startY + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(270), deg2rad(0));\n    context.lineTo(startX + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS);\n    context.arc(startX + INNER_SIZE_ROUNDED, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(0), deg2rad(90));\n    context.lineTo(startX, startY + INNER_SIZE);\n    context.arc(startX, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(90), deg2rad(180));\n    context.lineTo(startX - ROUNDED_CORNER_RADIUS, startY + ROUNDED_CORNER_RADIUS);\n    context.arc(startX, startY + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(180), deg2rad(270));\n\n    context.stroke();\n    context.fill();\n    context.restore();\n};\n\nconst renderPip = (context, x, y, width) => {\n    context.save();\n    context.beginPath();\n    context.fillStyle = PIP_COLOR;\n    context.moveTo(x, y);\n    context.arc(x, y, width, 0, 2 * Math.PI, false);\n    context.fill();\n    context.restore();\n};\n\n\n// Private properties\nconst _board = new WeakMap();\nconst _color = new WeakMap();\nconst _heldBy = new WeakMap();\nconst _pips = new WeakMap();\nconst _rotation = new WeakMap();\nconst _x = new WeakMap();\nconst _y = new WeakMap();\n\n/**\n * TopDie is the \"top-die\" custom [HTML\n * element](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement) representing a die\n * on the dice board.\n *\n * @extends HTMLElement\n * @mixes ReadOnlyAttributes\n */\nconst TopDie = class extends ReadOnlyAttributes(HTMLElement) {\n\n    /**\n     * Create a new TopDie.\n     *\n     * @param {Object} [config = {}] - The initial configuration of the die.\n     * @param {Number|null} [config.pips] - The pips of the die to add.\n     * If no pips are specified or the pips are not between 1 and 6, a random\n     * number between 1 and 6 is generated instead.\n     * @param {String} [config.color] - The color of the die to add. Default\n     * to the default color.\n     * @param {Number} [config.x] - The x coordinate of the die.\n     * @param {Number} [config.y] - The y coordinate of the die.\n     * @param {Number} [config.rotation] - The rotation of the die.\n     * @param {TopPlayer} [config.heldBy] - The player holding the die.\n     */\n    constructor({pips, color, rotation, x, y, heldBy} = {}) {\n        super();\n\n        const pipsValue = validate.integer(pips || this.getAttribute(PIPS_ATTRIBUTE))\n            .between(1, 6)\n            .defaultTo(randomPips())\n            .value;\n\n        _pips.set(this, pipsValue);\n        this.setAttribute(PIPS_ATTRIBUTE, pipsValue);\n\n        this.color = validate.color(color || this.getAttribute(COLOR_ATTRIBUTE))\n            .defaultTo(DEFAULT_COLOR)\n            .value;\n\n        this.rotation = validate.integer(rotation || this.getAttribute(ROTATION_ATTRIBUTE))\n            .between(0, 360)\n            .defaultTo(DEFAULT_ROTATION)\n            .value;\n\n        this.x = validate.integer(x || this.getAttribute(X_ATTRIBUTE))\n            .largerThan(0)\n            .defaultTo(DEFAULT_X)\n            .value;\n\n        this.y = validate.integer(y || this.getAttribute(Y_ATTRIBUTE))\n            .largerThan(0)\n            .defaultTo(DEFAULT_Y)\n            .value;\n\n        // Todo: validate that TopPlayer is on the same board as Die?\n        this.heldBy = heldBy instanceof TopPlayer ? heldBy : document.querySelector(this.getAttribute(HELD_BY_ATTRIBUTE));\n    }\n\n    static get observedAttributes() {\n        return [\n            COLOR_ATTRIBUTE,\n            HELD_BY_ATTRIBUTE,\n            PIPS_ATTRIBUTE,\n            ROTATION_ATTRIBUTE,\n            X_ATTRIBUTE,\n            Y_ATTRIBUTE\n        ];\n    }\n\n    connectedCallback() {\n        _board.set(this, this.parentNode);\n        _board.get(this).dispatchEvent(new Event(\"top-die:added\"));\n    }\n\n    disconnectedCallback() {\n        _board.get(this).dispatchEvent(new Event(\"top-die:removed\"));\n        _board.set(this, null);\n    }\n\n    /**\n     * Convert this Die to the corresponding unicode character of a die face.\n     *\n     * @return {String} The unicode character corresponding to the number of\n     * pips of this Die.\n     */\n    toUnicode() {\n        return pipsToUnicode(this.pips);\n    }\n\n    /**\n     * Create a string represenation for this die.\n     *\n     * @return {String} The unicode symbol corresponding to the number of pips\n     * of this die.\n     */\n    toString() {\n        return this.toUnicode();\n    }\n\n    /**\n     * This Die's number of pips, 1  pips  6.\n     *\n     * @type {Number}\n     */\n    get pips() {\n        return _pips.get(this);\n    }\n\n    /**\n     * This Die's color.\n     *\n     * @type {String}\n     */\n    get color() {\n        return _color.get(this);\n    }\n    set color(newColor) {\n        if (null === newColor) {\n            this.removeAttribute(COLOR_ATTRIBUTE);\n            _color.set(this, DEFAULT_COLOR);\n        } else {\n            _color.set(this, newColor);\n            this.setAttribute(COLOR_ATTRIBUTE, newColor);\n        }\n    }\n\n\n    /**\n     * The player that is holding this Die, if any. Null otherwise.\n     *\n     * @type {TopPlayer|null} \n     */\n    get heldBy() {\n        return _heldBy.get(this);\n    }\n    set heldBy(player) {\n        _heldBy.set(this, player);\n        if (null === player) {\n            this.removeAttribute(\"held-by\");\n        } else {\n            this.setAttribute(\"held-by\", player.toString());\n        }\n    }\n\n    /**\n     * The coordinates of this Die.\n     *\n     * @type {Coordinates|null}\n     */\n    get coordinates() {\n        return null === this.x || null === this.y ? null : {x: this.x, y: this.y};\n    }\n    set coordinates(c) {\n        if (null === c) {\n            this.x = null;\n            this.y = null;\n        } else{\n            const {x, y} = c;\n            this.x = x;\n            this.y = y;\n        }\n    }\n\n    /**\n     * The x coordinate\n     *\n     * @type {Number}\n     */\n    get x() {\n        return _x.get(this);\n    }\n    set x(newX) {\n        _x.set(this, newX);\n        this.setAttribute(\"x\", newX);\n    }\n\n    /**\n     * The y coordinate\n     *\n     * @type {Number}\n     */\n    get y() {\n        return _y.get(this);\n    }\n    set y(newY) {\n        _y.set(this, newY);\n        this.setAttribute(\"y\", newY);\n    }\n\n    /**\n     * The rotation of this Die. 0  rotation  360.\n     *\n     * @type {Number|null}\n     */\n    get rotation() {\n        return _rotation.get(this);\n    }\n    set rotation(newR) {\n        if (null === newR) {\n            this.removeAttribute(\"rotation\");\n        } else {\n            const normalizedRotation = newR % CIRCLE_DEGREES;\n            _rotation.set(this, normalizedRotation);\n            this.setAttribute(\"rotation\", normalizedRotation);\n        }\n    }\n\n    /**\n     * Throw this Die. The number of pips to a random number n, 1  n  6.\n     * Only dice that are not being held can be thrown.\n     *\n     * @fires \"top:throw-die\" with parameters this Die.\n     */\n    throwIt() {\n        if (!this.isHeld()) {\n            _pips.set(this, randomPips());\n            this.setAttribute(PIPS_ATTRIBUTE, this.pips);\n            this.dispatchEvent(new CustomEvent(\"top:throw-die\", {\n                detail: {\n                    die: this\n                }\n            }));\n        }\n    }\n\n    /**\n     * The player holds this Die. A player can only hold a die that is not\n     * being held by another player yet.\n     *\n     * @param {TopPlayer} player - The player who wants to hold this Die.\n     * @fires \"top:hold-die\" with parameters this Die and the player.\n     */\n    holdIt(player) {\n        if (!this.isHeld()) {\n            this.heldBy = player;\n            this.dispatchEvent(new CustomEvent(\"top:hold-die\", {\n                detail: {\n                    die: this,\n                    player\n                }\n            }));\n        }\n    }\n\n    /**\n     * Is this Die being held by any player?\n     *\n     * @return {Boolean} True when this Die is being held by any player, false otherwise.\n     */\n    isHeld() {\n        return null !== this.heldBy;\n    }\n\n    /**\n     * The player releases this Die. A player can only release dice that she is\n     * holding.\n     *\n     * @param {TopPlayer} player - The player who wants to release this Die.\n     * @fires \"top:relase-die\" with parameters this Die and the player releasing it.\n     */\n    releaseIt(player) {\n        if (this.isHeld() && this.heldBy.equals(player)) {\n            this.heldBy = null;\n            this.removeAttribute(HELD_BY_ATTRIBUTE);\n            this.dispatchEvent(new CustomEvent(\"top:release-die\", {\n                detail: {\n                    die: this,\n                    player\n                }\n            }));\n        }\n    }\n\n    /**\n     * Render this Die.\n     *\n     * @param {CanvasRenderingContext2D} context - The canvas context to draw\n     * on\n     * @param {Number} dieSize - The size of a die.\n     * @param {Number} [coordinates = this.coordinates] - The coordinates to\n     * draw this die. By default, this die is drawn at its own coordinates,\n     * but you can also draw it elsewhere if so needed.\n     */\n    render(context, dieSize, coordinates = this.coordinates) {\n        const scale = dieSize / BASE_DIE_SIZE;\n        const SHALF = HALF * scale;\n        const STHIRD = THIRD * scale;\n        const SPIP_SIZE = PIP_SIZE * scale;\n\n        const {x, y} = coordinates;\n\n        if (this.isHeld()) {\n            renderHold(context, x, y, SHALF, this.heldBy.color);\n        }\n\n        if (0 !== this.rotation) {\n            context.translate(x + SHALF, y + SHALF);\n            context.rotate(deg2rad(this.rotation));\n            context.translate(-1 * (x + SHALF), -1 * (y + SHALF));\n        }\n\n        renderDie(context, x, y, SHALF, this.color);\n\n        switch (this.pips) {\n        case 1: {\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            break;\n        }\n        case 2: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 3: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 4: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 5: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 6: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + SHALF, SPIP_SIZE);\n            break;\n        }\n        default: // No other values allowed / possible\n        }\n\n        // Clear context\n        context.setTransform(1, 0, 0, 1, 0, 0);\n    }\n};\n\nwindow.customElements.define(TAG_NAME, TopDie);\n\nexport {\n    TopDie,\n    unicodeToPips,\n    pipsToUnicode,\n    TAG_NAME\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {DEFAULT_SYSTEM_PLAYER, TAG_NAME as TOP_PLAYER} from \"./TopPlayer.js\";\n\nconst TAG_NAME = \"top-player-list\";\n\n/**\n * TopPlayerList to describe the players in the game.\n *\n * @extends HTMLElement\n */\nconst TopPlayerList = class extends HTMLElement {\n\n    /**\n     * Create a new TopPlayerList.\n     */\n    constructor() {\n        super();\n    }\n\n    connectedCallback() {\n        if (0 >= this.players.length) {\n            this.appendChild(DEFAULT_SYSTEM_PLAYER);\n        }\n\n        this.addEventListener(\"top:start-turn\", (event) => {\n            // Only one player can have a turn at any given time.\n            this.players\n                .filter(p => !p.equals(event.detail.player))\n                .forEach(p => p.endTurn());\n        });\n    }\n\n    disconnectedCallback() {\n    }\n\n    /**\n     * The players in this list.\n     *\n     * @type {TopPlayer[]}\n     */\n    get players() {\n        return [...this.getElementsByTagName(TOP_PLAYER)];\n    }\n};\n\nwindow.customElements.define(TAG_NAME, TopPlayerList);\n\nexport {\n    TopPlayerList,\n    TAG_NAME\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n//import {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {GridLayout} from \"./GridLayout.js\";\nimport {TopDie, TAG_NAME as TOP_DIE} from \"./TopDie.js\";\nimport {DEFAULT_SYSTEM_PLAYER, TopPlayer, TAG_NAME as TOP_PLAYER, HAS_TURN_ATTRIBUTE} from \"./TopPlayer.js\";\nimport {TAG_NAME as TOP_PLAYER_LIST} from \"./TopPlayerList.js\";\nimport {validate} from \"./validate/validate.js\";\n\nconst TAG_NAME = \"top-dice-board\";\n\nconst DEFAULT_DIE_SIZE = 100; // px\nconst DEFAULT_HOLD_DURATION = 375; // ms\nconst DEFAULT_DRAGGING_DICE_DISABLED = false;\nconst DEFAULT_HOLDING_DICE_DISABLED = false;\nconst DEFAULT_ROTATING_DICE_DISABLED = false;\n\nconst ROWS = 10;\nconst COLS = 10;\n\nconst DEFAULT_WIDTH = COLS * DEFAULT_DIE_SIZE; // px\nconst DEFAULT_HEIGHT = ROWS * DEFAULT_DIE_SIZE; // px\nconst DEFAULT_DISPERSION = Math.floor(ROWS / 2);\n\nconst MIN_DELTA = 3; //px\n\nconst WIDTH_ATTRIBUTE = \"width\";\nconst HEIGHT_ATTRIBUTE = \"height\";\nconst DISPERSION_ATTRIBUTE = \"dispersion\";\nconst DIE_SIZE_ATTRIBUTE = \"die-size\";\nconst DRAGGING_DICE_DISABLED_ATTRIBUTE = \"dragging-dice-disabled\";\nconst HOLDING_DICE_DISABLED_ATTRIBUTE = \"holding-dice-disabled\";\nconst ROTATING_DICE_DISABLED_ATTRIBUTE = \"rotating-dice-disabled\";\nconst HOLD_DURATION_ATTRIBUTE = \"hold-duration\";\n\nconst parseNumber = (numberString, defaultNumber = 0) => {\n    const number = parseInt(numberString, 10);\n    return Number.isNaN(number) ? defaultNumber : number;\n};\n\nconst getPositiveNumber = (numberString, defaultValue) => {\n    return validate.integer(numberString)\n        .largerThan(0)\n        .defaultTo(defaultValue)\n        .value;\n};\n\nconst getPositiveNumberAttribute = (element, name, defaultValue) => {\n    if (element.hasAttribute(name)) {\n        const valueString = element.getAttribute(name);\n        return getPositiveNumber(valueString, defaultValue);\n    }\n    return defaultValue;\n};\n\nconst getBoolean = (booleanString, trueValue, defaultValue) => {\n    if (trueValue === booleanString || \"true\" === booleanString) {\n        return true;\n    } else if (\"false\" === booleanString) {\n        return false;\n    } else {\n        return defaultValue;\n    }\n};\n\nconst getBooleanAttribute = (element, name, defaultValue) => {\n    if (element.hasAttribute(name)) {\n        const valueString = element.getAttribute(name);\n        return getBoolean(valueString, [valueString, \"true\"], [\"false\"], defaultValue);\n    }\n\n    return defaultValue;\n};\n\n// Private properties\nconst _canvas = new WeakMap();\nconst _layout = new WeakMap();\nconst _currentPlayer = new WeakMap();\nconst _numberOfReadyDice = new WeakMap();\n\nconst context = (board) => _canvas.get(board).getContext(\"2d\");\n\nconst getReadyDice = (board) => {\n    if (undefined === _numberOfReadyDice.get(board)) {\n        _numberOfReadyDice.set(board, 0);\n    }\n\n    return _numberOfReadyDice.get(board);\n};\n\nconst updateReadyDice = (board, update) => {\n    _numberOfReadyDice.set(board, getReadyDice(board) + update);\n};\n\nconst isReady = (board) => getReadyDice(board) === board.dice.length;\n\nconst updateBoard = (board, dice = board.dice) => {\n    if (isReady(board)) {\n        context(board).clearRect(0, 0, board.width, board.height);\n\n        for (const die of dice) {\n            die.render(context(board), board.dieSize);\n        }\n    }\n};\n\nconst addDie = (board) => {\n    updateReadyDice(board, 1);\n    if (isReady(board)) {\n        updateBoard(board, board.layout.layout(board.dice));\n    }\n};\n\nconst removeDie = (board) => {\n    updateBoard(board, board.layout.layout(board.dice));\n    updateReadyDice(board, -1);\n};\n\n\n// Interaction states\nconst NONE = Symbol(\"no_interaction\");\nconst HOLD = Symbol(\"hold\");\nconst MOVE = Symbol(\"move\");\nconst INDETERMINED = Symbol(\"indetermined\");\nconst DRAGGING = Symbol(\"dragging\");\n\n// Methods to handle interaction\nconst convertWindowCoordinatesToCanvas = (canvas, xWindow, yWindow) => {\n    const canvasBox = canvas.getBoundingClientRect();\n\n    const x = xWindow - canvasBox.left * (canvas.width / canvasBox.width);\n    const y = yWindow - canvasBox.top * (canvas.height / canvasBox.height);\n\n    return {x, y};\n};\n\nconst setupInteraction = (board) => {\n    const canvas = _canvas.get(board);\n\n    // Setup interaction\n    let origin = {};\n    let state = NONE;\n    let staticBoard = null;\n    let dieUnderCursor = null;\n    let holdTimeout = null;\n\n    const holdDie = () => {\n        if (HOLD === state || INDETERMINED === state) {\n            // toggle hold / release\n            const playerWithATurn = board.querySelector(`${TOP_PLAYER_LIST} ${TOP_PLAYER}[${HAS_TURN_ATTRIBUTE}]`);\n            if (dieUnderCursor.isHeld()) {\n                dieUnderCursor.releaseIt(playerWithATurn);\n            } else {\n                dieUnderCursor.holdIt(playerWithATurn);\n            }\n            state = NONE;\n\n            updateBoard(board);\n        }\n\n        holdTimeout = null;\n    };\n\n    const startHolding = () => {\n        holdTimeout = window.setTimeout(holdDie, board.holdDuration);\n    };\n\n    const stopHolding = () => {\n        window.clearTimeout(holdTimeout);\n        holdTimeout = null;\n    };\n\n    const startInteraction = (event) => {\n        if (NONE === state) {\n\n            origin = {\n                x: event.clientX,\n                y: event.clientY\n            };\n\n            dieUnderCursor = board.layout.getAt(convertWindowCoordinatesToCanvas(canvas, event.clientX, event.clientY));\n\n            if (null !== dieUnderCursor) {\n                // Only interaction with the board via a die\n                if (!board.disabledHoldingDice && !board.disabledDraggingDice) {\n                    state = INDETERMINED;\n                    startHolding();\n                } else if (!board.disabledHoldingDice) {\n                    state = HOLD;\n                    startHolding();\n                } else if (!board.disabledDraggingDice) {\n                    state = MOVE;\n                }\n            }\n\n        }\n    };\n\n    const showInteraction = (event) => {\n        const dieUnderCursor = board.layout.getAt(convertWindowCoordinatesToCanvas(canvas, event.clientX, event.clientY));\n        if (DRAGGING === state) {\n            canvas.style.cursor = \"grabbing\";\n        } else if (null !== dieUnderCursor) {\n            canvas.style.cursor = \"grab\";\n        } else {\n            canvas.style.cursor = \"default\";\n        }\n    };\n\n    const move = (event) => {\n        if (MOVE === state || INDETERMINED === state) {\n            // determine if a die is under the cursor\n            // Ignore small movements\n            const dx = Math.abs(origin.x - event.clientX);\n            const dy = Math.abs(origin.y - event.clientY);\n\n            if (MIN_DELTA < dx || MIN_DELTA < dy) {\n                state = DRAGGING;\n                stopHolding();\n\n                const diceWithoutDieUnderCursor = board.dice.filter(die => die !== dieUnderCursor);\n                updateBoard(board, diceWithoutDieUnderCursor);\n                staticBoard = context(board).getImageData(0, 0, canvas.width, canvas.height);\n            }\n        } else if (DRAGGING === state) {\n            const dx = origin.x - event.clientX;\n            const dy = origin.y - event.clientY;\n\n            const {x, y} = dieUnderCursor.coordinates;\n\n            context(board).putImageData(staticBoard, 0, 0);\n            dieUnderCursor.render(context(board), board.dieSize, {x: x - dx, y: y - dy});\n        }\n    };\n\n    const stopInteraction = (event) => {\n        if (null !== dieUnderCursor && DRAGGING === state) {\n            const dx = origin.x - event.clientX;\n            const dy = origin.y - event.clientY;\n\n            const {x, y} = dieUnderCursor.coordinates;\n\n            const snapToCoords = board.layout.snapTo({\n                die: dieUnderCursor,\n                x: x - dx,\n                y: y - dy,\n            });\n\n            const newCoords = null != snapToCoords ? snapToCoords : {x, y};\n\n            dieUnderCursor.coordinates = newCoords;\n        }\n\n        // Clear state\n        dieUnderCursor = null;\n        state = NONE;\n\n        // Refresh board; Render dice\n        updateBoard(board);\n    };\n\n\n    // Register the actual event listeners defined above. Map touch events to\n    // equivalent mouse events. Because the \"touchend\" event does not have a\n    // clientX and clientY, record and use the last ones from the \"touchmove\"\n    // (or \"touchstart\") events.\n\n    let touchCoordinates = {clientX: 0, clientY: 0};\n    const touch2mouseEvent = (mouseEventName) => {\n        return (touchEvent) => {\n            if (touchEvent && 0 < touchEvent.touches.length) {\n                const {clientX, clientY} = touchEvent.touches[0];\n                touchCoordinates = {clientX, clientY};\n            }\n            canvas.dispatchEvent(new MouseEvent(mouseEventName, touchCoordinates));\n        };\n    };\n\n    canvas.addEventListener(\"touchstart\", touch2mouseEvent(\"mousedown\"));\n    canvas.addEventListener(\"mousedown\", startInteraction);\n\n    if (!board.disabledDraggingDice) {\n        canvas.addEventListener(\"touchmove\", touch2mouseEvent(\"mousemove\"));\n        canvas.addEventListener(\"mousemove\", move);\n    }\n\n    if (!board.disabledDraggingDice || !board.disabledHoldingDice) {\n        canvas.addEventListener(\"mousemove\", showInteraction);\n    }\n\n    canvas.addEventListener(\"touchend\", touch2mouseEvent(\"mouseup\"));\n    canvas.addEventListener(\"mouseup\", stopInteraction);\n    canvas.addEventListener(\"mouseout\", stopInteraction);\n};\n\n/**\n * TopDiceBoard is a custom HTML element to render and control a\n * dice board. \n *\n * @extends HTMLElement\n */\nconst TopDiceBoard = class extends HTMLElement {\n\n    /**\n     * Create a new TopDiceBoard.\n     */\n    constructor() {\n        super();\n        this.style.display = \"inline-block\";\n        const shadow = this.attachShadow({mode: \"closed\"});\n        const canvas = document.createElement(\"canvas\");\n        shadow.appendChild(canvas);\n\n        _canvas.set(this, canvas);\n        _currentPlayer.set(this, DEFAULT_SYSTEM_PLAYER);\n        _layout.set(this, new GridLayout({\n            width: this.width,\n            height: this.height,\n            dieSize: this.dieSize,\n            dispersion: this.dispersion\n        }));\n        setupInteraction(this);\n    }\n\n    static get observedAttributes() {\n        return [\n            WIDTH_ATTRIBUTE,\n            HEIGHT_ATTRIBUTE,\n            DISPERSION_ATTRIBUTE,\n            DIE_SIZE_ATTRIBUTE,\n            DRAGGING_DICE_DISABLED_ATTRIBUTE,\n            ROTATING_DICE_DISABLED_ATTRIBUTE,\n            HOLDING_DICE_DISABLED_ATTRIBUTE,\n            HOLD_DURATION_ATTRIBUTE\n        ];\n    }\n\n    attributeChangedCallback(name, oldValue, newValue) {\n        const canvas = _canvas.get(this);\n        switch (name) {\n        case WIDTH_ATTRIBUTE: {\n            const width = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_WIDTH);\n            this.layout.width = width;\n            canvas.setAttribute(WIDTH_ATTRIBUTE, width);\n            break;\n        }\n        case HEIGHT_ATTRIBUTE: {\n            const height = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_HEIGHT);\n            this.layout.height = height;\n            canvas.setAttribute(HEIGHT_ATTRIBUTE, height);\n            break;\n        }\n        case DISPERSION_ATTRIBUTE: {\n            const dispersion = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_DISPERSION);\n            this.layout.dispersion = dispersion;\n            break;\n        }\n        case DIE_SIZE_ATTRIBUTE: {\n            const dieSize = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_DIE_SIZE);\n            this.layout.dieSize = dieSize;\n            break;\n        }\n        case ROTATING_DICE_DISABLED_ATTRIBUTE: {\n            const disabledRotation = validate.boolean(newValue, getBoolean(oldValue, ROTATING_DICE_DISABLED_ATTRIBUTE, DEFAULT_ROTATING_DICE_DISABLED)).value;\n            this.layout.rotate = !disabledRotation;\n            break;\n        }\n        default: {\n            // The value is determined when using the getter\n        }\n        }\n\n        updateBoard(this);\n    }\n\n    connectedCallback() {\n        this.addEventListener(\"top-die:added\", () => addDie(this));\n        this.addEventListener(\"top-die:removed\", () => removeDie(this));\n\n        // Add dice that are already in the DOM\n        this.dice.forEach(() => addDie(this));\n    }\n\n    disconnectedCallback() {\n    }\n\n    adoptedCallback() {\n    }\n\n    /**\n     * The GridLayout used by this DiceBoard to layout the dice.\n     *\n     * @type {GridLayout}\n     */\n    get layout() {\n        return _layout.get(this);\n    }\n\n    /**\n     * The dice on this board. Note, to actually throw the dice use\n     * {@link throwDice}. \n     *\n     * @type {TopDie[]}\n     */\n    get dice() {\n        return [...this.getElementsByTagName(TOP_DIE)];\n    }\n\n    /**\n     * The maximum number of dice that can be put on this board.\n     *\n     * @return {Number} The maximum number of dice, 0 < maximum.\n     */\n    get maximumNumberOfDice() {\n        return this.layout.maximumNumberOfDice;\n    }\n\n    /**\n     * The width of this board.\n     *\n     * @type {Number}\n     */\n    get width() {\n        return getPositiveNumberAttribute(this, WIDTH_ATTRIBUTE, DEFAULT_WIDTH);\n    }\n\n    /**\n     * The height of this board.\n     * @type {Number}\n     */\n    get height() {\n        return getPositiveNumberAttribute(this, HEIGHT_ATTRIBUTE, DEFAULT_HEIGHT);\n    }\n\n    /**\n     * The dispersion level of this board.\n     * @type {Number}\n     */\n    get dispersion() {\n        return getPositiveNumberAttribute(this, DISPERSION_ATTRIBUTE, DEFAULT_DISPERSION);\n    }\n\n    /**\n     * The size of dice on this board.\n     *\n     * @type {Number}\n     */\n    get dieSize() {\n        return getPositiveNumberAttribute(this, DIE_SIZE_ATTRIBUTE, DEFAULT_DIE_SIZE);\n    }\n\n    /**\n     * Can dice on this board be dragged?\n     * @type {Boolean}\n     */\n    get disabledDraggingDice() {\n        return getBooleanAttribute(this, DRAGGING_DICE_DISABLED_ATTRIBUTE, DEFAULT_DRAGGING_DICE_DISABLED);\n    }\n\n    /**\n     * Can dice on this board be held by a Player?\n     * @type {Boolean}\n     */\n    get disabledHoldingDice() {\n        return getBooleanAttribute(this, HOLDING_DICE_DISABLED_ATTRIBUTE, DEFAULT_HOLDING_DICE_DISABLED);\n    }\n\n    /**\n     * Is rotating dice on this board disabled?\n     * @type {Boolean}\n     */\n    get disabledRotatingDice() {\n        return getBooleanAttribute(this, ROTATING_DICE_DISABLED_ATTRIBUTE, DEFAULT_ROTATING_DICE_DISABLED);\n    }\n\n    /**\n     * The duration in ms to press the mouse / touch a die before it bekomes\n     * held by the Player. It has only an effect when this.holdableDice ===\n     * true.\n     *\n     * @type {Number}\n     */\n    get holdDuration() {\n        return getPositiveNumberAttribute(this, HOLD_DURATION_ATTRIBUTE, DEFAULT_HOLD_DURATION);\n    }\n\n    /**\n     * The TopPlayerList element of this TopDiceBoard. If it does not exist,\n     * it will be created.\n     *\n     * @type {TopPlayerList}\n     * @private\n     */\n    get _playerList() {\n        let playerList = this.querySelector(TOP_PLAYER_LIST);\n        if (null === playerList) {\n            playerList = this.appendChild(TOP_PLAYER_LIST);\n        }\n\n        return playerList;\n    }\n\n    /**\n     * The players playing on this board.\n     *\n     * @type {TopPlayer[]}\n     */\n    get players() {\n        return this._playerList.players;\n    }\n\n    /**\n     * As player, throw the dice on this board.\n     *\n     * @param {TopPlayer} [player = DEFAULT_SYSTEM_PLAYER] - The\n     * player that is throwing the dice on this board.\n     *\n     * @return {TopDie[]} The thrown dice on this board. This list of dice is the same as this TopDiceBoard's {@see dice} property\n     */\n    throwDice(player = DEFAULT_SYSTEM_PLAYER) {\n        if (player && !player.hasTurn) {\n            player.startTurn();\n        }\n        this.dice.forEach(die => die.throwIt());\n        updateBoard(this, this.layout.layout(this.dice));\n        return this.dice;\n    }\n\n    /**\n     * Add a die to this TopDiceBoard.\n     *\n     * @param {TopDie|Object} [config = {}] - The die or a configuration of\n     * the die to add to this TopDiceBoard.\n     * @param {Number|null} [config.pips] - The pips of the die to add.\n     * If no pips are specified or the pips are not between 1 and 6, a random\n     * number between 1 and 6 is generated instead.\n     * @param {String} [config.color] - The color of the die to add. Default\n     * to the default color.\n     * @param {Number} [config.x] - The x coordinate of the die.\n     * @param {Number} [config.y] - The y coordinate of the die.\n     * @param {Number} [config.rotation] - The rotation of the die.\n     * @param {TopPlayer} [config.heldBy] - The player holding the die.\n     *\n     * @return {TopDie} The added die.\n     */\n    addDie(config = {}) {\n        return this.appendChild(config instanceof TopDie ? config : new TopDie(config));\n    }\n\n    /**\n     * Remove die from this TopDiceBoard.\n     *\n     * @param {TopDie} die - The die to remove from this board.\n     */\n    removeDie(die) {\n        if (die.parentNode && die.parentNode === this) {\n            this.removeChild(die);\n        }\n    }\n\n    /**\n     * Add a player to this TopDiceBoard.\n     *\n     * @param {TopPlayer|Object} config - The player or a configuration of a\n     * player to add to this TopDiceBoard.\n     * @param {String} config.color - This player's color used in the game.\n     * @param {String} config.name - This player's name.\n     * @param {Number} [config.score] - This player's score.\n     * @param {Boolean} [config.hasTurn] - This player has a turn.\n     *\n     * @throws Error when the player to add conflicts with a pre-existing\n     * player.\n     *\n     * @return {TopPlayer} The added player.\n     */\n    addPlayer(config = {}) {\n        return this._playerList.appendChild(config instanceof TopPlayer ? config : new TopPlayer(config));\n    }\n\n    /**\n     * Remove player from this TopDiceBoard.\n     *\n     * @param {TopPlayer} player - The player to remove from this board.\n     */\n    removePlayer(player) {\n        if (player.parentNode && player.parentNode === this._playerList) {\n            this._playerList.removeChild(player);\n        }\n    }\n\n};\n\nwindow.customElements.define(TAG_NAME, TopDiceBoard);\n\nexport {\n    TopDiceBoard,\n    DEFAULT_DIE_SIZE,\n    DEFAULT_HOLD_DURATION,\n    DEFAULT_WIDTH,\n    DEFAULT_HEIGHT,\n    DEFAULT_DISPERSION,\n    DEFAULT_ROTATING_DICE_DISABLED,\n    TAG_NAME\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport {TopDiceBoard} from \"./TopDiceBoard.js\";\nimport {TopDie} from \"./TopDie.js\";\nimport {TopPlayer} from \"./TopPlayer.js\";\nimport {TopPlayerList} from \"./TopPlayerList.js\";\n\nwindow.twentyonepips = window.twentyonepips || Object.freeze({\n    VERSION: \"0.0.1\",\n    LICENSE: \"LGPL-3.0\",\n    WEBSITE: \"https://twentyonepips.org\",\n    TopDiceBoard: TopDiceBoard,\n    TopDie: TopDie,\n    TopPlayer: TopPlayer,\n    TopPlayerList: TopPlayerList\n});\n"]}