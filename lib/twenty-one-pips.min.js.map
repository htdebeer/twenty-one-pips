{"version":3,"sources":["error/ConfigurationError.js","GridLayout.js","mixin/ReadOnlyAttributes.js","validate/error/ValidationError.js","validate/TypeValidator.js","validate/error/ParseError.js","validate/error/InvalidTypeError.js","validate/IntegerTypeValidator.js","validate/StringTypeValidator.js","validate/ColorTypeValidator.js","validate/BooleanTypeValidator.js","validate/validate.js","TopDie.js","TopPlayer.js","TopPlayerList.js","TopDiceBoard.js","twenty-one-pips.js"],"names":["ConfigurationError","Error","[object Object]","message","super","FULL_CIRCLE_IN_DEGREES","randomizeCenter","n","Math","random","floor","ceil","call","_width","WeakMap","_height","_cols","_rows","_dice","_dieSize","_dispersion","_rotate","GridLayout","width","height","dispersion","dieSize","set","this","get","w","_calculateGrid","h","maximumNumberOfDice","d","ds","rotate","r","undefined","_center","row","col","dice","length","lenght","alreadyLayoutDice","diceToLayout","die","hasCoordinates","isHeld","push","max","min","availableCells","_computeAvailableCells","randomIndex","randomCell","splice","coordinates","_numberToCoordinates","rotation","round","available","Set","level","maxLevel","size","cell","_cellsOnLevel","_cellIsEmpty","add","Array","from","cells","center","_cellToNumber","find","_coordinatesToNumber","trunc","_cellToCoords","_numberToCell","coords","_coordsToCell","x","y","cornerCell","corner","widthIn","widthOut","heightIn","heightOut","snapTo","q","coverage","filter","quadrant","reduce","maxQ","point","xFit","yFit","attribute2property","name","first","rest","split","map","word","slice","toUpperCase","join","ReadOnlyAttributes","Sup","oldValue","newValue","property","connected","setAttribute","ValidationError","msg","_value","_defaultValue","_errors","TypeValidator","value","defaultValue","errors","origin","isValid","newDefault","predicate","bindVariables","ErrorType","apply","error","ParseError","InvalidTypeError","INTEGER_DEFAULT_VALUE","IntegerTypeValidator","input","Number","isInteger","parsedValue","parseInt","_check","m","largerThan","smallerThan","STRING_DEFAULT_VALUE","StringTypeValidator","COLOR_DEFAULT_VALUE","ColorTypeValidator","BOOLEAN_DEFAULT_VALUE","BooleanTypeValidator","Boolean","test","Validator","ValidatorSingleton","TAG_NAME","CIRCLE_DEGREES","NUMBER_OF_PIPS","DEFAULT_COLOR","DEFAULT_X","DEFAULT_Y","DEFAULT_ROTATION","DEFAULT_OPACITY","COLOR_ATTRIBUTE","HELD_BY_ATTRIBUTE","PIPS_ATTRIBUTE","ROTATION_ATTRIBUTE","X_ATTRIBUTE","Y_ATTRIBUTE","BASE_DIE_SIZE","BASE_ROUNDED_CORNER_RADIUS","BASE_STROKE_WIDTH","MIN_STROKE_WIDTH","HALF","THIRD","PIP_SIZE","PIP_COLOR","deg2rad","deg","PI","isPipNumber","number","randomPips","DIE_UNICODE_CHARACTERS","pipsToUnicode","p","renderHold","context","color","SEPERATOR","save","globalAlpha","beginPath","fillStyle","arc","fill","restore","renderDie","SCALE","HALF_INNER_SIZE","sqrt","INNER_SIZE","ROUNDED_CORNER_RADIUS","INNER_SIZE_ROUNDED","STROKE_WIDTH","startX","startY","strokeStyle","lineWidth","moveTo","lineTo","stroke","renderPip","_board","_color","_heldBy","_pips","_rotation","_x","_y","TopDie","HTMLElement","pips","heldBy","pipsValue","validate","integer","getAttribute","between","defaultTo","string","notEmpty","observedAttributes","parentNode","dispatchEvent","Event","toUnicode","newColor","removeAttribute","player","toString","c","newX","newY","newR","normalizedRotation","detail","equals","CustomEvent","scale","SHALF","STHIRD","SPIP_SIZE","translate","setTransform","window","customElements","define","NAME_ATTRIBUTE","SCORE_ATTRIBUTE","HAS_TURN_ATTRIBUTE","_name","_score","_hasTurn","TopPlayer","score","hasTurn","colorValue","boolean","isTrue","newScore","isConnected","other","DEFAULT_SYSTEM_PLAYER","TopPlayerList","players","appendChild","addEventListener","event","forEach","endTurn","getElementsByTagName","TOP_PLAYER","DEFAULT_DIE_SIZE","DEFAULT_HOLD_DURATION","DEFAULT_DRAGGING_DICE_DISABLED","DEFAULT_HOLDING_DICE_DISABLED","DEFAULT_ROTATING_DICE_DISABLED","ROWS","COLS","DEFAULT_WIDTH","DEFAULT_HEIGHT","DEFAULT_DISPERSION","MIN_DELTA","WIDTH_ATTRIBUTE","HEIGHT_ATTRIBUTE","DISPERSION_ATTRIBUTE","DIE_SIZE_ATTRIBUTE","DRAGGING_DICE_DISABLED_ATTRIBUTE","HOLDING_DICE_DISABLED_ATTRIBUTE","ROTATING_DICE_DISABLED_ATTRIBUTE","HOLD_DURATION_ATTRIBUTE","parseNumber","numberString","defaultNumber","isNaN","getPositiveNumber","getPositiveNumberAttribute","element","hasAttribute","valueString","getBoolean","booleanString","trueValue","getBooleanAttribute","_canvas","_layout","_currentPlayer","_numberOfReadyDice","board","getContext","getReadyDice","updateReadyDice","update","isReady","updateBoard","clearRect","render","NONE","Symbol","HOLD","MOVE","INDETERMINED","DRAGGING","convertWindowCoordinatesToCanvas","canvas","xWindow","yWindow","canvasBox","getBoundingClientRect","left","top","setupInteraction","state","staticBoard","dieUnderCursor","holdTimeout","holdDie","playerWithATurn","querySelector","TOP_PLAYER_LIST","releaseIt","holdIt","startHolding","setTimeout","holdDuration","showInteraction","layout","getAt","clientX","clientY","style","cursor","move","dx","abs","dy","clearTimeout","diceWithoutDieUnderCursor","getImageData","putImageData","stopInteraction","snapToCoords","newCoords","touchCoordinates","touch2mouseEvent","mouseEventName","touchEvent","touches","MouseEvent","disabledHoldingDice","disabledDraggingDice","TopDiceBoard","display","shadow","attachShadow","mode","document","createElement","disabledRotation","disabledRotatingDice","_playerList","playerList","startTurn","throwIt","config","removeChild","twentyonepips","Object","freeze","VERSION","LICENSE","WEBSITE"],"mappings":"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","file":"twenty-one-pips.min.js","sourcesContent":["/** \n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n/**\n * ConfigurationError\n *\n * @extends Error\n */\nconst ConfigurationError = class extends Error {\n\n    /**\n     * Create a new ConfigurationError with message.\n     *\n     * @param {String} message - The message associated with this\n     * ConfigurationError.\n     */\n    constructor(message) {\n        super(message);\n    }\n};\n\nexport {ConfigurationError};\n","/** \n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ConfigurationError} from \"./error/ConfigurationError.js\";\n\nconst FULL_CIRCLE_IN_DEGREES = 360;\n\nconst randomizeCenter = (n) => {\n    return (0.5 <= Math.random() ? Math.floor : Math.ceil).call(0, n);\n};\n\n// Private fields\nconst _width = new WeakMap();\nconst _height = new WeakMap();\nconst _cols = new WeakMap();\nconst _rows = new WeakMap();\nconst _dice = new WeakMap();\nconst _dieSize = new WeakMap();\nconst _dispersion = new WeakMap();\nconst _rotate = new WeakMap();\n\n/**\n * @typedef {Object} GridLayoutConfiguration\n * @property {Number} config.width - The minimal width of this\n * GridLayout in pixels.;\n * @property {Number} config.height] - The minimal height of\n * this GridLayout in pixels..\n * @property {Number} config.dispersion - The distance from the center of the\n * layout a die can be layout.\n * @property {Number} config.dieSize - The size of a die.\n */\n\n/**\n * GridLayout handles laying out the dice on a DiceBoard.\n */\nconst GridLayout = class {\n\n    /**\n     * Create a new GridLayout.\n     *\n     * @param {GridLayoutConfiguration} config - The configuration of the GridLayout\n     */\n    constructor({\n        width,\n        height,\n        dispersion,\n        dieSize\n    } = {}) {\n        _dice.set(this, []);\n        _dieSize.set(this, 1);\n        _width.set(this, 0);\n        _height.set(this, 0);\n        _rotate.set(this, true);\n\n        this.dispersion = dispersion;\n        this.dieSize = dieSize;\n        this.width = width;\n        this.height = height;\n    }\n\n    /**\n     * The width in pixels used by this GridLayout.\n     * @throws ConfigurationError Width >= 0\n     * @type {Number} \n     */\n    get width() {\n        return _width.get(this);\n    }\n\n    set width(w) {\n        if (0 > w) {\n            throw new ConfigurationError(`Width should be a number larger than 0, got '${w}' instead.`);\n        }\n        _width.set(this, w);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    /**\n     * The height in pixels used by this GridLayout. \n     * @throws ConfigurationError Height >= 0\n     *\n     * @type {Number}\n     */\n    get height() {\n        return _height.get(this);\n    }\n\n    set height(h) {\n        if (0 > h) {\n            throw new ConfigurationError(`Height should be a number larger than 0, got '${h}' instead.`);\n        }\n        _height.set(this, h);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    /**\n     * The maximum number of dice that can be layout on this GridLayout. This\n     * number is >= 0. Read only.\n     *\n     * @type {Number}\n     */\n    get maximumNumberOfDice() {\n        return this._cols * this._rows;\n    }\n\n    /**\n     * The dispersion level used by this GridLayout. The dispersion level\n     * indicates the distance from the center dice can be layout. Use 1 for a\n     * tight packed layout.\n     *\n     * @throws ConfigurationError Dispersion >= 0\n     * @type {Number}\n     */\n    get dispersion() {\n        return _dispersion.get(this);\n    }\n\n    set dispersion(d) {\n        if (0 > d) {\n            throw new ConfigurationError(`Dispersion should be a number larger than 0, got '${d}' instead.`);\n        }\n        return _dispersion.set(this, d);\n    }\n\n    /**\n     * The size of a die.\n     *\n     * @throws ConfigurationError DieSize >= 0\n     * @type {Number}\n     */\n    get dieSize() {\n        return _dieSize.get(this);\n    }\n\n    set dieSize(ds) {\n        if (0 >= ds) {\n            throw new ConfigurationError(`dieSize should be a number larger than 1, got '${ds}' instead.`);\n        }\n        _dieSize.set(this, ds);\n        this._calculateGrid(this.width, this.height);\n    }\n\n    get rotate() {\n        const r = _rotate.get(this);\n        return undefined === r ? true : r;\n    }\n\n    set rotate(r) {\n        _rotate.set(this, r);\n    }\n\n    /**\n     * The number of rows in this GridLayout.\n     *\n     * @return {Number} The number of rows, 0 < rows.\n     * @private\n     */\n    get _rows() {\n        return _rows.get(this);\n    }\n\n    /**\n     * The number of columns in this GridLayout.\n     *\n     * @return {Number} The number of columns, 0 < columns.\n     * @private\n     */\n    get _cols() {\n        return _cols.get(this);\n    }\n\n    /**\n     * The center cell in this GridLayout.\n     *\n     * @return {Object} The center (row, col).\n     * @private\n     */\n    get _center() {\n        const row = randomizeCenter(this._rows / 2) - 1;\n        const col = randomizeCenter(this._cols / 2) - 1;\n\n        return {row, col};\n    }\n\n    /**\n     * Layout dice on this GridLayout.\n     *\n     * @param {TopDie[]} dice - The dice to layout on this Layout.\n     * @return {TopDie[]} The same list of dice, but now layout.\n     *\n     * @throws {ConfigurationError} The number of\n     * dice should not exceed the maximum number of dice this Layout can\n     * layout.\n     */\n    layout(dice) {\n        if (dice.length > this.maximumNumberOfDice) {\n            throw new ConfigurationError(`The number of dice that can be layout is ${this.maximumNumberOfDice}, got ${dice.lenght} dice instead.`);\n        }\n\n        const alreadyLayoutDice = [];\n        const diceToLayout = [];\n\n        for (const die of dice) {\n            if (die.hasCoordinates() && die.isHeld()) {\n                // Dice that are being held and have been layout before should\n                // keep their current coordinates and rotation. In other words,\n                // these dice are skipped.\n                alreadyLayoutDice.push(die);\n            } else {\n                diceToLayout.push(die);\n            }\n        }\n\n        const max = Math.min(dice.length * this.dispersion, this.maximumNumberOfDice);\n        const availableCells = this._computeAvailableCells(max, alreadyLayoutDice);\n\n        for (const die of diceToLayout) {\n            const randomIndex = Math.floor(Math.random() * availableCells.length);\n            const randomCell = availableCells[randomIndex];\n            availableCells.splice(randomIndex, 1);\n\n            die.coordinates = this._numberToCoordinates(randomCell);\n            die.rotation = this.rotate ? Math.round(Math.random() * FULL_CIRCLE_IN_DEGREES) : null;\n            alreadyLayoutDice.push(die);\n        }\n\n        _dice.set(this, alreadyLayoutDice);\n\n        return alreadyLayoutDice;\n    }\n\n    /**\n     * Compute a list with available cells to place dice on.\n     *\n     * @param {Number} max - The number empty cells to compute.\n     * @param {TopDie[]} alreadyLayoutDice - A list with dice that have already been layout.\n     * \n     * @return {Number[]} The list of available cells represented by their number.\n     * @private\n     */\n    _computeAvailableCells(max, alreadyLayoutDice) {\n        const available = new Set();\n        let level = 0;\n        const maxLevel = Math.min(this._rows, this._cols);\n\n        while (available.size < max && level < maxLevel) {\n            for (const cell of this._cellsOnLevel(level)) {\n                if (undefined !== cell && this._cellIsEmpty(cell, alreadyLayoutDice)) {\n                    available.add(cell);\n                }\n            }\n\n            level++;\n        }\n\n        return Array.from(available);\n    }\n\n    /**\n     * Calculate all cells on level from the center of the layout.\n     *\n     * @param {Number} level - The level from the center of the layout. 0\n     * indicates the center.\n     *\n     * @return {Set<Number>} the cells on the level in this layout represented by\n     * their number.\n     * @private\n     */\n    _cellsOnLevel(level) {\n        const cells = new Set();\n        const center = this._center;\n\n        if (0 === level) {\n            cells.add(this._cellToNumber(center));\n        } else {\n            for (let row = center.row - level; row <= center.row + level; row++) {\n                cells.add(this._cellToNumber({row, col: center.col - level}));\n                cells.add(this._cellToNumber({row, col: center.col + level}));\n            }\n\n            for (let col = center.col - level + 1; col < center.col + level; col++) {\n                cells.add(this._cellToNumber({row: center.row - level, col}));\n                cells.add(this._cellToNumber({row: center.row + level, col}));\n            }\n        }\n\n        return cells;\n    }\n\n    /**\n     * Does cell contain a cell from alreadyLayoutDice?\n     *\n     * @param {Number} cell - A cell in layout represented by a number.\n     * @param {TopDie[]} alreadyLayoutDice - A list of dice that have already been layout.\n     *\n     * @return {Boolean} True if cell does not contain a die.\n     * @private\n     */\n    _cellIsEmpty(cell, alreadyLayoutDice) {\n        return undefined === alreadyLayoutDice.find(die => cell === this._coordinatesToNumber(die.coordinates));\n    }\n\n    /**\n     * Convert a number to a cell (row, col)\n     *\n     * @param {Number} n - The number representing a cell\n     * @returns {Object} Return the cell ({row, col}) corresponding n.\n     * @private\n     */\n    _numberToCell(n) {\n        return {row: Math.trunc(n / this._cols), col: n % this._cols};\n    }\n\n    /**\n     * Convert a cell to a number\n     *\n     * @param {Object} cell - The cell to convert to its number.\n     * @return {Number|undefined} The number corresponding to the cell.\n     * Returns undefined when the cell is not on the layout\n     * @private\n     */\n    _cellToNumber({row, col}) {\n        if (0 <= row && row < this._rows && 0 <= col && col < this._cols) {\n            return row * this._cols + col;\n        }\n        return undefined;\n    }\n\n    /**\n     * Convert a cell represented by its number to their coordinates.\n     *\n     * @param {Number} n - The number representing a cell\n     *\n     * @return {Object} The coordinates corresponding to the cell represented by\n     * this number.\n     * @private\n     */\n    _numberToCoordinates(n) {\n        return this._cellToCoords(this._numberToCell(n));\n    }\n\n    /**\n     * Convert a pair of coordinates to a number.\n     *\n     * @param {Object} coords - The coordinates to convert\n     *\n     * @return {Number|undefined} The coordinates converted to a number. If\n     * the coordinates are not on this layout, the number is undefined.\n     * @private\n     */\n    _coordinatesToNumber(coords) {\n        const n = this._cellToNumber(this._coordsToCell(coords));\n        if (0 <= n && n < this.maximumNumberOfDice) {\n            return n;\n        }\n        return undefined;\n    }\n\n    /**\n     * Snap (x,y) to the closest cell in this Layout.\n     *\n     * @param {Object} diecoordinate - The coordinate to find the closest cell\n     * for.\n     * @param {TopDie} [diecoordinat.die = null] - The die to snap to.\n     * @param {Number} diecoordinate.x - The x-coordinate.\n     * @param {Number} diecoordinate.y - The y-coordinate.\n     *\n     * @return {Object|null} The coordinate of the cell closest to (x, y).\n     * Null when no suitable cell is near (x, y)\n     */\n    snapTo({die = null, x, y}) {\n        const cornerCell = {\n            row: Math.trunc(y / this.dieSize),\n            col: Math.trunc(x / this.dieSize)\n        };\n\n        const corner = this._cellToCoords(cornerCell);\n        const widthIn = corner.x + this.dieSize - x;\n        const widthOut = this.dieSize - widthIn;\n        const heightIn = corner.y + this.dieSize - y;\n        const heightOut = this.dieSize - heightIn;\n\n        const quadrants = [{\n            q: this._cellToNumber(cornerCell),\n            coverage: widthIn * heightIn\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row,\n                col: cornerCell.col + 1\n            }),\n            coverage: widthOut * heightIn\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row + 1,\n                col: cornerCell.col\n            }),\n            coverage: widthIn * heightOut\n        }, {\n            q: this._cellToNumber({\n                row: cornerCell.row + 1,\n                col: cornerCell.col + 1\n            }),\n            coverage: widthOut * heightOut\n        }];\n\n        const snapTo = quadrants\n            // cell should be on the layout\n            .filter((quadrant) => undefined !== quadrant.q)\n            // cell should be not already taken except by itself\n            .filter((quadrant) => (\n                null !== die && this._coordinatesToNumber(die.coordinates) === quadrant.q)\n                || this._cellIsEmpty(quadrant.q, _dice.get(this)))\n            // cell should be covered by the die the most\n            .reduce(\n                (maxQ, quadrant) => quadrant.coverage > maxQ.coverage ? quadrant : maxQ,\n                {q: undefined, coverage: -1}\n            );\n\n        return undefined !== snapTo.q ? this._numberToCoordinates(snapTo.q) : null;\n    }\n\n    /**\n     * Get the die at point (x, y);\n     *\n     * @param {Point} point - The point in (x, y) coordinates\n     * @return {TopDie|null} The die under coordinates (x, y) or null if no die\n     * is at the point.\n     */\n    getAt(point = {x: 0, y: 0}) {\n        for (const die of _dice.get(this)) {\n            const {x, y} = die.coordinates;\n\n            const xFit = x <= point.x && point.x <= x + this.dieSize;\n            const yFit = y <= point.y && point.y <= y + this.dieSize;\n\n            if (xFit && yFit) {\n                return die;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Calculate the grid size given width and height.\n     *\n     * @param {Number} width - The minimal width\n     * @param {Number} height - The minimal height\n     *\n     * @private\n     */\n    _calculateGrid(width, height) {\n        _cols.set(this, Math.floor(width / this.dieSize));\n        _rows.set(this, Math.floor(height / this.dieSize));\n    }\n\n    /**\n     * Convert a (row, col) cell to (x, y) coordinates.\n     *\n     * @param {Object} cell - The cell to convert to coordinates\n     * @return {Object} The corresponding coordinates.\n     * @private\n     */\n    _cellToCoords({row, col}) {\n        return {x: col * this.dieSize, y: row * this.dieSize};\n    }\n\n    /**\n     * Convert (x, y) coordinates to a (row, col) cell.\n     *\n     * @param {Object} coordinates - The coordinates to convert to a cell.\n     * @return {Object} The corresponding cell\n     * @private\n     */\n    _coordsToCell({x, y}) {\n        return {\n            row: Math.trunc(y / this.dieSize),\n            col: Math.trunc(x / this.dieSize)\n        };\n    }\n};\n\nexport {GridLayout};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n/**\n * @module mixin/ReadOnlyAttributes\n */\n\n/*\n * Convert an HTML attribute to an instance's property. \n *\n * @param {String} name - The attribute's name\n * @return {String} The corresponding property's name. For example, \"my-attr\"\n * will be converted to \"myAttr\", and \"disabled\" to \"disabled\".\n */\nconst attribute2property = (name) => {\n    const [first, ...rest] = name.split(\"-\");\n    return first + rest.map(word => word.slice(0, 1).toUpperCase() + word.slice(1)).join();\n};\n\n/**\n * Mixin {@link ReadOnlyAttributes} to a class.\n *\n * @param {*} Sup - The class to mix into.\n * @return {ReadOnlyAttributes} The mixed-in class\n */\nconst ReadOnlyAttributes = (Sup) =>\n    /**\n     * Mixin to make all attributes on a custom HTMLElement read-only in the sense\n     * that when the attribute gets a new value that differs from the value of the\n     * corresponding property, it is reset to that property's value. The\n     * assumption is that attribute \"my-attribute\" corresponds with property \"this.myAttribute\".\n     *\n     * @param {Class} Sup - The class to mixin this ReadOnlyAttributes.\n     * @return {ReadOnlyAttributes} The mixed in class.\n     *\n     * @mixin\n     * @alias ReadOnlyAttributes\n     */\n    class extends Sup {\n\n        /**\n         * Callback that is executed when an observed attribute's value is\n         * changed. If the HTMLElement is connected to the DOM, the attribute\n         * value can only be set to the corresponding HTMLElement's property.\n         * In effect, this makes this HTMLElement's attributes read-only.\n         *\n         * For example, if an HTMLElement has an attribute \"x\" and\n         * corresponding property \"x\", then changing the value \"x\" to \"5\"\n         * will only work when `this.x === 5`.\n         *\n         * @param {String} name - The attribute's name.\n         * @param {String} oldValue - The attribute's old value.\n         * @param {String} newValue - The attribute's new value.\n         */\n        attributeChangedCallback(name, oldValue, newValue) {\n            // All attributes are made read-only to prevent cheating by changing\n            // the attribute values. Of course, this is by no\n            // guarantee that users will not cheat in a different way.\n            const property = attribute2property(name);\n            if (this.connected && newValue !== `${this[property]}`) {\n                this.setAttribute(name, this[property]);\n            }\n        }\n    };\n\nexport {\n    ReadOnlyAttributes\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nconst ValidationError = class extends Error {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    ValidationError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./error/ValidationError.js\";\n\nconst _value = new WeakMap();\nconst _defaultValue = new WeakMap();\nconst _errors = new WeakMap();\n\nconst TypeValidator = class {\n    constructor({value, defaultValue, errors = []}) {\n        _value.set(this, value);\n        _defaultValue.set(this, defaultValue);\n        _errors.set(this, errors);\n    }\n\n    get origin() {\n        return _value.get(this);\n    }\n\n    get value() {\n        return this.isValid ? this.origin : _defaultValue.get(this);\n    }\n\n    get errors() {\n        return _errors.get(this);\n    }\n\n    get isValid() {\n        return 0 >= this.errors.length;\n    }\n\n    defaultTo(newDefault) {\n        _defaultValue.set(this, newDefault);\n        return this;\n    }\n\n    _check({predicate, bindVariables = [], ErrorType = ValidationError}) {\n        const proposition = predicate.apply(this, bindVariables);\n        if (!proposition) {\n            const error = new ErrorType(this.value, bindVariables);\n            //console.warn(error.toString());\n            this.errors.push(error);\n        }\n\n        return this;\n    }\n};\n\nexport {\n    TypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./ValidationError.js\";\n\nconst ParseError = class extends ValidationError {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    ParseError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ValidationError} from \"./ValidationError.js\";\n\nconst InvalidTypeError = class extends ValidationError {\n    constructor(msg) {\n        super(msg);\n    }\n};\n\nexport {\n    InvalidTypeError\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst INTEGER_DEFAULT_VALUE = 0;\nconst IntegerTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = INTEGER_DEFAULT_VALUE;\n        const defaultValue = INTEGER_DEFAULT_VALUE;\n        const errors = [];\n\n        if (Number.isInteger(input)) {\n            value = input;\n        } else if (\"string\" === typeof input) {\n            const parsedValue = parseInt(input, 10);\n            if (Number.isInteger(parsedValue)) {\n                value = parsedValue;\n            } else {\n                errors.push(new ParseError(input));\n            }\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    largerThan(n) {\n        return this._check({\n            predicate: (n) => this.origin >= n,\n            bindVariables: [n]\n        });\n    }\n\n    smallerThan(n) {\n        return this._check({\n            predicate: (n) => this.origin <= n,\n            bindVariables: [n]\n        });\n    }\n\n    between(n, m) {\n        return this._check({\n            predicate: (n, m) => this.largerThan(n) && this.smallerThan(m),\n            bindVariables: [n, m]\n        });\n    }\n};\n\nexport {\n    IntegerTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst STRING_DEFAULT_VALUE = \"\";\nconst StringTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = STRING_DEFAULT_VALUE;\n        const defaultValue = STRING_DEFAULT_VALUE;\n        const errors = [];\n\n        if (\"string\" === typeof input) {\n            value = input;\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    notEmpty() {\n        return this._check({\n            predicate: () => \"\" !== this.origin\n        });\n    }\n};\n\nexport {\n    StringTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\n//import {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst COLOR_DEFAULT_VALUE = \"black\";\nconst ColorTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = COLOR_DEFAULT_VALUE;\n        const defaultValue = COLOR_DEFAULT_VALUE;\n        const errors = [];\n\n        if (\"string\" === typeof input) {\n            value = input;\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n};\n\nexport {\n    ColorTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {TypeValidator} from \"./TypeValidator.js\";\nimport {ParseError} from \"./error/ParseError.js\";\nimport {InvalidTypeError} from \"./error/InvalidTypeError.js\";\n\nconst BOOLEAN_DEFAULT_VALUE = false;\nconst BooleanTypeValidator = class extends TypeValidator {\n    constructor(input) {\n        let value = BOOLEAN_DEFAULT_VALUE;\n        const defaultValue = BOOLEAN_DEFAULT_VALUE;\n        const errors = [];\n\n        if (input instanceof Boolean) {\n            value = input;\n        } else if (\"string\" === typeof input) {\n            if (/true/i.test(input)) {\n                value = true;\n            } else if (/false/i.test(input)) {\n                value = false;\n            } else {\n                errors.push(new ParseError(input));\n            }\n        } else {\n            errors.push(new InvalidTypeError(input));\n        }\n\n        super({value, defaultValue, errors});\n    }\n\n    isTrue() {\n        return this._check({\n            predicate: () => true === this.origin\n        });\n    }\n\n    isFalse() {\n        return this._check({\n            predicate: () => false === this.origin\n        });\n    }\n};\n\nexport {\n    BooleanTypeValidator\n};\n","/** \n * Copyright (c) 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {IntegerTypeValidator} from \"./IntegerTypeValidator.js\";\nimport {StringTypeValidator} from \"./StringTypeValidator.js\";\nimport {ColorTypeValidator} from \"./ColorTypeValidator.js\";\nimport {BooleanTypeValidator} from \"./BooleanTypeValidator.js\";\n\nconst Validator = class {\n    constructor() {\n    }\n\n    boolean(input) {\n        return new BooleanTypeValidator(input);\n    }\n\n    color(input) {\n        return new ColorTypeValidator(input);\n    }\n\n    integer(input) {\n        return new IntegerTypeValidator(input);\n    }\n\n    string(input) {\n        return new StringTypeValidator(input);\n    }\n\n};\n\nconst ValidatorSingleton = new Validator();\n\nexport {\n    ValidatorSingleton as validate\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n\n//import {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {ReadOnlyAttributes} from \"./mixin/ReadOnlyAttributes.js\";\nimport {validate} from \"./validate/validate.js\";\n\nconst TAG_NAME = \"top-die\";\n\nconst CIRCLE_DEGREES = 360; // degrees\nconst NUMBER_OF_PIPS = 6; // Default / regular six sided die has 6 pips maximum.\nconst DEFAULT_COLOR = \"Ivory\";\nconst DEFAULT_X = 0; // px\nconst DEFAULT_Y = 0; // px\nconst DEFAULT_ROTATION = 0; // degrees\nconst DEFAULT_OPACITY = 0.5;\n\nconst COLOR_ATTRIBUTE = \"color\";\nconst HELD_BY_ATTRIBUTE = \"held-by\";\nconst PIPS_ATTRIBUTE = \"pips\";\nconst ROTATION_ATTRIBUTE = \"rotation\";\nconst X_ATTRIBUTE = \"x\";\nconst Y_ATTRIBUTE = \"y\";\n\nconst BASE_DIE_SIZE = 100; // px\nconst BASE_ROUNDED_CORNER_RADIUS = 15; // px\nconst BASE_STROKE_WIDTH = 2.5; // px\nconst MIN_STROKE_WIDTH = 1; // px\nconst HALF = BASE_DIE_SIZE / 2; // px\nconst THIRD = BASE_DIE_SIZE / 3; // px\nconst PIP_SIZE = BASE_DIE_SIZE / 15; //px\nconst PIP_COLOR = \"black\";\n\nconst deg2rad = (deg) => {\n    return deg * (Math.PI / 180);\n};\n\nconst isPipNumber = n => {\n    const number = parseInt(n, 10);\n    return Number.isInteger(number) && 1 <= number && number <= NUMBER_OF_PIPS;\n};\n\n/**\n * Generate a random number of pips between 1 and the NUMBER_OF_PIPS.\n *\n * @returns {Number} A random number n, 1 ≤ n ≤ NUMBER_OF_PIPS.\n */\nconst randomPips = () => Math.floor(Math.random() * NUMBER_OF_PIPS) + 1;\n\nconst DIE_UNICODE_CHARACTERS = [\"⚀\",\"⚁\",\"⚂\",\"⚃\",\"⚄\",\"⚅\"];\n\n/**\n * Convert a unicode character representing a die face to the number of pips of\n * that same die. This function is the reverse of pipsToUnicode.\n *\n * @param {String} u - The unicode character to convert to pips.\n * @returns {Number|undefined} The corresponding number of pips, 1 ≤ pips ≤ 6, or\n * undefined if u was not a unicode character representing a die.\n */\nconst unicodeToPips = (u) => {\n    const dieCharIndex = DIE_UNICODE_CHARACTERS.indexOf(u);\n    return 0 <= dieCharIndex ? dieCharIndex + 1 : undefined;\n};\n\n/**\n * Convert a number of pips, 1 ≤ pips ≤ 6 to a unicode character\n * representation of the corresponding die face. This function is the reverse\n * of unicodeToPips.\n *\n * @param {Number} p - The number of pips to convert to a unicode character.\n * @returns {String|undefined} The corresponding unicode characters or\n * undefined if p was not between 1 and 6 inclusive.\n */\nconst pipsToUnicode = p => isPipNumber(p) ? DIE_UNICODE_CHARACTERS[p - 1] : undefined;\n\nconst renderHold = (context, x, y, width, color) => {\n    const SEPERATOR = width / 30;\n    context.save();\n    context.globalAlpha = DEFAULT_OPACITY;\n    context.beginPath();\n    context.fillStyle = color;\n    context.arc(x + width, y + width, width - SEPERATOR, 0, 2 * Math.PI, false);\n    context.fill();\n    context.restore();\n};\n\nconst renderDie = (context, x, y, width, color) => {\n    const SCALE = (width / HALF);\n    const HALF_INNER_SIZE = Math.sqrt(width ** 2 / 2);\n    const INNER_SIZE = 2 * HALF_INNER_SIZE;\n    const ROUNDED_CORNER_RADIUS = BASE_ROUNDED_CORNER_RADIUS * SCALE;\n    const INNER_SIZE_ROUNDED = INNER_SIZE - 2 * ROUNDED_CORNER_RADIUS;\n    const STROKE_WIDTH = Math.max(MIN_STROKE_WIDTH, BASE_STROKE_WIDTH * SCALE);\n\n    const startX = x + width - HALF_INNER_SIZE + ROUNDED_CORNER_RADIUS;\n    const startY = y + width - HALF_INNER_SIZE;\n\n    context.save();\n    context.beginPath();\n    context.fillStyle = color;\n    context.strokeStyle = \"black\";\n    context.lineWidth = STROKE_WIDTH;\n    context.moveTo(startX, startY);\n    context.lineTo(startX + INNER_SIZE_ROUNDED, startY);\n    context.arc(startX + INNER_SIZE_ROUNDED, startY + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(270), deg2rad(0));\n    context.lineTo(startX + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS);\n    context.arc(startX + INNER_SIZE_ROUNDED, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(0), deg2rad(90));\n    context.lineTo(startX, startY + INNER_SIZE);\n    context.arc(startX, startY + INNER_SIZE_ROUNDED + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(90), deg2rad(180));\n    context.lineTo(startX - ROUNDED_CORNER_RADIUS, startY + ROUNDED_CORNER_RADIUS);\n    context.arc(startX, startY + ROUNDED_CORNER_RADIUS, ROUNDED_CORNER_RADIUS, deg2rad(180), deg2rad(270));\n\n    context.stroke();\n    context.fill();\n    context.restore();\n};\n\nconst renderPip = (context, x, y, width) => {\n    context.save();\n    context.beginPath();\n    context.fillStyle = PIP_COLOR;\n    context.moveTo(x, y);\n    context.arc(x, y, width, 0, 2 * Math.PI, false);\n    context.fill();\n    context.restore();\n};\n\n\n// Private properties\nconst _board = new WeakMap();\nconst _color = new WeakMap();\nconst _heldBy = new WeakMap();\nconst _pips = new WeakMap();\nconst _rotation = new WeakMap();\nconst _x = new WeakMap();\nconst _y = new WeakMap();\n\n/**\n * TopDie is the \"top-die\" custom [HTML\n * element](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement) representing a die\n * on the dice board.\n *\n * @extends HTMLElement\n * @mixes ReadOnlyAttributes\n */\nconst TopDie = class extends ReadOnlyAttributes(HTMLElement) {\n\n    /**\n     * Create a new TopDie.\n     *\n     * @param {Object} [config = {}] - The initial configuration of the die.\n     * @param {Number|null} [config.pips] - The pips of the die to add.\n     * If no pips are specified or the pips are not between 1 and 6, a random\n     * number between 1 and 6 is generated instead.\n     * @param {String} [config.color] - The color of the die to add. Default\n     * to the default color.\n     * @param {Number} [config.x] - The x coordinate of the die.\n     * @param {Number} [config.y] - The y coordinate of the die.\n     * @param {Number} [config.rotation] - The rotation of the die.\n     * @param {TopPlayer} [config.heldBy] - The player holding the die.\n     */\n    constructor({pips, color, rotation, x, y, heldBy} = {}) {\n        super();\n\n        const pipsValue = validate.integer(pips || this.getAttribute(PIPS_ATTRIBUTE))\n            .between(1, 6)\n            .defaultTo(randomPips())\n            .value;\n\n        _pips.set(this, pipsValue);\n        this.setAttribute(PIPS_ATTRIBUTE, pipsValue);\n\n        this.color = validate.color(color || this.getAttribute(COLOR_ATTRIBUTE))\n            .defaultTo(DEFAULT_COLOR)\n            .value;\n\n        this.rotation = validate.integer(rotation || this.getAttribute(ROTATION_ATTRIBUTE))\n            .between(0, 360)\n            .defaultTo(DEFAULT_ROTATION)\n            .value;\n\n        this.x = validate.integer(x || this.getAttribute(X_ATTRIBUTE))\n            .largerThan(0)\n            .defaultTo(DEFAULT_X)\n            .value;\n\n        this.y = validate.integer(y || this.getAttribute(Y_ATTRIBUTE))\n            .largerThan(0)\n            .defaultTo(DEFAULT_Y)\n            .value;\n\n        this.heldBy = validate.string(heldBy || this.getAttribute(HELD_BY_ATTRIBUTE))\n            .notEmpty()\n            .defaultTo(null)\n            .value;\n    }\n\n    static get observedAttributes() {\n        return [\n            COLOR_ATTRIBUTE,\n            HELD_BY_ATTRIBUTE,\n            PIPS_ATTRIBUTE,\n            ROTATION_ATTRIBUTE,\n            X_ATTRIBUTE,\n            Y_ATTRIBUTE\n        ];\n    }\n\n    connectedCallback() {\n        _board.set(this, this.parentNode);\n        _board.get(this).dispatchEvent(new Event(\"top-die:added\"));\n    }\n\n    disconnectedCallback() {\n        _board.get(this).dispatchEvent(new Event(\"top-die:removed\"));\n        _board.set(this, null);\n    }\n\n    /**\n     * Convert this Die to the corresponding unicode character of a die face.\n     *\n     * @return {String} The unicode character corresponding to the number of\n     * pips of this Die.\n     */\n    toUnicode() {\n        return pipsToUnicode(this.pips);\n    }\n\n    /**\n     * Create a string represenation for this die.\n     *\n     * @return {String} The unicode symbol corresponding to the number of pips\n     * of this die.\n     */\n    toString() {\n        return this.toUnicode();\n    }\n\n    /**\n     * This Die's number of pips, 1 ≤ pips ≤ 6.\n     *\n     * @type {Number}\n     */\n    get pips() {\n        return _pips.get(this);\n    }\n\n    /**\n     * This Die's color.\n     *\n     * @type {String}\n     */\n    get color() {\n        return _color.get(this);\n    }\n    set color(newColor) {\n        if (null === newColor) {\n            this.removeAttribute(COLOR_ATTRIBUTE);\n            _color.set(this, DEFAULT_COLOR);\n        } else {\n            _color.set(this, newColor);\n            this.setAttribute(COLOR_ATTRIBUTE, newColor);\n        }\n    }\n\n\n    /**\n     * The player that is holding this Die, if any. Null otherwise.\n     *\n     * @type {TopPlayer|null} \n     */\n    get heldBy() {\n        return _heldBy.get(this);\n    }\n    set heldBy(player) {\n        _heldBy.set(this, player);\n        if (null === player) {\n            this.removeAttribute(\"held-by\");\n        } else {\n            this.setAttribute(\"held-by\", player.toString());\n        }\n    }\n\n    /**\n     * The coordinates of this Die.\n     *\n     * @type {Coordinates|null}\n     */\n    get coordinates() {\n        return null === this.x || null === this.y ? null : {x: this.x, y: this.y};\n    }\n    set coordinates(c) {\n        if (null === c) {\n            this.x = null;\n            this.y = null;\n        } else{\n            const {x, y} = c;\n            this.x = x;\n            this.y = y;\n        }\n    }\n\n    /**\n     * Does this Die have coordinates?\n     *\n     * @return {Boolean} True when the Die does have coordinates\n     */\n    hasCoordinates() {\n        return null !== this.coordinates;\n    }\n\n    /**\n     * The x coordinate\n     *\n     * @type {Number}\n     */\n    get x() {\n        return _x.get(this);\n    }\n    set x(newX) {\n        _x.set(this, newX);\n        this.setAttribute(\"x\", newX);\n    }\n\n    /**\n     * The y coordinate\n     *\n     * @type {Number}\n     */\n    get y() {\n        return _y.get(this);\n    }\n    set y(newY) {\n        _y.set(this, newY);\n        this.setAttribute(\"y\", newY);\n    }\n\n    /**\n     * The rotation of this Die. 0 ≤ rotation ≤ 360.\n     *\n     * @type {Number|null}\n     */\n    get rotation() {\n        return _rotation.get(this);\n    }\n    set rotation(newR) {\n        if (null === newR) {\n            this.removeAttribute(\"rotation\");\n        } else {\n            const normalizedRotation = newR % CIRCLE_DEGREES;\n            _rotation.set(this, normalizedRotation);\n            this.setAttribute(\"rotation\", normalizedRotation);\n        }\n    }\n\n    /**\n     * Throw this Die. The number of pips to a random number n, 1 ≤ n ≤ 6.\n     * Only dice that are not being held can be thrown.\n     *\n     * @fires \"top:throw-die\" with parameters this Die.\n     */\n    throwIt() {\n        if (!this.isHeld()) {\n            _pips.set(this, randomPips());\n            this.setAttribute(PIPS_ATTRIBUTE, this.pips);\n            this.dispatchEvent(new Event(\"top:throw-die\", {\n                detail: {\n                    die: this\n                }\n            }));\n        }\n    }\n\n    /**\n     * The player holds this Die. A player can only hold a die that is not\n     * being held by another player yet.\n     *\n     * @param {TopPlayer} player - The player who wants to hold this Die.\n     * @fires \"top:hold-die\" with parameters this Die and the player.\n     */\n    holdIt(player) {\n        if (!this.isHeld()) {\n            this.heldBy = player;\n            this.dispatchEvent(new Event(\"top:hold-die\", {\n                detail: {\n                    die: this,\n                    player\n                }\n            }));\n        }\n    }\n\n    /**\n     * Is this Die being held by any player?\n     *\n     * @return {Boolean} True when this Die is being held by any player, false otherwise.\n     */\n    isHeld() {\n        return null !== this.heldBy;\n    }\n\n    /**\n     * The player releases this Die. A player can only release dice that she is\n     * holding.\n     *\n     * @param {TopPlayer} player - The player who wants to release this Die.\n     * @fires \"top:relase-die\" with parameters this Die and the player releasing it.\n     */\n    releaseIt(player) {\n        if (this.isHeld() && this.heldBy.equals(player)) {\n            this.heldBy = null;\n            this.removeAttribute(HELD_BY_ATTRIBUTE);\n            this.dispatchEvent(new CustomEvent(\"top:release-die\", {\n                detail: {\n                    die: this,\n                    player\n                }\n            }));\n        }\n    }\n\n    /**\n     * Render this Die.\n     *\n     * @param {CanvasRenderingContext2D} context - The canvas context to draw\n     * on\n     * @param {Number} dieSize - The size of a die.\n     * @param {Number} [coordinates = this.coordinates] - The coordinates to\n     * draw this die. By default, this die is drawn at its own coordinates,\n     * but you can also draw it elsewhere if so needed.\n     */\n    render(context, dieSize, coordinates = this.coordinates) {\n        const scale = dieSize / BASE_DIE_SIZE;\n        const SHALF = HALF * scale;\n        const STHIRD = THIRD * scale;\n        const SPIP_SIZE = PIP_SIZE * scale;\n\n        const {x, y} = coordinates;\n\n        if (this.isHeld()) {\n            renderHold(context, x, y, SHALF, this.heldBy.color);\n        }\n\n        if (0 !== this.rotation) {\n            context.translate(x + SHALF, y + SHALF);\n            context.rotate(deg2rad(this.rotation));\n            context.translate(-1 * (x + SHALF), -1 * (y + SHALF));\n        }\n\n        renderDie(context, x, y, SHALF, this.color);\n\n        switch (this.pips) {\n        case 1: {\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            break;\n        }\n        case 2: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 3: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 4: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 5: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + SHALF, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            break;\n        }\n        case 6: {\n            renderPip(context, x + STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + STHIRD, y + SHALF, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + 2 * STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + STHIRD, SPIP_SIZE);\n            renderPip(context, x + 2 * STHIRD, y + SHALF, SPIP_SIZE);\n            break;\n        }\n        default: // No other values allowed / possible\n        }\n\n        // Clear context\n        context.setTransform(1, 0, 0, 1, 0, 0);\n    }\n};\n\nwindow.customElements.define(TAG_NAME, TopDie);\n\nexport {\n    TopDie,\n    unicodeToPips,\n    pipsToUnicode,\n    TAG_NAME\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {ReadOnlyAttributes} from \"./mixin/ReadOnlyAttributes.js\";\nimport {validate} from \"./validate/validate.js\";\n\nconst TAG_NAME = \"top-player\";\n\n// The names of the (observed) attributes of the TopPlayer.\nconst COLOR_ATTRIBUTE = \"color\";\nconst NAME_ATTRIBUTE = \"name\";\nconst SCORE_ATTRIBUTE = \"score\";\nconst HAS_TURN_ATTRIBUTE = \"has-turn\";\n\n// The private properties of the TopPlayer \nconst _color = new WeakMap();\nconst _name = new WeakMap();\nconst _score = new WeakMap();\nconst _hasTurn = new WeakMap();\n\n/**\n * A Player in a dice game.\n *\n * A player's name should be unique in the game. Two different\n * TopPlayer elements with the same name attribute are treated as\n * the same player.\n *\n * In general it is recommended that no two players do have the same color,\n * although it is not unconceivable that certain dice games have players work\n * in teams where it would make sense for two or more different players to\n * have the same color.\n *\n * The name and color attributes are required. The score and has-turn\n * attributes are not.\n *\n * @extends HTMLElement\n * @mixes ReadOnlyAttributes\n */\nconst TopPlayer = class extends ReadOnlyAttributes(HTMLElement) {\n\n    /**\n     * Create a new TopPlayer, optionally based on an intitial\n     * configuration via an object parameter or declared attributes in HTML.\n     *\n     * @param {Object} [config] - An initial configuration for the\n     * player to create.\n     * @param {String} config.color - This player's color used in the game.\n     * @param {String} config.name - This player's name.\n     * @param {Number} [config.score] - This player's score.\n     * @param {Boolean} [config.hasTurn] - This player has a turn.\n     */\n    constructor({color, name, score, hasTurn} = {}) {\n        super();\n\n        const colorValue = validate.color(color || this.getAttribute(COLOR_ATTRIBUTE));\n        if (colorValue.isValid) {\n            _color.set(this, colorValue.value);\n            this.setAttribute(COLOR_ATTRIBUTE, this.color);\n        } else {\n            throw new ConfigurationError(\"A Player needs a color, which is a String.\");\n        }\n\n        const nameValue = validate.string(name || this.getAttribute(NAME_ATTRIBUTE));\n        if (nameValue.isValid) {\n            _name.set(this, name);\n            this.setAttribute(NAME_ATTRIBUTE, this.name);\n        } else {\n            throw new ConfigurationError(\"A Player needs a name, which is a String.\");\n        }\n\n        const scoreValue = validate.integer(score || this.getAttribute(SCORE_ATTRIBUTE));\n        if (scoreValue.isValid) {\n            _score.set(this, score);\n            this.setAttribute(SCORE_ATTRIBUTE, this.score);\n        } else {\n            // Okay. A player does not need to have a score.\n            _score.set(this, null);\n            this.removeAttribute(SCORE_ATTRIBUTE);\n        }\n\n        const hasTurnValue = validate.boolean(hasTurn || this.getAttribute(HAS_TURN_ATTRIBUTE))\n            .isTrue();\n        if (hasTurnValue.isValid) {\n            _hasTurn.set(this, hasTurn);\n            this.setAttribute(HAS_TURN_ATTRIBUTE, hasTurn);\n        } else {\n            // Okay, A player does not always have a turn.\n            _hasTurn.set(this, null);\n            this.removeAttribute(HAS_TURN_ATTRIBUTE);\n        }\n    }\n\n    static get observedAttributes() {\n        return [\n            COLOR_ATTRIBUTE,\n            NAME_ATTRIBUTE,\n            SCORE_ATTRIBUTE,\n            HAS_TURN_ATTRIBUTE\n        ];\n    }\n\n    connectedCallback() {\n    }\n\n    disconnectedCallback() {\n    }\n\n    /**\n     * This player's color.\n     *\n     * @type {String}\n     */\n    get color() {\n        return _color.get(this);\n    }\n\n    /**\n     * This player's name.\n     *\n     * @type {String}\n     */\n    get name() {\n        return _name.get(this);\n    }\n\n    /**\n     * This player's score.\n     *\n     * @type {Number}\n     */\n    get score() {\n        return null === _score.get(this) ? 0 : _score.get(this);\n    }\n    set score(newScore) {\n        _score.set(this, newScore);\n        if (null === newScore) {\n            this.removeAttribute(SCORE_ATTRIBUTE);\n        } else {\n            this.setAttribute(SCORE_ATTRIBUTE, newScore);\n        }\n    }\n\n    /**\n     * Start a turn for this player.\n     *\n     * @return {TopPlayer} The player with a turn\n     */\n    startTurn() {\n        if (this.isConnected) {\n            this.parentNode.dispatchEvent(new CustomEvent(\"top:start-turn\", {\n                detail: {\n                    player: this\n                }\n            }));\n        }\n        _hasTurn.set(this, true);\n        this.setAttribute(HAS_TURN_ATTRIBUTE, true);\n        return this;\n    }\n\n    /**\n     * End a turn for this player.\n     */\n    endTurn() {\n        _hasTurn.set(this, null);\n        this.removeAttribute(HAS_TURN_ATTRIBUTE);\n    }\n\n    /**\n     * Does this player have a turn?\n     *\n     * @type {Boolean}\n     */\n    get hasTurn() {\n        return true === _hasTurn.get(this);\n    }\n\n    /**\n     * A String representation of this player, his or hers name.\n     *\n     * @return {String} The player's name represents the player as a string.\n     */\n    toString() {\n        return `${this.name}`;\n    }\n\n    /**\n     * Is this player equal another player?\n     * \n     * @param {TopPlayer} other - The other player to compare this player with.\n     * @return {Boolean} True when either the object references are the same\n     * or when both name and color are the same.\n     */\n    equals(other) {\n        const name = \"string\" === typeof other ? other : other.name;\n        return other === this || name === this.name;\n    }\n};\n\nwindow.customElements.define(TAG_NAME, TopPlayer);\n\n/**\n * The default system player. Dice are thrown by a player. For situations\n * where you want to render a bunch of dice without needing the concept of Players\n * this DEFAULT_SYSTEM_PLAYER can be a substitute. Of course, if you'd like to\n * change the name and/or the color, create and use your own \"system player\".\n * @const\n */\nconst DEFAULT_SYSTEM_PLAYER = new TopPlayer({color: \"red\", name: \"*\"});\n\nexport {\n    TopPlayer,\n    DEFAULT_SYSTEM_PLAYER,\n    TAG_NAME,\n    HAS_TURN_ATTRIBUTE\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\nimport {DEFAULT_SYSTEM_PLAYER, TAG_NAME as TOP_PLAYER} from \"./TopPlayer.js\";\n\nconst TAG_NAME = \"top-player-list\";\n\n/**\n * TopPlayerList to describe the players in the game.\n *\n * @extends HTMLElement\n */\nconst TopPlayerList = class extends HTMLElement {\n\n    /**\n     * Create a new TopPlayerList.\n     */\n    constructor() {\n        super();\n    }\n\n    connectedCallback() {\n        if (0 >= this.players.length) {\n            this.appendChild(DEFAULT_SYSTEM_PLAYER);\n        }\n\n        this.addEventListener(\"top:start-turn\", (event) => {\n            // Only one player can have a turn at any given time.\n            this.players\n                .filter(p => !p.equals(event.detail.player))\n                .forEach(p => p.endTurn());\n        });\n    }\n\n    disconnectedCallback() {\n    }\n\n    /**\n     * The players in this list.\n     *\n     * @type {TopPlayer[]}\n     */\n    get players() {\n        return [...this.getElementsByTagName(TOP_PLAYER)];\n    }\n};\n\nwindow.customElements.define(TAG_NAME, TopPlayerList);\n\nexport {\n    TopPlayerList,\n    TAG_NAME\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n * @ignore\n */\n//import {ConfigurationError} from \"./error/ConfigurationError.js\";\nimport {GridLayout} from \"./GridLayout.js\";\nimport {TopDie, TAG_NAME as TOP_DIE} from \"./TopDie.js\";\nimport {DEFAULT_SYSTEM_PLAYER, TopPlayer, TAG_NAME as TOP_PLAYER, HAS_TURN_ATTRIBUTE} from \"./TopPlayer.js\";\nimport {TAG_NAME as TOP_PLAYER_LIST} from \"./TopPlayerList.js\";\nimport {validate} from \"./validate/validate.js\";\n\nconst TAG_NAME = \"top-dice-board\";\n\nconst DEFAULT_DIE_SIZE = 100; // px\nconst DEFAULT_HOLD_DURATION = 375; // ms\nconst DEFAULT_DRAGGING_DICE_DISABLED = false;\nconst DEFAULT_HOLDING_DICE_DISABLED = false;\nconst DEFAULT_ROTATING_DICE_DISABLED = false;\n\nconst ROWS = 10;\nconst COLS = 10;\n\nconst DEFAULT_WIDTH = COLS * DEFAULT_DIE_SIZE; // px\nconst DEFAULT_HEIGHT = ROWS * DEFAULT_DIE_SIZE; // px\nconst DEFAULT_DISPERSION = Math.floor(ROWS / 2);\n\nconst MIN_DELTA = 3; //px\n\nconst WIDTH_ATTRIBUTE = \"width\";\nconst HEIGHT_ATTRIBUTE = \"height\";\nconst DISPERSION_ATTRIBUTE = \"dispersion\";\nconst DIE_SIZE_ATTRIBUTE = \"die-size\";\nconst DRAGGING_DICE_DISABLED_ATTRIBUTE = \"dragging-dice-disabled\";\nconst HOLDING_DICE_DISABLED_ATTRIBUTE = \"holding-dice-disabled\";\nconst ROTATING_DICE_DISABLED_ATTRIBUTE = \"rotating-dice-disabled\";\nconst HOLD_DURATION_ATTRIBUTE = \"hold-duration\";\n\nconst parseNumber = (numberString, defaultNumber = 0) => {\n    const number = parseInt(numberString, 10);\n    return Number.isNaN(number) ? defaultNumber : number;\n};\n\nconst getPositiveNumber = (numberString, defaultValue) => {\n    return validate.integer(numberString)\n        .largerThan(0)\n        .defaultTo(defaultValue)\n        .value;\n};\n\nconst getPositiveNumberAttribute = (element, name, defaultValue) => {\n    if (element.hasAttribute(name)) {\n        const valueString = element.getAttribute(name);\n        return getPositiveNumber(valueString, defaultValue);\n    }\n    return defaultValue;\n};\n\nconst getBoolean = (booleanString, trueValue, defaultValue) => {\n    if (trueValue === booleanString || \"true\" === booleanString) {\n        return true;\n    } else if (\"false\" === booleanString) {\n        return false;\n    } else {\n        return defaultValue;\n    }\n};\n\nconst getBooleanAttribute = (element, name, defaultValue) => {\n    if (element.hasAttribute(name)) {\n        const valueString = element.getAttribute(name);\n        return getBoolean(valueString, [valueString, \"true\"], [\"false\"], defaultValue);\n    }\n\n    return defaultValue;\n};\n\n// Private properties\nconst _canvas = new WeakMap();\nconst _layout = new WeakMap();\nconst _currentPlayer = new WeakMap();\nconst _numberOfReadyDice = new WeakMap();\n\nconst context = (board) => _canvas.get(board).getContext(\"2d\");\n\nconst getReadyDice = (board) => {\n    if (undefined === _numberOfReadyDice.get(board)) {\n        _numberOfReadyDice.set(board, 0);\n    }\n\n    return _numberOfReadyDice.get(board);\n};\n\nconst updateReadyDice = (board, update) => {\n    _numberOfReadyDice.set(board, getReadyDice(board) + update);\n};\n\nconst isReady = (board) => getReadyDice(board) === board.dice.length;\n\nconst updateBoard = (board, dice = board.dice) => {\n    if (isReady(board)) {\n        context(board).clearRect(0, 0, board.width, board.height);\n\n        for (const die of dice) {\n            die.render(context(board), board.dieSize);\n        }\n    }\n};\n\n\n// Interaction states\nconst NONE = Symbol(\"no_interaction\");\nconst HOLD = Symbol(\"hold\");\nconst MOVE = Symbol(\"move\");\nconst INDETERMINED = Symbol(\"indetermined\");\nconst DRAGGING = Symbol(\"dragging\");\n\n// Methods to handle interaction\nconst convertWindowCoordinatesToCanvas = (canvas, xWindow, yWindow) => {\n    const canvasBox = canvas.getBoundingClientRect();\n\n    const x = xWindow - canvasBox.left * (canvas.width / canvasBox.width);\n    const y = yWindow - canvasBox.top * (canvas.height / canvasBox.height);\n\n    return {x, y};\n};\n\nconst setupInteraction = (board) => {\n    const canvas = _canvas.get(board);\n\n    // Setup interaction\n    let origin = {};\n    let state = NONE;\n    let staticBoard = null;\n    let dieUnderCursor = null;\n    let holdTimeout = null;\n\n    const holdDie = () => {\n        if (HOLD === state || INDETERMINED === state) {\n            // toggle hold / release\n            const playerWithATurn = board.querySelector(`${TOP_PLAYER_LIST} ${TOP_PLAYER}[${HAS_TURN_ATTRIBUTE}]`);\n            if (dieUnderCursor.isHeld()) {\n                dieUnderCursor.releaseIt(playerWithATurn);\n            } else {\n                dieUnderCursor.holdIt(playerWithATurn);\n            }\n            state = NONE;\n\n            updateBoard(board);\n        }\n\n        holdTimeout = null;\n    };\n\n    const startHolding = () => {\n        holdTimeout = window.setTimeout(holdDie, board.holdDuration);\n    };\n\n    const stopHolding = () => {\n        window.clearTimeout(holdTimeout);\n        holdTimeout = null;\n    };\n\n    const startInteraction = (event) => {\n        if (NONE === state) {\n\n            origin = {\n                x: event.clientX,\n                y: event.clientY\n            };\n\n            dieUnderCursor = board.layout.getAt(convertWindowCoordinatesToCanvas(canvas, event.clientX, event.clientY));\n\n            if (null !== dieUnderCursor) {\n                // Only interaction with the board via a die\n                if (!board.disabledHoldingDice && !board.disabledDraggingDice) {\n                    state = INDETERMINED;\n                    startHolding();\n                } else if (!board.disabledHoldingDice) {\n                    state = HOLD;\n                    startHolding();\n                } else if (!board.disabledDraggingDice) {\n                    state = MOVE;\n                }\n            }\n\n        }\n    };\n\n    const showInteraction = (event) => {\n        const dieUnderCursor = board.layout.getAt(convertWindowCoordinatesToCanvas(canvas, event.clientX, event.clientY));\n        if (DRAGGING === state) {\n            canvas.style.cursor = \"grabbing\";\n        } else if (null !== dieUnderCursor) {\n            canvas.style.cursor = \"grab\";\n        } else {\n            canvas.style.cursor = \"default\";\n        }\n    };\n\n    const move = (event) => {\n        if (MOVE === state || INDETERMINED === state) {\n            // determine if a die is under the cursor\n            // Ignore small movements\n            const dx = Math.abs(origin.x - event.clientX);\n            const dy = Math.abs(origin.y - event.clientY);\n\n            if (MIN_DELTA < dx || MIN_DELTA < dy) {\n                state = DRAGGING;\n                stopHolding();\n\n                const diceWithoutDieUnderCursor = board.dice.filter(die => die !== dieUnderCursor);\n                updateBoard(board, diceWithoutDieUnderCursor);\n                staticBoard = context(board).getImageData(0, 0, canvas.width, canvas.height);\n            }\n        } else if (DRAGGING === state) {\n            const dx = origin.x - event.clientX;\n            const dy = origin.y - event.clientY;\n\n            const {x, y} = dieUnderCursor.coordinates;\n\n            context(board).putImageData(staticBoard, 0, 0);\n            dieUnderCursor.render(context(board), board.dieSize, {x: x - dx, y: y - dy});\n        }\n    };\n\n    const stopInteraction = (event) => {\n        if (null !== dieUnderCursor && DRAGGING === state) {\n            const dx = origin.x - event.clientX;\n            const dy = origin.y - event.clientY;\n\n            const {x, y} = dieUnderCursor.coordinates;\n\n            const snapToCoords = board.layout.snapTo({\n                die: dieUnderCursor,\n                x: x - dx,\n                y: y - dy,\n            });\n\n            const newCoords = null != snapToCoords ? snapToCoords : {x, y};\n\n            dieUnderCursor.coordinates = newCoords;\n        }\n\n        // Clear state\n        dieUnderCursor = null;\n        state = NONE;\n\n        // Refresh board; Render dice\n        updateBoard(board);\n    };\n\n\n    // Register the actual event listeners defined above. Map touch events to\n    // equivalent mouse events. Because the \"touchend\" event does not have a\n    // clientX and clientY, record and use the last ones from the \"touchmove\"\n    // (or \"touchstart\") events.\n\n    let touchCoordinates = {clientX: 0, clientY: 0};\n    const touch2mouseEvent = (mouseEventName) => {\n        return (touchEvent) => {\n            if (touchEvent && 0 < touchEvent.touches.length) {\n                const {clientX, clientY} = touchEvent.touches[0];\n                touchCoordinates = {clientX, clientY};\n            }\n            canvas.dispatchEvent(new MouseEvent(mouseEventName, touchCoordinates));\n        };\n    };\n\n    canvas.addEventListener(\"touchstart\", touch2mouseEvent(\"mousedown\"));\n    canvas.addEventListener(\"mousedown\", startInteraction);\n\n    if (!board.disabledDraggingDice) {\n        canvas.addEventListener(\"touchmove\", touch2mouseEvent(\"mousemove\"));\n        canvas.addEventListener(\"mousemove\", move);\n    }\n\n    if (!board.disabledDraggingDice || !board.disabledHoldingDice) {\n        canvas.addEventListener(\"mousemove\", showInteraction);\n    }\n\n    canvas.addEventListener(\"touchend\", touch2mouseEvent(\"mouseup\"));\n    canvas.addEventListener(\"mouseup\", stopInteraction);\n    canvas.addEventListener(\"mouseout\", stopInteraction);\n};\n\n/**\n * TopDiceBoard is a custom HTML element to render and control a\n * dice board. \n *\n * @extends HTMLElement\n */\nconst TopDiceBoard = class extends HTMLElement {\n\n    /**\n     * Create a new TopDiceBoard.\n     */\n    constructor() {\n        super();\n        this.style.display = \"inline-block\";\n        const shadow = this.attachShadow({mode: \"closed\"});\n        const canvas = document.createElement(\"canvas\");\n        shadow.appendChild(canvas);\n\n        _canvas.set(this, canvas);\n        _currentPlayer.set(this, DEFAULT_SYSTEM_PLAYER);\n        _layout.set(this, new GridLayout({\n            width: this.width,\n            height: this.height,\n            dieSize: this.dieSize,\n            dispersion: this.dispersion\n        }));\n        setupInteraction(this);\n    }\n\n    static get observedAttributes() {\n        return [\n            WIDTH_ATTRIBUTE,\n            HEIGHT_ATTRIBUTE,\n            DISPERSION_ATTRIBUTE,\n            DIE_SIZE_ATTRIBUTE,\n            DRAGGING_DICE_DISABLED_ATTRIBUTE,\n            ROTATING_DICE_DISABLED_ATTRIBUTE,\n            HOLDING_DICE_DISABLED_ATTRIBUTE,\n            HOLD_DURATION_ATTRIBUTE\n        ];\n    }\n\n    attributeChangedCallback(name, oldValue, newValue) {\n        const canvas = _canvas.get(this);\n        switch (name) {\n        case WIDTH_ATTRIBUTE: {\n            const width = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_WIDTH);\n            this.layout.width = width;\n            canvas.setAttribute(WIDTH_ATTRIBUTE, width);\n            break;\n        }\n        case HEIGHT_ATTRIBUTE: {\n            const height = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_HEIGHT);\n            this.layout.height = height;\n            canvas.setAttribute(HEIGHT_ATTRIBUTE, height);\n            break;\n        }\n        case DISPERSION_ATTRIBUTE: {\n            const dispersion = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_DISPERSION);\n            this.layout.dispersion = dispersion;\n            break;\n        }\n        case DIE_SIZE_ATTRIBUTE: {\n            const dieSize = getPositiveNumber(newValue, parseNumber(oldValue) || DEFAULT_DIE_SIZE);\n            this.layout.dieSize = dieSize;\n            break;\n        }\n        case ROTATING_DICE_DISABLED_ATTRIBUTE: {\n            const disabledRotation = validate.boolean(newValue, getBoolean(oldValue, ROTATING_DICE_DISABLED_ATTRIBUTE, DEFAULT_ROTATING_DICE_DISABLED)).value;\n            this.layout.rotate = !disabledRotation;\n            break;\n        }\n        default: {\n            // The value is determined when using the getter\n        }\n        }\n\n        updateBoard(this);\n    }\n\n    connectedCallback() {\n        this.addEventListener(\"top-die:added\", () => {\n            updateReadyDice(this, 1);\n            if (isReady(this)) {\n                updateBoard(this, this.layout.layout(this.dice));\n            }\n        });\n\n        this.addEventListener(\"top-die:removed\", () => {\n            updateBoard(this, this.layout.layout(this.dice));\n            updateReadyDice(this, -1);\n        });\n    }\n\n    disconnectedCallback() {\n    }\n\n    adoptedCallback() {\n    }\n\n    /**\n     * The GridLayout used by this DiceBoard to layout the dice.\n     *\n     * @type {GridLayout}\n     */\n    get layout() {\n        return _layout.get(this);\n    }\n\n    /**\n     * The dice on this board. Note, to actually throw the dice use\n     * {@link throwDice}. \n     *\n     * @type {TopDie[]}\n     */\n    get dice() {\n        return [...this.getElementsByTagName(TOP_DIE)];\n    }\n\n    /**\n     * The maximum number of dice that can be put on this board.\n     *\n     * @return {Number} The maximum number of dice, 0 < maximum.\n     */\n    get maximumNumberOfDice() {\n        return this.layout.maximumNumberOfDice;\n    }\n\n    /**\n     * The width of this board.\n     *\n     * @type {Number}\n     */\n    get width() {\n        return getPositiveNumberAttribute(this, WIDTH_ATTRIBUTE, DEFAULT_WIDTH);\n    }\n\n    /**\n     * The height of this board.\n     * @type {Number}\n     */\n    get height() {\n        return getPositiveNumberAttribute(this, HEIGHT_ATTRIBUTE, DEFAULT_HEIGHT);\n    }\n\n    /**\n     * The dispersion level of this board.\n     * @type {Number}\n     */\n    get dispersion() {\n        return getPositiveNumberAttribute(this, DISPERSION_ATTRIBUTE, DEFAULT_DISPERSION);\n    }\n\n    /**\n     * The size of dice on this board.\n     *\n     * @type {Number}\n     */\n    get dieSize() {\n        return getPositiveNumberAttribute(this, DIE_SIZE_ATTRIBUTE, DEFAULT_DIE_SIZE);\n    }\n\n    /**\n     * Can dice on this board be dragged?\n     * @type {Boolean}\n     */\n    get disabledDraggingDice() {\n        return getBooleanAttribute(this, DRAGGING_DICE_DISABLED_ATTRIBUTE, DEFAULT_DRAGGING_DICE_DISABLED);\n    }\n\n    /**\n     * Can dice on this board be held by a Player?\n     * @type {Boolean}\n     */\n    get disabledHoldingDice() {\n        return getBooleanAttribute(this, HOLDING_DICE_DISABLED_ATTRIBUTE, DEFAULT_HOLDING_DICE_DISABLED);\n    }\n\n    /**\n     * Is rotating dice on this board disabled?\n     * @type {Boolean}\n     */\n    get disabledRotatingDice() {\n        return getBooleanAttribute(this, ROTATING_DICE_DISABLED_ATTRIBUTE, DEFAULT_ROTATING_DICE_DISABLED);\n    }\n\n    /**\n     * The duration in ms to press the mouse / touch a die before it bekomes\n     * held by the Player. It has only an effect when this.holdableDice ===\n     * true.\n     *\n     * @type {Number}\n     */\n    get holdDuration() {\n        return getPositiveNumberAttribute(this, HOLD_DURATION_ATTRIBUTE, DEFAULT_HOLD_DURATION);\n    }\n\n    /**\n     * The TopPlayerList element of this TopDiceBoard. If it does not exist,\n     * it will be created.\n     *\n     * @type {TopPlayerList}\n     * @private\n     */\n    get _playerList() {\n        let playerList = this.querySelector(TOP_PLAYER_LIST);\n        if (null === playerList) {\n            playerList = this.appendChild(TOP_PLAYER_LIST);\n        }\n\n        return playerList;\n    }\n\n    /**\n     * The players playing on this board.\n     *\n     * @type {TopPlayer[]}\n     */\n    get players() {\n        return this._playerList.players;\n    }\n\n    /**\n     * As player, throw the dice on this board.\n     *\n     * @param {TopPlayer} [player = DEFAULT_SYSTEM_PLAYER] - The\n     * player that is throwing the dice on this board.\n     *\n     * @return {TopDie[]} The thrown dice on this board. This list of dice is the same as this TopDiceBoard's {@see dice} property\n     */\n    throwDice(player = DEFAULT_SYSTEM_PLAYER) {\n        if (player && !player.hasTurn) {\n            player.startTurn();\n        }\n        this.dice.forEach(die => die.throwIt());\n        updateBoard(this, this.layout.layout(this.dice));\n        return this.dice;\n    }\n\n    /**\n     * Add a die to this TopDiceBoard.\n     *\n     * @param {TopDie|Object} [config = {}] - The die or a configuration of\n     * the die to add to this TopDiceBoard.\n     * @param {Number|null} [config.pips] - The pips of the die to add.\n     * If no pips are specified or the pips are not between 1 and 6, a random\n     * number between 1 and 6 is generated instead.\n     * @param {String} [config.color] - The color of the die to add. Default\n     * to the default color.\n     * @param {Number} [config.x] - The x coordinate of the die.\n     * @param {Number} [config.y] - The y coordinate of the die.\n     * @param {Number} [config.rotation] - The rotation of the die.\n     * @param {TopPlayer} [config.heldBy] - The player holding the die.\n     *\n     * @return {TopDie} The added die.\n     */\n    addDie(config = {}) {\n        return this.appendChild(config instanceof TopDie ? config : new TopDie(config));\n    }\n\n    /**\n     * Remove die from this TopDiceBoard.\n     *\n     * @param {TopDie} die - The die to remove from this board.\n     */\n    removeDie(die) {\n        if (die.parentNode && die.parentNode === this) {\n            this.removeChild(die);\n        }\n    }\n\n    /**\n     * Add a player to this TopDiceBoard.\n     *\n     * @param {TopPlayer|Object} config - The player or a configuration of a\n     * player to add to this TopDiceBoard.\n     * @param {String} config.color - This player's color used in the game.\n     * @param {String} config.name - This player's name.\n     * @param {Number} [config.score] - This player's score.\n     * @param {Boolean} [config.hasTurn] - This player has a turn.\n     *\n     * @throws Error when the player to add conflicts with a pre-existing\n     * player.\n     *\n     * @return {TopPlayer} The added player.\n     */\n    addPlayer(config = {}) {\n        return this._playerList.appendChild(config instanceof TopPlayer ? config : new TopPlayer(config));\n    }\n\n    /**\n     * Remove player from this TopDiceBoard.\n     *\n     * @param {TopPlayer} player - The player to remove from this board.\n     */\n    removePlayer(player) {\n        if (player.parentNode && player.parentNode === this._playerList) {\n            this._playerList.removeChild(player);\n        }\n    }\n\n};\n\nwindow.customElements.define(TAG_NAME, TopDiceBoard);\n\nexport {\n    TopDiceBoard,\n    DEFAULT_DIE_SIZE,\n    DEFAULT_HOLD_DURATION,\n    DEFAULT_WIDTH,\n    DEFAULT_HEIGHT,\n    DEFAULT_DISPERSION,\n    DEFAULT_ROTATING_DICE_DISABLED,\n    TAG_NAME\n};\n","/**\n * Copyright (c) 2018, 2019 Huub de Beer\n *\n * This file is part of twenty-one-pips.\n *\n * Twenty-one-pips is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your\n * option) any later version.\n *\n * Twenty-one-pips is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY\n * or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n * License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with twenty-one-pips.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport {TopDiceBoard} from \"./TopDiceBoard.js\";\nimport {TopDie} from \"./TopDie.js\";\nimport {TopPlayer} from \"./TopPlayer.js\";\nimport {TopPlayerList} from \"./TopPlayerList.js\";\n\nwindow.twentyonepips = window.twentyonepips || Object.freeze({\n    VERSION: \"0.0.1\",\n    LICENSE: \"LGPL-3.0\",\n    WEBSITE: \"https://twentyonepips.org\",\n    TopDiceBoard: TopDiceBoard,\n    TopDie: TopDie,\n    TopPlayer: TopPlayer,\n    TopPlayerList: TopPlayerList\n});\n"]}