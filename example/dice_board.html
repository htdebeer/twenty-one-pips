<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Twenty-One-Pips: Dice Board</title>
        <style>
            figure {
                display: inline-block;
                margin: 0;
                padding: 0;
                border: 2px solid black;
            }

            figcaption {
                text-align: center;
                font-style: italic;
                border-bottom: 2px solid black;
            }

            figure canvas, figure svg {
                margin: 0;
                padding: 0;
                display: block;
            }
        </style>
    </head>
    <body>
        <h1>Dice Board</h1>

        <figure id="svg-dice-board">
            <figcaption>SVG</figcaption>
        </figure>

        <figure id="canvas-dice-board">
            <figcaption>Canvas</figcaption>
        </figure>

        <script type="module">
import {SVGDiceBoard} from "../src/dice_board/SVGDiceBoard.js";
import {CanvasDiceBoard} from  "../src/dice_board/CanvasDiceBoard.js";            
import {Player} from "../src/Player.js";

const NUMBER_OF_DICE = 5;
const svgDiceBoardElement = document.querySelector("#svg-dice-board");
const svgDiceBoard = new SVGDiceBoard({
    parent: svgDiceBoardElement,
    width: 300,
    height: 300,
    dieSize: 50,
    dice: NUMBER_OF_DICE,
    background: "gold"
});

const canvasDiceBoardElement = document.querySelector("#canvas-dice-board");
const canvasDiceBoard = new CanvasDiceBoard({
    parent: canvasDiceBoardElement,
    width: 300,
    height: 300,
    dieSize: 50,
    dice: NUMBER_OF_DICE,
    background: "lightgreen"
});

const PIPS_MAX = 6;
const MAX = NUMBER_OF_DICE * PIPS_MAX;
const WAIT = 1000;
const PLAYER = new Player({name: "dicey", color: "purple"});

const throwUntilMax = (board, name) => {
    let numberOfThrows = 1;
    let sum = 0;

    const thrower = () => {
        sum = board
            .dice
            .reduce((sum, die) => sum + die.pips, 0);

        console.log(`Throw ${numberOfThrows}:\t${sum} (${name})`);

        board
            .dice
            .filter(die => PIPS_MAX === die.pips)
            .forEach(die => die.holdIt(PLAYER));

        board.throwDice();

        numberOfThrows++;

        if (MAX !== sum) {
            setTimeout(thrower, WAIT);
        }
    };

    return thrower;
};

throwUntilMax(svgDiceBoard, "SVG")();
throwUntilMax(canvasDiceBoard, "Canvas")();
        </script>
    </body>
</html>
